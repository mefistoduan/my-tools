<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../jquery-1.7.2.js"></script>
</head>
<body>
<script>
$(function () {

    /*! jQuery v2.0.0 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license */
    (function (e, undefined) {
        var t, n, r = typeof undefined, i = e.location, o = e.document, s = o.documentElement, a = e.jQuery, u = e.$, l = {}, c = [], f = "2.0.0", p = c.concat, h = c.push, d = c.slice, g = c.indexOf, m = l.toString, y = l.hasOwnProperty, v = f.trim, x = function (e, n) {
            return new x.fn.init(e, n, t)
        }, b = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, w = /\S+/g, T = /^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/, C = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, k = /^-ms-/, N = /-([\da-z])/gi, E = function (e, t) {
            return t.toUpperCase()
        }, S = function () {
            o.removeEventListener("DOMContentLoaded", S, !1), e.removeEventListener("load", S, !1), x.ready()
        };
        x.fn = x.prototype = {
            jquery: f, constructor: x, init: function (e, t, n) {
                var r, i;
                if (!e)return this;
                if ("string" == typeof e) {
                    if (r = "<" === e.charAt(0) && ">" === e.charAt(e.length - 1) && e.length >= 3 ? [null, e, null] : T.exec(e), !r || !r[1] && t)return !t || t.jquery ? (t || n).find(e) : this.constructor(t).find(e);
                    if (r[1]) {
                        if (t = t instanceof x ? t[0] : t, x.merge(this, x.parseHTML(r[1], t && t.nodeType ? t.ownerDocument || t : o, !0)), C.test(r[1]) && x.isPlainObject(t))for (r in t)x.isFunction(this[r]) ? this[r](t[r]) : this.attr(r, t[r]);
                        return this
                    }
                    return i = o.getElementById(r[2]), i && i.parentNode && (this.length = 1, this[0] = i), this.context = o, this.selector = e, this
                }
                return e.nodeType ? (this.context = this[0] = e, this.length = 1, this) : x.isFunction(e) ? n.ready(e) : (e.selector !== undefined && (this.selector = e.selector, this.context = e.context), x.makeArray(e, this))
            }, selector: "", length: 0, toArray: function () {
                return d.call(this)
            }, get: function (e) {
                return null == e ? this.toArray() : 0 > e ? this[this.length + e] : this[e]
            }, pushStack: function (e) {
                var t = x.merge(this.constructor(), e);
                return t.prevObject = this, t.context = this.context, t
            }, each: function (e, t) {
                return x.each(this, e, t)
            }, ready: function (e) {
                return x.ready.promise().done(e), this
            }, slice: function () {
                return this.pushStack(d.apply(this, arguments))
            }, first: function () {
                return this.eq(0)
            }, last: function () {
                return this.eq(-1)
            }, eq: function (e) {
                var t = this.length, n = +e + (0 > e ? t : 0);
                return this.pushStack(n >= 0 && t > n ? [this[n]] : [])
            }, map: function (e) {
                return this.pushStack(x.map(this, function (t, n) {
                    return e.call(t, n, t)
                }))
            }, end: function () {
                return this.prevObject || this.constructor(null)
            }, push: h, sort: [].sort, splice: [].splice
        }, x.fn.init.prototype = x.fn, x.extend = x.fn.extend = function () {
            var e, t, n, r, i, o, s = arguments[0] || {}, a = 1, u = arguments.length, l = !1;
            for ("boolean" == typeof s && (l = s, s = arguments[1] || {}, a = 2), "object" == typeof s || x.isFunction(s) || (s = {}), u === a && (s = this, --a); u > a; a++)if (null != (e = arguments[a]))for (t in e)n = s[t], r = e[t], s !== r && (l && r && (x.isPlainObject(r) || (i = x.isArray(r))) ? (i ? (i = !1, o = n && x.isArray(n) ? n : []) : o = n && x.isPlainObject(n) ? n : {}, s[t] = x.extend(l, o, r)) : r !== undefined && (s[t] = r));
            return s
        }, x.extend({
            expando: "jQuery" + (f + Math.random()).replace(/\D/g, ""), noConflict: function (t) {
                return e.$ === x && (e.$ = u), t && e.jQuery === x && (e.jQuery = a), x
            }, isReady: !1, readyWait: 1, holdReady: function (e) {
                e ? x.readyWait++ : x.ready(!0)
            }, ready: function (e) {
                (e === !0 ? --x.readyWait : x.isReady) || (x.isReady = !0, e !== !0 && --x.readyWait > 0 || (n.resolveWith(o, [x]), x.fn.trigger && x(o).trigger("ready").off("ready")))
            }, isFunction: function (e) {
                return "function" === x.type(e)
            }, isArray: Array.isArray, isWindow: function (e) {
                return null != e && e === e.window
            }, isNumeric: function (e) {
                return !isNaN(parseFloat(e)) && isFinite(e)
            }, type: function (e) {
                return null == e ? e + "" : "object" == typeof e || "function" == typeof e ? l[m.call(e)] || "object" : typeof e
            }, isPlainObject: function (e) {
                if ("object" !== x.type(e) || e.nodeType || x.isWindow(e))return !1;
                try {
                    if (e.constructor && !y.call(e.constructor.prototype, "isPrototypeOf"))return !1
                } catch (t) {
                    return !1
                }
                return !0
            }, isEmptyObject: function (e) {
                var t;
                for (t in e)return !1;
                return !0
            }, error: function (e) {
                throw Error(e)
            }, parseHTML: function (e, t, n) {
                if (!e || "string" != typeof e)return null;
                "boolean" == typeof t && (n = t, t = !1), t = t || o;
                var r = C.exec(e), i = !n && [];
                return r ? [t.createElement(r[1])] : (r = x.buildFragment([e], t, i), i && x(i).remove(), x.merge([], r.childNodes))
            }, parseJSON: JSON.parse, parseXML: function (e) {
                var t, n;
                if (!e || "string" != typeof e)return null;
                try {
                    n = new DOMParser, t = n.parseFromString(e, "text/xml")
                } catch (r) {
                    t = undefined
                }
                return (!t || t.getElementsByTagName("parsererror").length) && x.error("Invalid XML: " + e), t
            }, noop: function () {
            }, globalEval: function (e) {
                var t, n = eval;
                e = x.trim(e), e && (1 === e.indexOf("use strict") ? (t = o.createElement("script"), t.text = e, o.head.appendChild(t).parentNode.removeChild(t)) : n(e))
            }, camelCase: function (e) {
                return e.replace(k, "ms-").replace(N, E)
            }, nodeName: function (e, t) {
                return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase()
            }, each: function (e, t, n) {
                var r, i = 0, o = e.length, s = j(e);
                if (n) {
                    if (s) {
                        for (; o > i; i++)if (r = t.apply(e[i], n), r === !1)break
                    } else for (i in e)if (r = t.apply(e[i], n), r === !1)break
                } else if (s) {
                    for (; o > i; i++)if (r = t.call(e[i], i, e[i]), r === !1)break
                } else for (i in e)if (r = t.call(e[i], i, e[i]), r === !1)break;
                return e
            }, trim: function (e) {
                return null == e ? "" : v.call(e)
            }, makeArray: function (e, t) {
                var n = t || [];
                return null != e && (j(Object(e)) ? x.merge(n, "string" == typeof e ? [e] : e) : h.call(n, e)), n
            }, inArray: function (e, t, n) {
                return null == t ? -1 : g.call(t, e, n)
            }, merge: function (e, t) {
                var n = t.length, r = e.length, i = 0;
                if ("number" == typeof n)for (; n > i; i++)e[r++] = t[i]; else while (t[i] !== undefined)e[r++] = t[i++];
                return e.length = r, e
            }, grep: function (e, t, n) {
                var r, i = [], o = 0, s = e.length;
                for (n = !!n; s > o; o++)r = !!t(e[o], o), n !== r && i.push(e[o]);
                return i
            }, map: function (e, t, n) {
                var r, i = 0, o = e.length, s = j(e), a = [];
                if (s)for (; o > i; i++)r = t(e[i], i, n), null != r && (a[a.length] = r); else for (i in e)r = t(e[i], i, n), null != r && (a[a.length] = r);
                return p.apply([], a)
            }, guid: 1, proxy: function (e, t) {
                var n, r, i;
                return "string" == typeof t && (n = e[t], t = e, e = n), x.isFunction(e) ? (r = d.call(arguments, 2), i = function () {
                    return e.apply(t || this, r.concat(d.call(arguments)))
                }, i.guid = e.guid = e.guid || x.guid++, i) : undefined
            }, access: function (e, t, n, r, i, o, s) {
                var a = 0, u = e.length, l = null == n;
                if ("object" === x.type(n)) {
                    i = !0;
                    for (a in n)x.access(e, t, a, n[a], !0, o, s)
                } else if (r !== undefined && (i = !0, x.isFunction(r) || (s = !0), l && (s ? (t.call(e, r), t = null) : (l = t, t = function (e, t, n) {
                            return l.call(x(e), n)
                        })), t))for (; u > a; a++)t(e[a], n, s ? r : r.call(e[a], a, t(e[a], n)));
                return i ? e : l ? t.call(e) : u ? t(e[0], n) : o
            }, now: Date.now, swap: function (e, t, n, r) {
                var i, o, s = {};
                for (o in t)s[o] = e.style[o], e.style[o] = t[o];
                i = n.apply(e, r || []);
                for (o in t)e.style[o] = s[o];
                return i
            }
        }), x.ready.promise = function (t) {
            return n || (n = x.Deferred(), "complete" === o.readyState ? setTimeout(x.ready) : (o.addEventListener("DOMContentLoaded", S, !1), e.addEventListener("load", S, !1))), n.promise(t)
        }, x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function (e, t) {
            l["[object " + t + "]"] = t.toLowerCase()
        });
        function j(e) {
            var t = e.length, n = x.type(e);
            return x.isWindow(e) ? !1 : 1 === e.nodeType && t ? !0 : "array" === n || "function" !== n && (0 === t || "number" == typeof t && t > 0 && t - 1 in e)
        }

        t = x(o), function (e, undefined) {
            var t, n, r, i, o, s, a, u, l, c, f, p, h, d, g, m, y = "sizzle" + -new Date, v = e.document, b = {}, w = 0, T = 0, C = ot(), k = ot(), N = ot(), E = !1, S = function () {
                return 0
            }, j = typeof undefined, D = 1 << 31, A = [], L = A.pop, q = A.push, H = A.push, O = A.slice, F = A.indexOf || function (e) {
                        var t = 0, n = this.length;
                        for (; n > t; t++)if (this[t] === e)return t;
                        return -1
                    }, P = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", R = "[\\x20\\t\\r\\n\\f]", M = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", W = M.replace("w", "w#"), $ = "\\[" + R + "*(" + M + ")" + R + "*(?:([*^$|!~]?=)" + R + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + W + ")|)|)" + R + "*\\]", B = ":(" + M + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + $.replace(3, 8) + ")*)|.*)\\)|)", I = RegExp("^" + R + "+|((?:^|[^\\\\])(?:\\\\.)*)" + R + "+$", "g"), z = RegExp("^" + R + "*," + R + "*"), _ = RegExp("^" + R + "*([>+~]|" + R + ")" + R + "*"), X = RegExp(R + "*[+~]"), U = RegExp("=" + R + "*([^\\]'\"]*)" + R + "*\\]", "g"), Y = RegExp(B), V = RegExp("^" + W + "$"), G = {
                ID: RegExp("^#(" + M + ")"),
                CLASS: RegExp("^\\.(" + M + ")"),
                TAG: RegExp("^(" + M.replace("w", "w*") + ")"),
                ATTR: RegExp("^" + $),
                PSEUDO: RegExp("^" + B),
                CHILD: RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + R + "*(even|odd|(([+-]|)(\\d*)n|)" + R + "*(?:([+-]|)" + R + "*(\\d+)|))" + R + "*\\)|)", "i"),
                "boolean": RegExp("^(?:" + P + ")$", "i"),
                needsContext: RegExp("^" + R + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + R + "*((?:-\\d)?\\d*)" + R + "*\\)|)(?=[^-]|$)", "i")
            }, J = /^[^{]+\{\s*\[native \w/, Q = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, K = /^(?:input|select|textarea|button)$/i, Z = /^h\d$/i, et = /'|\\/g, tt = /\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g, nt = function (e, t) {
                var n = "0x" + t - 65536;
                return n !== n ? t : 0 > n ? String.fromCharCode(n + 65536) : String.fromCharCode(55296 | n >> 10, 56320 | 1023 & n)
            };
            try {
                H.apply(A = O.call(v.childNodes), v.childNodes), A[v.childNodes.length].nodeType
            } catch (rt) {
                H = {
                    apply: A.length ? function (e, t) {
                        q.apply(e, O.call(t))
                    } : function (e, t) {
                        var n = e.length, r = 0;
                        while (e[n++] = t[r++]);
                        e.length = n - 1
                    }
                }
            }
            function it(e) {
                return J.test(e + "")
            }

            function ot() {
                var e, t = [];
                return e = function (n, i) {
                    return t.push(n += " ") > r.cacheLength && delete e[t.shift()], e[n] = i
                }
            }

            function st(e) {
                return e[y] = !0, e
            }

            function at(e) {
                var t = c.createElement("div");
                try {
                    return !!e(t)
                } catch (n) {
                    return !1
                } finally {
                    t.parentNode && t.parentNode.removeChild(t), t = null
                }
            }

            function ut(e, t, n, r) {
                var i, o, s, a, u, f, d, g, x, w;
                if ((t ? t.ownerDocument || t : v) !== c && l(t), t = t || c, n = n || [], !e || "string" != typeof e)return n;
                if (1 !== (a = t.nodeType) && 9 !== a)return [];
                if (p && !r) {
                    if (i = Q.exec(e))if (s = i[1]) {
                        if (9 === a) {
                            if (o = t.getElementById(s), !o || !o.parentNode)return n;
                            if (o.id === s)return n.push(o), n
                        } else if (t.ownerDocument && (o = t.ownerDocument.getElementById(s)) && m(t, o) && o.id === s)return n.push(o), n
                    } else {
                        if (i[2])return H.apply(n, t.getElementsByTagName(e)), n;
                        if ((s = i[3]) && b.getElementsByClassName && t.getElementsByClassName)return H.apply(n, t.getElementsByClassName(s)), n
                    }
                    if (b.qsa && (!h || !h.test(e))) {
                        if (g = d = y, x = t, w = 9 === a && e, 1 === a && "object" !== t.nodeName.toLowerCase()) {
                            f = gt(e), (d = t.getAttribute("id")) ? g = d.replace(et, "\\$&") : t.setAttribute("id", g), g = "[id='" + g + "'] ", u = f.length;
                            while (u--)f[u] = g + mt(f[u]);
                            x = X.test(e) && t.parentNode || t, w = f.join(",")
                        }
                        if (w)try {
                            return H.apply(n, x.querySelectorAll(w)), n
                        } catch (T) {
                        } finally {
                            d || t.removeAttribute("id")
                        }
                    }
                }
                return kt(e.replace(I, "$1"), t, n, r)
            }

            o = ut.isXML = function (e) {
                var t = e && (e.ownerDocument || e).documentElement;
                return t ? "HTML" !== t.nodeName : !1
            }, l = ut.setDocument = function (e) {
                var t = e ? e.ownerDocument || e : v;
                return t !== c && 9 === t.nodeType && t.documentElement ? (c = t, f = t.documentElement, p = !o(t), b.getElementsByTagName = at(function (e) {
                    return e.appendChild(t.createComment("")), !e.getElementsByTagName("*").length
                }), b.attributes = at(function (e) {
                    return e.className = "i", !e.getAttribute("className")
                }), b.getElementsByClassName = at(function (e) {
                    return e.innerHTML = "<div class='a'></div><div class='a i'></div>", e.firstChild.className = "i", 2 === e.getElementsByClassName("i").length
                }), b.sortDetached = at(function (e) {
                    return 1 & e.compareDocumentPosition(c.createElement("div"))
                }), b.getById = at(function (e) {
                    return f.appendChild(e).id = y, !t.getElementsByName || !t.getElementsByName(y).length
                }), b.getById ? (r.find.ID = function (e, t) {
                    if (typeof t.getElementById !== j && p) {
                        var n = t.getElementById(e);
                        return n && n.parentNode ? [n] : []
                    }
                }, r.filter.ID = function (e) {
                    var t = e.replace(tt, nt);
                    return function (e) {
                        return e.getAttribute("id") === t
                    }
                }) : (r.find.ID = function (e, t) {
                    if (typeof t.getElementById !== j && p) {
                        var n = t.getElementById(e);
                        return n ? n.id === e || typeof n.getAttributeNode !== j && n.getAttributeNode("id").value === e ? [n] : undefined : []
                    }
                }, r.filter.ID = function (e) {
                    var t = e.replace(tt, nt);
                    return function (e) {
                        var n = typeof e.getAttributeNode !== j && e.getAttributeNode("id");
                        return n && n.value === t
                    }
                }), r.find.TAG = b.getElementsByTagName ? function (e, t) {
                    return typeof t.getElementsByTagName !== j ? t.getElementsByTagName(e) : undefined
                } : function (e, t) {
                    var n, r = [], i = 0, o = t.getElementsByTagName(e);
                    if ("*" === e) {
                        while (n = o[i++])1 === n.nodeType && r.push(n);
                        return r
                    }
                    return o
                }, r.find.CLASS = b.getElementsByClassName && function (e, t) {
                            return typeof t.getElementsByClassName !== j && p ? t.getElementsByClassName(e) : undefined
                        }, d = [], h = [], (b.qsa = it(t.querySelectorAll)) && (at(function (e) {
                    e.innerHTML = "<select><option selected=''></option></select>", e.querySelectorAll("[selected]").length || h.push("\\[" + R + "*(?:value|" + P + ")"), e.querySelectorAll(":checked").length || h.push(":checked")
                }), at(function (e) {
                    var t = c.createElement("input");
                    t.setAttribute("type", "hidden"), e.appendChild(t).setAttribute("t", ""), e.querySelectorAll("[t^='']").length && h.push("[*^$]=" + R + "*(?:''|\"\")"), e.querySelectorAll(":enabled").length || h.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), h.push(",.*:")
                })), (b.matchesSelector = it(g = f.webkitMatchesSelector || f.mozMatchesSelector || f.oMatchesSelector || f.msMatchesSelector)) && at(function (e) {
                    b.disconnectedMatch = g.call(e, "div"), g.call(e, "[s!='']:x"), d.push("!=", B)
                }), h = h.length && RegExp(h.join("|")), d = d.length && RegExp(d.join("|")), m = it(f.contains) || f.compareDocumentPosition ? function (e, t) {
                    var n = 9 === e.nodeType ? e.documentElement : e, r = t && t.parentNode;
                    return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r)))
                } : function (e, t) {
                    if (t)while (t = t.parentNode)if (t === e)return !0;
                    return !1
                }, S = f.compareDocumentPosition ? function (e, n) {
                    if (e === n)return E = !0, 0;
                    var r = n.compareDocumentPosition && e.compareDocumentPosition && e.compareDocumentPosition(n);
                    return r ? 1 & r || !b.sortDetached && n.compareDocumentPosition(e) === r ? e === t || m(v, e) ? -1 : n === t || m(v, n) ? 1 : u ? F.call(u, e) - F.call(u, n) : 0 : 4 & r ? -1 : 1 : e.compareDocumentPosition ? -1 : 1
                } : function (e, n) {
                    var r, i = 0, o = e.parentNode, s = n.parentNode, a = [e], l = [n];
                    if (e === n)return E = !0, 0;
                    if (!o || !s)return e === t ? -1 : n === t ? 1 : o ? -1 : s ? 1 : u ? F.call(u, e) - F.call(u, n) : 0;
                    if (o === s)return lt(e, n);
                    r = e;
                    while (r = r.parentNode)a.unshift(r);
                    r = n;
                    while (r = r.parentNode)l.unshift(r);
                    while (a[i] === l[i])i++;
                    return i ? lt(a[i], l[i]) : a[i] === v ? -1 : l[i] === v ? 1 : 0
                }, c) : c
            }, ut.matches = function (e, t) {
                return ut(e, null, null, t)
            }, ut.matchesSelector = function (e, t) {
                if ((e.ownerDocument || e) !== c && l(e), t = t.replace(U, "='$1']"), !(!b.matchesSelector || !p || d && d.test(t) || h && h.test(t)))try {
                    var n = g.call(e, t);
                    if (n || b.disconnectedMatch || e.document && 11 !== e.document.nodeType)return n
                } catch (r) {
                }
                return ut(t, c, null, [e]).length > 0
            }, ut.contains = function (e, t) {
                return (e.ownerDocument || e) !== c && l(e), m(e, t)
            }, ut.attr = function (e, t) {
                (e.ownerDocument || e) !== c && l(e);
                var n = r.attrHandle[t.toLowerCase()], i = n && n(e, t, !p);
                return i === undefined ? b.attributes || !p ? e.getAttribute(t) : (i = e.getAttributeNode(t)) && i.specified ? i.value : null : i
            }, ut.error = function (e) {
                throw Error("Syntax error, unrecognized expression: " + e)
            }, ut.uniqueSort = function (e) {
                var t, n = [], r = 0, i = 0;
                if (E = !b.detectDuplicates, u = !b.sortStable && e.slice(0), e.sort(S), E) {
                    while (t = e[i++])t === e[i] && (r = n.push(i));
                    while (r--)e.splice(n[r], 1)
                }
                return e
            };
            function lt(e, t) {
                var n = t && e, r = n && (~t.sourceIndex || D) - (~e.sourceIndex || D);
                if (r)return r;
                if (n)while (n = n.nextSibling)if (n === t)return -1;
                return e ? 1 : -1
            }

            function ct(e, t, n) {
                var r;
                return n ? undefined : (r = e.getAttributeNode(t)) && r.specified ? r.value : e[t] === !0 ? t.toLowerCase() : null
            }

            function ft(e, t, n) {
                var r;
                return n ? undefined : r = e.getAttribute(t, "type" === t.toLowerCase() ? 1 : 2)
            }

            function pt(e) {
                return function (t) {
                    var n = t.nodeName.toLowerCase();
                    return "input" === n && t.type === e
                }
            }

            function ht(e) {
                return function (t) {
                    var n = t.nodeName.toLowerCase();
                    return ("input" === n || "button" === n) && t.type === e
                }
            }

            function dt(e) {
                return st(function (t) {
                    return t = +t, st(function (n, r) {
                        var i, o = e([], n.length, t), s = o.length;
                        while (s--)n[i = o[s]] && (n[i] = !(r[i] = n[i]))
                    })
                })
            }

            i = ut.getText = function (e) {
                var t, n = "", r = 0, o = e.nodeType;
                if (o) {
                    if (1 === o || 9 === o || 11 === o) {
                        if ("string" == typeof e.textContent)return e.textContent;
                        for (e = e.firstChild; e; e = e.nextSibling)n += i(e)
                    } else if (3 === o || 4 === o)return e.nodeValue
                } else for (; t = e[r]; r++)n += i(t);
                return n
            }, r = ut.selectors = {
                cacheLength: 50, createPseudo: st, match: G, attrHandle: {}, find: {}, relative: {">": {dir: "parentNode", first: !0}, " ": {dir: "parentNode"}, "+": {dir: "previousSibling", first: !0}, "~": {dir: "previousSibling"}}, preFilter: {
                    ATTR: function (e) {
                        return e[1] = e[1].replace(tt, nt), e[3] = (e[4] || e[5] || "").replace(tt, nt), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4)
                    }, CHILD: function (e) {
                        return e[1] = e[1].toLowerCase(), "nth" === e[1].slice(0, 3) ? (e[3] || ut.error(e[0]), e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])), e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && ut.error(e[0]), e
                    }, PSEUDO: function (e) {
                        var t, n = !e[5] && e[2];
                        return G.CHILD.test(e[0]) ? null : (e[4] ? e[2] = e[4] : n && Y.test(n) && (t = gt(n, !0)) && (t = n.indexOf(")", n.length - t) - n.length) && (e[0] = e[0].slice(0, t), e[2] = n.slice(0, t)), e.slice(0, 3))
                    }
                }, filter: {
                    TAG: function (e) {
                        var t = e.replace(tt, nt).toLowerCase();
                        return "*" === e ? function () {
                            return !0
                        } : function (e) {
                            return e.nodeName && e.nodeName.toLowerCase() === t
                        }
                    }, CLASS: function (e) {
                        var t = C[e + " "];
                        return t || (t = RegExp("(^|" + R + ")" + e + "(" + R + "|$)")) && C(e, function (e) {
                                    return t.test("string" == typeof e.className && e.className || typeof e.getAttribute !== j && e.getAttribute("class") || "")
                                })
                    }, ATTR: function (e, t, n) {
                        return function (r) {
                            var i = ut.attr(r, e);
                            return null == i ? "!=" === t : t ? (i += "", "=" === t ? i === n : "!=" === t ? i !== n : "^=" === t ? n && 0 === i.indexOf(n) : "*=" === t ? n && i.indexOf(n) > -1 : "$=" === t ? n && i.slice(-n.length) === n : "~=" === t ? (" " + i + " ").indexOf(n) > -1 : "|=" === t ? i === n || i.slice(0, n.length + 1) === n + "-" : !1) : !0
                        }
                    }, CHILD: function (e, t, n, r, i) {
                        var o = "nth" !== e.slice(0, 3), s = "last" !== e.slice(-4), a = "of-type" === t;
                        return 1 === r && 0 === i ? function (e) {
                            return !!e.parentNode
                        } : function (t, n, u) {
                            var l, c, f, p, h, d, g = o !== s ? "nextSibling" : "previousSibling", m = t.parentNode, v = a && t.nodeName.toLowerCase(), x = !u && !a;
                            if (m) {
                                if (o) {
                                    while (g) {
                                        f = t;
                                        while (f = f[g])if (a ? f.nodeName.toLowerCase() === v : 1 === f.nodeType)return !1;
                                        d = g = "only" === e && !d && "nextSibling"
                                    }
                                    return !0
                                }
                                if (d = [s ? m.firstChild : m.lastChild], s && x) {
                                    c = m[y] || (m[y] = {}), l = c[e] || [], h = l[0] === w && l[1], p = l[0] === w && l[2], f = h && m.childNodes[h];
                                    while (f = ++h && f && f[g] || (p = h = 0) || d.pop())if (1 === f.nodeType && ++p && f === t) {
                                        c[e] = [w, h, p];
                                        break
                                    }
                                } else if (x && (l = (t[y] || (t[y] = {}))[e]) && l[0] === w)p = l[1]; else while (f = ++h && f && f[g] || (p = h = 0) || d.pop())if ((a ? f.nodeName.toLowerCase() === v : 1 === f.nodeType) && ++p && (x && ((f[y] || (f[y] = {}))[e] = [w, p]), f === t))break;
                                return p -= i, p === r || 0 === p % r && p / r >= 0
                            }
                        }
                    }, PSEUDO: function (e, t) {
                        var n, i = r.pseudos[e] || r.setFilters[e.toLowerCase()] || ut.error("unsupported pseudo: " + e);
                        return i[y] ? i(t) : i.length > 1 ? (n = [e, e, "", t], r.setFilters.hasOwnProperty(e.toLowerCase()) ? st(function (e, n) {
                            var r, o = i(e, t), s = o.length;
                            while (s--)r = F.call(e, o[s]), e[r] = !(n[r] = o[s])
                        }) : function (e) {
                            return i(e, 0, n)
                        }) : i
                    }
                }, pseudos: {
                    not: st(function (e) {
                        var t = [], n = [], r = s(e.replace(I, "$1"));
                        return r[y] ? st(function (e, t, n, i) {
                            var o, s = r(e, null, i, []), a = e.length;
                            while (a--)(o = s[a]) && (e[a] = !(t[a] = o))
                        }) : function (e, i, o) {
                            return t[0] = e, r(t, null, o, n), !n.pop()
                        }
                    }), has: st(function (e) {
                        return function (t) {
                            return ut(e, t).length > 0
                        }
                    }), contains: st(function (e) {
                        return function (t) {
                            return (t.textContent || t.innerText || i(t)).indexOf(e) > -1
                        }
                    }), lang: st(function (e) {
                        return V.test(e || "") || ut.error("unsupported lang: " + e), e = e.replace(tt, nt).toLowerCase(), function (t) {
                            var n;
                            do if (n = p ? t.lang : t.getAttribute("xml:lang") || t.getAttribute("lang"))return n = n.toLowerCase(), n === e || 0 === n.indexOf(e + "-"); while ((t = t.parentNode) && 1 === t.nodeType);
                            return !1
                        }
                    }), target: function (t) {
                        var n = e.location && e.location.hash;
                        return n && n.slice(1) === t.id
                    }, root: function (e) {
                        return e === f
                    }, focus: function (e) {
                        return e === c.activeElement && (!c.hasFocus || c.hasFocus()) && !!(e.type || e.href || ~e.tabIndex)
                    }, enabled: function (e) {
                        return e.disabled === !1
                    }, disabled: function (e) {
                        return e.disabled === !0
                    }, checked: function (e) {
                        var t = e.nodeName.toLowerCase();
                        return "input" === t && !!e.checked || "option" === t && !!e.selected
                    }, selected: function (e) {
                        return e.parentNode && e.parentNode.selectedIndex, e.selected === !0
                    }, empty: function (e) {
                        for (e = e.firstChild; e; e = e.nextSibling)if (e.nodeName > "@" || 3 === e.nodeType || 4 === e.nodeType)return !1;
                        return !0
                    }, parent: function (e) {
                        return !r.pseudos.empty(e)
                    }, header: function (e) {
                        return Z.test(e.nodeName)
                    }, input: function (e) {
                        return K.test(e.nodeName)
                    }, button: function (e) {
                        var t = e.nodeName.toLowerCase();
                        return "input" === t && "button" === e.type || "button" === t
                    }, text: function (e) {
                        var t;
                        return "input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || t.toLowerCase() === e.type)
                    }, first: dt(function () {
                        return [0]
                    }), last: dt(function (e, t) {
                        return [t - 1]
                    }), eq: dt(function (e, t, n) {
                        return [0 > n ? n + t : n]
                    }), even: dt(function (e, t) {
                        var n = 0;
                        for (; t > n; n += 2)e.push(n);
                        return e
                    }), odd: dt(function (e, t) {
                        var n = 1;
                        for (; t > n; n += 2)e.push(n);
                        return e
                    }), lt: dt(function (e, t, n) {
                        var r = 0 > n ? n + t : n;
                        for (; --r >= 0;)e.push(r);
                        return e
                    }), gt: dt(function (e, t, n) {
                        var r = 0 > n ? n + t : n;
                        for (; t > ++r;)e.push(r);
                        return e
                    })
                }
            };
            for (t in{radio: !0, checkbox: !0, file: !0, password: !0, image: !0})r.pseudos[t] = pt(t);
            for (t in{submit: !0, reset: !0})r.pseudos[t] = ht(t);
            function gt(e, t) {
                var n, i, o, s, a, u, l, c = k[e + " "];
                if (c)return t ? 0 : c.slice(0);
                a = e, u = [], l = r.preFilter;
                while (a) {
                    (!n || (i = z.exec(a))) && (i && (a = a.slice(i[0].length) || a), u.push(o = [])), n = !1, (i = _.exec(a)) && (n = i.shift(), o.push({value: n, type: i[0].replace(I, " ")}), a = a.slice(n.length));
                    for (s in r.filter)!(i = G[s].exec(a)) || l[s] && !(i = l[s](i)) || (n = i.shift(), o.push({value: n, type: s, matches: i}), a = a.slice(n.length));
                    if (!n)break
                }
                return t ? a.length : a ? ut.error(e) : k(e, u).slice(0)
            }

            function mt(e) {
                var t = 0, n = e.length, r = "";
                for (; n > t; t++)r += e[t].value;
                return r
            }

            function yt(e, t, r) {
                var i = t.dir, o = r && "parentNode" === i, s = T++;
                return t.first ? function (t, n, r) {
                    while (t = t[i])if (1 === t.nodeType || o)return e(t, n, r)
                } : function (t, r, a) {
                    var u, l, c, f = w + " " + s;
                    if (a) {
                        while (t = t[i])if ((1 === t.nodeType || o) && e(t, r, a))return !0
                    } else while (t = t[i])if (1 === t.nodeType || o)if (c = t[y] || (t[y] = {}), (l = c[i]) && l[0] === f) {
                        if ((u = l[1]) === !0 || u === n)return u === !0
                    } else if (l = c[i] = [f], l[1] = e(t, r, a) || n, l[1] === !0)return !0
                }
            }

            function vt(e) {
                return e.length > 1 ? function (t, n, r) {
                    var i = e.length;
                    while (i--)if (!e[i](t, n, r))return !1;
                    return !0
                } : e[0]
            }

            function xt(e, t, n, r, i) {
                var o, s = [], a = 0, u = e.length, l = null != t;
                for (; u > a; a++)(o = e[a]) && (!n || n(o, r, i)) && (s.push(o), l && t.push(a));
                return s
            }

            function bt(e, t, n, r, i, o) {
                return r && !r[y] && (r = bt(r)), i && !i[y] && (i = bt(i, o)), st(function (o, s, a, u) {
                    var l, c, f, p = [], h = [], d = s.length, g = o || Ct(t || "*", a.nodeType ? [a] : a, []), m = !e || !o && t ? g : xt(g, p, e, a, u), y = n ? i || (o ? e : d || r) ? [] : s : m;
                    if (n && n(m, y, a, u), r) {
                        l = xt(y, h), r(l, [], a, u), c = l.length;
                        while (c--)(f = l[c]) && (y[h[c]] = !(m[h[c]] = f))
                    }
                    if (o) {
                        if (i || e) {
                            if (i) {
                                l = [], c = y.length;
                                while (c--)(f = y[c]) && l.push(m[c] = f);
                                i(null, y = [], l, u)
                            }
                            c = y.length;
                            while (c--)(f = y[c]) && (l = i ? F.call(o, f) : p[c]) > -1 && (o[l] = !(s[l] = f))
                        }
                    } else y = xt(y === s ? y.splice(d, y.length) : y), i ? i(null, s, y, u) : H.apply(s, y)
                })
            }

            function wt(e) {
                var t, n, i, o = e.length, s = r.relative[e[0].type], u = s || r.relative[" "], l = s ? 1 : 0, c = yt(function (e) {
                    return e === t
                }, u, !0), f = yt(function (e) {
                    return F.call(t, e) > -1
                }, u, !0), p = [function (e, n, r) {
                    return !s && (r || n !== a) || ((t = n).nodeType ? c(e, n, r) : f(e, n, r))
                }];
                for (; o > l; l++)if (n = r.relative[e[l].type])p = [yt(vt(p), n)]; else {
                    if (n = r.filter[e[l].type].apply(null, e[l].matches), n[y]) {
                        for (i = ++l; o > i; i++)if (r.relative[e[i].type])break;
                        return bt(l > 1 && vt(p), l > 1 && mt(e.slice(0, l - 1)).replace(I, "$1"), n, i > l && wt(e.slice(l, i)), o > i && wt(e = e.slice(i)), o > i && mt(e))
                    }
                    p.push(n)
                }
                return vt(p)
            }

            function Tt(e, t) {
                var i = 0, o = t.length > 0, s = e.length > 0, u = function (u, l, f, p, h) {
                    var d, g, m, y = [], v = 0, x = "0", b = u && [], T = null != h, C = a, k = u || s && r.find.TAG("*", h && l.parentNode || l), N = w += null == C ? 1 : Math.random() || .1;
                    for (T && (a = l !== c && l, n = i); null != (d = k[x]); x++) {
                        if (s && d) {
                            g = 0;
                            while (m = e[g++])if (m(d, l, f)) {
                                p.push(d);
                                break
                            }
                            T && (w = N, n = ++i)
                        }
                        o && ((d = !m && d) && v--, u && b.push(d))
                    }
                    if (v += x, o && x !== v) {
                        g = 0;
                        while (m = t[g++])m(b, y, l, f);
                        if (u) {
                            if (v > 0)while (x--)b[x] || y[x] || (y[x] = L.call(p));
                            y = xt(y)
                        }
                        H.apply(p, y), T && !u && y.length > 0 && v + t.length > 1 && ut.uniqueSort(p)
                    }
                    return T && (w = N, a = C), b
                };
                return o ? st(u) : u
            }

            s = ut.compile = function (e, t) {
                var n, r = [], i = [], o = N[e + " "];
                if (!o) {
                    t || (t = gt(e)), n = t.length;
                    while (n--)o = wt(t[n]), o[y] ? r.push(o) : i.push(o);
                    o = N(e, Tt(i, r))
                }
                return o
            };
            function Ct(e, t, n) {
                var r = 0, i = t.length;
                for (; i > r; r++)ut(e, t[r], n);
                return n
            }

            function kt(e, t, n, i) {
                var o, a, u, l, c, f = gt(e);
                if (!i && 1 === f.length) {
                    if (a = f[0] = f[0].slice(0), a.length > 2 && "ID" === (u = a[0]).type && 9 === t.nodeType && p && r.relative[a[1].type]) {
                        if (t = (r.find.ID(u.matches[0].replace(tt, nt), t) || [])[0], !t)return n;
                        e = e.slice(a.shift().value.length)
                    }
                    o = G.needsContext.test(e) ? 0 : a.length;
                    while (o--) {
                        if (u = a[o], r.relative[l = u.type])break;
                        if ((c = r.find[l]) && (i = c(u.matches[0].replace(tt, nt), X.test(a[0].type) && t.parentNode || t))) {
                            if (a.splice(o, 1), e = i.length && mt(a), !e)return H.apply(n, i), n;
                            break
                        }
                    }
                }
                return s(e, f)(i, t, !p, n, X.test(e)), n
            }

            r.pseudos.nth = r.pseudos.eq;
            function Nt() {
            }

            Nt.prototype = r.filters = r.pseudos, r.setFilters = new Nt, b.sortStable = y.split("").sort(S).join("") === y, l(), [0, 0].sort(S), b.detectDuplicates = E, at(function (e) {
                if (e.innerHTML = "<a href='#'></a>", "#" !== e.firstChild.getAttribute("href")) {
                    var t = "type|href|height|width".split("|"), n = t.length;
                    while (n--)r.attrHandle[t[n]] = ft
                }
            }), at(function (e) {
                if (null != e.getAttribute("disabled")) {
                    var t = P.split("|"), n = t.length;
                    while (n--)r.attrHandle[t[n]] = ct
                }
            }), x.find = ut, x.expr = ut.selectors, x.expr[":"] = x.expr.pseudos, x.unique = ut.uniqueSort, x.text = ut.getText, x.isXMLDoc = ut.isXML, x.contains = ut.contains
        }(e);
        var D = {};

        function A(e) {
            var t = D[e] = {};
            return x.each(e.match(w) || [], function (e, n) {
                t[n] = !0
            }), t
        }

        x.Callbacks = function (e) {
            e = "string" == typeof e ? D[e] || A(e) : x.extend({}, e);
            var t, n, r, i, o, s, a = [], u = !e.once && [], l = function (f) {
                for (t = e.memory && f, n = !0, s = i || 0, i = 0, o = a.length, r = !0; a && o > s; s++)if (a[s].apply(f[0], f[1]) === !1 && e.stopOnFalse) {
                    t = !1;
                    break
                }
                r = !1, a && (u ? u.length && l(u.shift()) : t ? a = [] : c.disable())
            }, c = {
                add: function () {
                    if (a) {
                        var n = a.length;
                        (function s(t) {
                            x.each(t, function (t, n) {
                                var r = x.type(n);
                                "function" === r ? e.unique && c.has(n) || a.push(n) : n && n.length && "string" !== r && s(n)
                            })
                        })(arguments), r ? o = a.length : t && (i = n, l(t))
                    }
                    return this
                }, remove: function () {
                    return a && x.each(arguments, function (e, t) {
                        var n;
                        while ((n = x.inArray(t, a, n)) > -1)a.splice(n, 1), r && (o >= n && o--, s >= n && s--)
                    }), this
                }, has: function (e) {
                    return e ? x.inArray(e, a) > -1 : !(!a || !a.length)
                }, empty: function () {
                    return a = [], o = 0, this
                }, disable: function () {
                    return a = u = t = undefined, this
                }, disabled: function () {
                    return !a
                }, lock: function () {
                    return u = undefined, t || c.disable(), this
                }, locked: function () {
                    return !u
                }, fireWith: function (e, t) {
                    return t = t || [], t = [e, t.slice ? t.slice() : t], !a || n && !u || (r ? u.push(t) : l(t)), this
                }, fire: function () {
                    return c.fireWith(this, arguments), this
                }, fired: function () {
                    return !!n
                }
            };
            return c
        }, x.extend({
            Deferred: function (e) {
                var t = [["resolve", "done", x.Callbacks("once memory"), "resolved"], ["reject", "fail", x.Callbacks("once memory"), "rejected"], ["notify", "progress", x.Callbacks("memory")]], n = "pending", r = {
                    state: function () {
                        return n
                    }, always: function () {
                        return i.done(arguments).fail(arguments), this
                    }, then: function () {
                        var e = arguments;
                        return x.Deferred(function (n) {
                            x.each(t, function (t, o) {
                                var s = o[0], a = x.isFunction(e[t]) && e[t];
                                i[o[1]](function () {
                                    var e = a && a.apply(this, arguments);
                                    e && x.isFunction(e.promise) ? e.promise().done(n.resolve).fail(n.reject).progress(n.notify) : n[s + "With"](this === r ? n.promise() : this, a ? [e] : arguments)
                                })
                            }), e = null
                        }).promise()
                    }, promise: function (e) {
                        return null != e ? x.extend(e, r) : r
                    }
                }, i = {};
                return r.pipe = r.then, x.each(t, function (e, o) {
                    var s = o[2], a = o[3];
                    r[o[1]] = s.add, a && s.add(function () {
                        n = a
                    }, t[1 ^ e][2].disable, t[2][2].lock), i[o[0]] = function () {
                        return i[o[0] + "With"](this === i ? r : this, arguments), this
                    }, i[o[0] + "With"] = s.fireWith
                }), r.promise(i), e && e.call(i, i), i
            }, when: function (e) {
                var t = 0, n = d.call(arguments), r = n.length, i = 1 !== r || e && x.isFunction(e.promise) ? r : 0, o = 1 === i ? e : x.Deferred(), s = function (e, t, n) {
                    return function (r) {
                        t[e] = this, n[e] = arguments.length > 1 ? d.call(arguments) : r, n === a ? o.notifyWith(t, n) : --i || o.resolveWith(t, n)
                    }
                }, a, u, l;
                if (r > 1)for (a = Array(r), u = Array(r), l = Array(r); r > t; t++)n[t] && x.isFunction(n[t].promise) ? n[t].promise().done(s(t, l, n)).fail(o.reject).progress(s(t, u, a)) : --i;
                return i || o.resolveWith(l, n), o.promise()
            }
        }), x.support = function (t) {
            var n = o.createElement("input"), r = o.createDocumentFragment(), i = o.createElement("div"), s = o.createElement("select"), a = s.appendChild(o.createElement("option"));
            return n.type ? (n.type = "checkbox", t.checkOn = "" !== n.value, t.optSelected = a.selected, t.reliableMarginRight = !0, t.boxSizingReliable = !0, t.pixelPosition = !1, n.checked = !0, t.noCloneChecked = n.cloneNode(!0).checked, s.disabled = !0, t.optDisabled = !a.disabled, n = o.createElement("input"), n.value = "t", n.type = "radio", t.radioValue = "t" === n.value, n.setAttribute("checked", "t"), n.setAttribute("name", "t"), r.appendChild(n), t.checkClone = r.cloneNode(!0).cloneNode(!0).lastChild.checked, t.focusinBubbles = "onfocusin" in e, i.style.backgroundClip = "content-box", i.cloneNode(!0).style.backgroundClip = "", t.clearCloneStyle = "content-box" === i.style.backgroundClip, x(function () {
                var n, r, s = "padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box", a = o.getElementsByTagName("body")[0];
                a && (n = o.createElement("div"), n.style.cssText = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px", a.appendChild(n).appendChild(i), i.innerHTML = "", i.style.cssText = "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%", x.swap(a, null != a.style.zoom ? {zoom: 1} : {}, function () {
                    t.boxSizing = 4 === i.offsetWidth
                }), e.getComputedStyle && (t.pixelPosition = "1%" !== (e.getComputedStyle(i, null) || {}).top, t.boxSizingReliable = "4px" === (e.getComputedStyle(i, null) || {width: "4px"}).width, r = i.appendChild(o.createElement("div")), r.style.cssText = i.style.cssText = s, r.style.marginRight = r.style.width = "0", i.style.width = "1px", t.reliableMarginRight = !parseFloat((e.getComputedStyle(r, null) || {}).marginRight)), a.removeChild(n))
            }), t) : t
        }({});
        var L, q, H = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/, O = /([A-Z])/g;

        function F() {
            Object.defineProperty(this.cache = {}, 0, {
                get: function () {
                    return {}
                }
            }), this.expando = x.expando + Math.random()
        }

        F.uid = 1, F.accepts = function (e) {
            return e.nodeType ? 1 === e.nodeType || 9 === e.nodeType : !0
        }, F.prototype = {
            key: function (e) {
                if (!F.accepts(e))return 0;
                var t = {}, n = e[this.expando];
                if (!n) {
                    n = F.uid++;
                    try {
                        t[this.expando] = {value: n}, Object.defineProperties(e, t)
                    } catch (r) {
                        t[this.expando] = n, x.extend(e, t)
                    }
                }
                return this.cache[n] || (this.cache[n] = {}), n
            }, set: function (e, t, n) {
                var r, i = this.key(e), o = this.cache[i];
                if ("string" == typeof t)o[t] = n; else if (x.isEmptyObject(o))this.cache[i] = t; else for (r in t)o[r] = t[r]
            }, get: function (e, t) {
                var n = this.cache[this.key(e)];
                return t === undefined ? n : n[t]
            }, access: function (e, t, n) {
                return t === undefined || t && "string" == typeof t && n === undefined ? this.get(e, t) : (this.set(e, t, n), n !== undefined ? n : t)
            }, remove: function (e, t) {
                var n, r, i = this.key(e), o = this.cache[i];
                if (t === undefined)this.cache[i] = {}; else {
                    x.isArray(t) ? r = t.concat(t.map(x.camelCase)) : t in o ? r = [t] : (r = x.camelCase(t), r = r in o ? [r] : r.match(w) || []), n = r.length;
                    while (n--)delete o[r[n]]
                }
            }, hasData: function (e) {
                return !x.isEmptyObject(this.cache[e[this.expando]] || {})
            }, discard: function (e) {
                delete this.cache[this.key(e)]
            }
        }, L = new F, q = new F, x.extend({
            acceptData: F.accepts, hasData: function (e) {
                return L.hasData(e) || q.hasData(e)
            }, data: function (e, t, n) {
                return L.access(e, t, n)
            }, removeData: function (e, t) {
                L.remove(e, t)
            }, _data: function (e, t, n) {
                return q.access(e, t, n)
            }, _removeData: function (e, t) {
                q.remove(e, t)
            }
        }), x.fn.extend({
            data: function (e, t) {
                var n, r, i = this[0], o = 0, s = null;
                if (e === undefined) {
                    if (this.length && (s = L.get(i), 1 === i.nodeType && !q.get(i, "hasDataAttrs"))) {
                        for (n = i.attributes; n.length > o; o++)r = n[o].name, 0 === r.indexOf("data-") && (r = x.camelCase(r.substring(5)), P(i, r, s[r]));
                        q.set(i, "hasDataAttrs", !0)
                    }
                    return s
                }
                return "object" == typeof e ? this.each(function () {
                    L.set(this, e)
                }) : x.access(this, function (t) {
                    var n, r = x.camelCase(e);
                    if (i && t === undefined) {
                        if (n = L.get(i, e), n !== undefined)return n;
                        if (n = L.get(i, r), n !== undefined)return n;
                        if (n = P(i, r, undefined), n !== undefined)return n
                    } else this.each(function () {
                        var n = L.get(this, r);
                        L.set(this, r, t), -1 !== e.indexOf("-") && n !== undefined && L.set(this, e, t)
                    })
                }, null, t, arguments.length > 1, null, !0)
            }, removeData: function (e) {
                return this.each(function () {
                    L.remove(this, e)
                })
            }
        });
        function P(e, t, n) {
            var r;
            if (n === undefined && 1 === e.nodeType)if (r = "data-" + t.replace(O, "-$1").toLowerCase(), n = e.getAttribute(r), "string" == typeof n) {
                try {
                    n = "true" === n ? !0 : "false" === n ? !1 : "null" === n ? null : +n + "" === n ? +n : H.test(n) ? JSON.parse(n) : n
                } catch (i) {
                }
                L.set(e, t, n)
            } else n = undefined;
            return n
        }

        x.extend({
            queue: function (e, t, n) {
                var r;
                return e ? (t = (t || "fx") + "queue", r = q.get(e, t), n && (!r || x.isArray(n) ? r = q.access(e, t, x.makeArray(n)) : r.push(n)), r || []) : undefined
            }, dequeue: function (e, t) {
                t = t || "fx";
                var n = x.queue(e, t), r = n.length, i = n.shift(), o = x._queueHooks(e, t), s = function () {
                    x.dequeue(e, t)
                };
                "inprogress" === i && (i = n.shift(), r--), o.cur = i, i && ("fx" === t && n.unshift("inprogress"), delete o.stop, i.call(e, s, o)), !r && o && o.empty.fire()
            }, _queueHooks: function (e, t) {
                var n = t + "queueHooks";
                return q.get(e, n) || q.access(e, n, {
                            empty: x.Callbacks("once memory").add(function () {
                                q.remove(e, [t + "queue", n])
                            })
                        })
            }
        }), x.fn.extend({
            queue: function (e, t) {
                var n = 2;
                return "string" != typeof e && (t = e, e = "fx", n--), n > arguments.length ? x.queue(this[0], e) : t === undefined ? this : this.each(function () {
                    var n = x.queue(this, e, t);
                    x._queueHooks(this, e), "fx" === e && "inprogress" !== n[0] && x.dequeue(this, e)
                })
            }, dequeue: function (e) {
                return this.each(function () {
                    x.dequeue(this, e)
                })
            }, delay: function (e, t) {
                return e = x.fx ? x.fx.speeds[e] || e : e, t = t || "fx", this.queue(t, function (t, n) {
                    var r = setTimeout(t, e);
                    n.stop = function () {
                        clearTimeout(r)
                    }
                })
            }, clearQueue: function (e) {
                return this.queue(e || "fx", [])
            }, promise: function (e, t) {
                var n, r = 1, i = x.Deferred(), o = this, s = this.length, a = function () {
                    --r || i.resolveWith(o, [o])
                };
                "string" != typeof e && (t = e, e = undefined), e = e || "fx";
                while (s--)n = q.get(o[s], e + "queueHooks"), n && n.empty && (r++, n.empty.add(a));
                return a(), i.promise(t)
            }
        });
        var R, M, W = /[\t\r\n]/g, $ = /\r/g, B = /^(?:input|select|textarea|button)$/i;
        x.fn.extend({
            attr: function (e, t) {
                return x.access(this, x.attr, e, t, arguments.length > 1)
            }, removeAttr: function (e) {
                return this.each(function () {
                    x.removeAttr(this, e)
                })
            }, prop: function (e, t) {
                return x.access(this, x.prop, e, t, arguments.length > 1)
            }, removeProp: function (e) {
                return this.each(function () {
                    delete this[x.propFix[e] || e]
                })
            }, addClass: function (e) {
                var t, n, r, i, o, s = 0, a = this.length, u = "string" == typeof e && e;
                if (x.isFunction(e))return this.each(function (t) {
                    x(this).addClass(e.call(this, t, this.className))
                });
                if (u)for (t = (e || "").match(w) || []; a > s; s++)if (n = this[s], r = 1 === n.nodeType && (n.className ? (" " + n.className + " ").replace(W, " ") : " ")) {
                    o = 0;
                    while (i = t[o++])0 > r.indexOf(" " + i + " ") && (r += i + " ");
                    n.className = x.trim(r)
                }
                return this
            }, removeClass: function (e) {
                var t, n, r, i, o, s = 0, a = this.length, u = 0 === arguments.length || "string" == typeof e && e;
                if (x.isFunction(e))return this.each(function (t) {
                    x(this).removeClass(e.call(this, t, this.className))
                });
                if (u)for (t = (e || "").match(w) || []; a > s; s++)if (n = this[s], r = 1 === n.nodeType && (n.className ? (" " + n.className + " ").replace(W, " ") : "")) {
                    o = 0;
                    while (i = t[o++])while (r.indexOf(" " + i + " ") >= 0)r = r.replace(" " + i + " ", " ");
                    n.className = e ? x.trim(r) : ""
                }
                return this
            }, toggleClass: function (e, t) {
                var n = typeof e, i = "boolean" == typeof t;
                return x.isFunction(e) ? this.each(function (n) {
                    x(this).toggleClass(e.call(this, n, this.className, t), t)
                }) : this.each(function () {
                    if ("string" === n) {
                        var o, s = 0, a = x(this), u = t, l = e.match(w) || [];
                        while (o = l[s++])u = i ? u : !a.hasClass(o), a[u ? "addClass" : "removeClass"](o)
                    } else(n === r || "boolean" === n) && (this.className && q.set(this, "__className__", this.className), this.className = this.className || e === !1 ? "" : q.get(this, "__className__") || "")
                })
            }, hasClass: function (e) {
                var t = " " + e + " ", n = 0, r = this.length;
                for (; r > n; n++)if (1 === this[n].nodeType && (" " + this[n].className + " ").replace(W, " ").indexOf(t) >= 0)return !0;
                return !1
            }, val: function (e) {
                var t, n, r, i = this[0];
                {
                    if (arguments.length)return r = x.isFunction(e), this.each(function (n) {
                        var i, o = x(this);
                        1 === this.nodeType && (i = r ? e.call(this, n, o.val()) : e, null == i ? i = "" : "number" == typeof i ? i += "" : x.isArray(i) && (i = x.map(i, function (e) {
                            return null == e ? "" : e + ""
                        })), t = x.valHooks[this.type] || x.valHooks[this.nodeName.toLowerCase()], t && "set" in t && t.set(this, i, "value") !== undefined || (this.value = i))
                    });
                    if (i)return t = x.valHooks[i.type] || x.valHooks[i.nodeName.toLowerCase()], t && "get" in t && (n = t.get(i, "value")) !== undefined ? n : (n = i.value, "string" == typeof n ? n.replace($, "") : null == n ? "" : n)
                }
            }
        }), x.extend({
            valHooks: {
                option: {
                    get: function (e) {
                        var t = e.attributes.value;
                        return !t || t.specified ? e.value : e.text
                    }
                }, select: {
                    get: function (e) {
                        var t, n, r = e.options, i = e.selectedIndex, o = "select-one" === e.type || 0 > i, s = o ? null : [], a = o ? i + 1 : r.length, u = 0 > i ? a : o ? i : 0;
                        for (; a > u; u++)if (n = r[u], !(!n.selected && u !== i || (x.support.optDisabled ? n.disabled : null !== n.getAttribute("disabled")) || n.parentNode.disabled && x.nodeName(n.parentNode, "optgroup"))) {
                            if (t = x(n).val(), o)return t;
                            s.push(t)
                        }
                        return s
                    }, set: function (e, t) {
                        var n, r, i = e.options, o = x.makeArray(t), s = i.length;
                        while (s--)r = i[s], (r.selected = x.inArray(x(r).val(), o) >= 0) && (n = !0);
                        return n || (e.selectedIndex = -1), o
                    }
                }
            }, attr: function (e, t, n) {
                var i, o, s = e.nodeType;
                if (e && 3 !== s && 8 !== s && 2 !== s)return typeof e.getAttribute === r ? x.prop(e, t, n) : (1 === s && x.isXMLDoc(e) || (t = t.toLowerCase(), i = x.attrHooks[t] || (x.expr.match.boolean.test(t) ? M : R)), n === undefined ? i && "get" in i && null !== (o = i.get(e, t)) ? o : (o = x.find.attr(e, t), null == o ? undefined : o) : null !== n ? i && "set" in i && (o = i.set(e, n, t)) !== undefined ? o : (e.setAttribute(t, n + ""), n) : (x.removeAttr(e, t), undefined))
            }, removeAttr: function (e, t) {
                var n, r, i = 0, o = t && t.match(w);
                if (o && 1 === e.nodeType)while (n = o[i++])r = x.propFix[n] || n, x.expr.match.boolean.test(n) && (e[r] = !1), e.removeAttribute(n)
            }, attrHooks: {
                type: {
                    set: function (e, t) {
                        if (!x.support.radioValue && "radio" === t && x.nodeName(e, "input")) {
                            var n = e.value;
                            return e.setAttribute("type", t), n && (e.value = n), t
                        }
                    }
                }
            }, propFix: {"for": "htmlFor", "class": "className"}, prop: function (e, t, n) {
                var r, i, o, s = e.nodeType;
                if (e && 3 !== s && 8 !== s && 2 !== s)return o = 1 !== s || !x.isXMLDoc(e), o && (t = x.propFix[t] || t, i = x.propHooks[t]), n !== undefined ? i && "set" in i && (r = i.set(e, n, t)) !== undefined ? r : e[t] = n : i && "get" in i && null !== (r = i.get(e, t)) ? r : e[t]
            }, propHooks: {
                tabIndex: {
                    get: function (e) {
                        return e.hasAttribute("tabindex") || B.test(e.nodeName) || e.href ? e.tabIndex : -1
                    }
                }
            }
        }), M = {
            set: function (e, t, n) {
                return t === !1 ? x.removeAttr(e, n) : e.setAttribute(n, n), n
            }
        }, x.each(x.expr.match.boolean.source.match(/\w+/g), function (e, t) {
            var n = x.expr.attrHandle[t] || x.find.attr;
            x.expr.attrHandle[t] = function (e, t, r) {
                var i = x.expr.attrHandle[t], o = r ? undefined : (x.expr.attrHandle[t] = undefined) != n(e, t, r) ? t.toLowerCase() : null;
                return x.expr.attrHandle[t] = i, o
            }
        }), x.support.optSelected || (x.propHooks.selected = {
            get: function (e) {
                var t = e.parentNode;
                return t && t.parentNode && t.parentNode.selectedIndex, null
            }
        }), x.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function () {
            x.propFix[this.toLowerCase()] = this
        }), x.each(["radio", "checkbox"], function () {
            x.valHooks[this] = {
                set: function (e, t) {
                    return x.isArray(t) ? e.checked = x.inArray(x(e).val(), t) >= 0 : undefined
                }
            }, x.support.checkOn || (x.valHooks[this].get = function (e) {
                return null === e.getAttribute("value") ? "on" : e.value
            })
        });
        var I = /^key/, z = /^(?:mouse|contextmenu)|click/, _ = /^(?:focusinfocus|focusoutblur)$/, X = /^([^.]*)(?:\.(.+)|)$/;

        function U() {
            return !0
        }

        function Y() {
            return !1
        }

        function V() {
            try {
                return o.activeElement
            } catch (e) {
            }
        }

        x.event = {
            global: {}, add: function (e, t, n, i, o) {
                var s, a, u, l, c, f, p, h, d, g, m, y = q.get(e);
                if (y) {
                    n.handler && (s = n, n = s.handler, o = s.selector), n.guid || (n.guid = x.guid++), (l = y.events) || (l = y.events = {}), (a = y.handle) || (a = y.handle = function (e) {
                        return typeof x === r || e && x.event.triggered === e.type ? undefined : x.event.dispatch.apply(a.elem, arguments)
                    }, a.elem = e), t = (t || "").match(w) || [""], c = t.length;
                    while (c--)u = X.exec(t[c]) || [], d = m = u[1], g = (u[2] || "").split(".").sort(), d && (p = x.event.special[d] || {}, d = (o ? p.delegateType : p.bindType) || d, p = x.event.special[d] || {}, f = x.extend({
                        type: d,
                        origType: m,
                        data: i,
                        handler: n,
                        guid: n.guid,
                        selector: o,
                        needsContext: o && x.expr.match.needsContext.test(o),
                        namespace: g.join(".")
                    }, s), (h = l[d]) || (h = l[d] = [], h.delegateCount = 0, p.setup && p.setup.call(e, i, g, a) !== !1 || e.addEventListener && e.addEventListener(d, a, !1)), p.add && (p.add.call(e, f), f.handler.guid || (f.handler.guid = n.guid)), o ? h.splice(h.delegateCount++, 0, f) : h.push(f), x.event.global[d] = !0);
                    e = null
                }
            }, remove: function (e, t, n, r, i) {
                var o, s, a, u, l, c, f, p, h, d, g, m = q.hasData(e) && q.get(e);
                if (m && (u = m.events)) {
                    t = (t || "").match(w) || [""], l = t.length;
                    while (l--)if (a = X.exec(t[l]) || [], h = g = a[1], d = (a[2] || "").split(".").sort(), h) {
                        f = x.event.special[h] || {}, h = (r ? f.delegateType : f.bindType) || h, p = u[h] || [], a = a[2] && RegExp("(^|\\.)" + d.join("\\.(?:.*\\.|)") + "(\\.|$)"), s = o = p.length;
                        while (o--)c = p[o], !i && g !== c.origType || n && n.guid !== c.guid || a && !a.test(c.namespace) || r && r !== c.selector && ("**" !== r || !c.selector) || (p.splice(o, 1), c.selector && p.delegateCount--, f.remove && f.remove.call(e, c));
                        s && !p.length && (f.teardown && f.teardown.call(e, d, m.handle) !== !1 || x.removeEvent(e, h, m.handle), delete u[h])
                    } else for (h in u)x.event.remove(e, h + t[l], n, r, !0);
                    x.isEmptyObject(u) && (delete m.handle, q.remove(e, "events"))
                }
            }, trigger: function (t, n, r, i) {
                var s, a, u, l, c, f, p, h = [r || o], d = y.call(t, "type") ? t.type : t, g = y.call(t, "namespace") ? t.namespace.split(".") : [];
                if (a = u = r = r || o, 3 !== r.nodeType && 8 !== r.nodeType && !_.test(d + x.event.triggered) && (d.indexOf(".") >= 0 && (g = d.split("."), d = g.shift(), g.sort()), c = 0 > d.indexOf(":") && "on" + d, t = t[x.expando] ? t : new x.Event(d, "object" == typeof t && t), t.isTrigger = i ? 2 : 3, t.namespace = g.join("."), t.namespace_re = t.namespace ? RegExp("(^|\\.)" + g.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, t.result = undefined, t.target || (t.target = r), n = null == n ? [t] : x.makeArray(n, [t]), p = x.event.special[d] || {}, i || !p.trigger || p.trigger.apply(r, n) !== !1)) {
                    if (!i && !p.noBubble && !x.isWindow(r)) {
                        for (l = p.delegateType || d, _.test(l + d) || (a = a.parentNode); a; a = a.parentNode)h.push(a), u = a;
                        u === (r.ownerDocument || o) && h.push(u.defaultView || u.parentWindow || e)
                    }
                    s = 0;
                    while ((a = h[s++]) && !t.isPropagationStopped())t.type = s > 1 ? l : p.bindType || d, f = (q.get(a, "events") || {})[t.type] && q.get(a, "handle"), f && f.apply(a, n), f = c && a[c], f && x.acceptData(a) && f.apply && f.apply(a, n) === !1 && t.preventDefault();
                    return t.type = d, i || t.isDefaultPrevented() || p._default && p._default.apply(h.pop(), n) !== !1 || !x.acceptData(r) || c && x.isFunction(r[d]) && !x.isWindow(r) && (u = r[c], u && (r[c] = null), x.event.triggered = d, r[d](), x.event.triggered = undefined, u && (r[c] = u)), t.result
                }
            }, dispatch: function (e) {
                e = x.event.fix(e);
                var t, n, r, i, o, s = [], a = d.call(arguments), u = (q.get(this, "events") || {})[e.type] || [], l = x.event.special[e.type] || {};
                if (a[0] = e, e.delegateTarget = this, !l.preDispatch || l.preDispatch.call(this, e) !== !1) {
                    s = x.event.handlers.call(this, e, u), t = 0;
                    while ((i = s[t++]) && !e.isPropagationStopped()) {
                        e.currentTarget = i.elem, n = 0;
                        while ((o = i.handlers[n++]) && !e.isImmediatePropagationStopped())(!e.namespace_re || e.namespace_re.test(o.namespace)) && (e.handleObj = o, e.data = o.data, r = ((x.event.special[o.origType] || {}).handle || o.handler).apply(i.elem, a), r !== undefined && (e.result = r) === !1 && (e.preventDefault(), e.stopPropagation()))
                    }
                    return l.postDispatch && l.postDispatch.call(this, e), e.result
                }
            }, handlers: function (e, t) {
                var n, r, i, o, s = [], a = t.delegateCount, u = e.target;
                if (a && u.nodeType && (!e.button || "click" !== e.type))for (; u !== this; u = u.parentNode || this)if (u.disabled !== !0 || "click" !== e.type) {
                    for (r = [], n = 0; a > n; n++)o = t[n], i = o.selector + " ", r[i] === undefined && (r[i] = o.needsContext ? x(i, this).index(u) >= 0 : x.find(i, this, null, [u]).length), r[i] && r.push(o);
                    r.length && s.push({elem: u, handlers: r})
                }
                return t.length > a && s.push({elem: this, handlers: t.slice(a)}), s
            }, props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "), fixHooks: {}, keyHooks: {
                props: "char charCode key keyCode".split(" "), filter: function (e, t) {
                    return null == e.which && (e.which = null != t.charCode ? t.charCode : t.keyCode), e
                }
            }, mouseHooks: {
                props: "button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "), filter: function (e, t) {
                    var n, r, i, s = t.button;
                    return null == e.pageX && null != t.clientX && (n = e.target.ownerDocument || o, r = n.documentElement, i = n.body, e.pageX = t.clientX + (r && r.scrollLeft || i && i.scrollLeft || 0) - (r && r.clientLeft || i && i.clientLeft || 0), e.pageY = t.clientY + (r && r.scrollTop || i && i.scrollTop || 0) - (r && r.clientTop || i && i.clientTop || 0)), e.which || s === undefined || (e.which = 1 & s ? 1 : 2 & s ? 3 : 4 & s ? 2 : 0), e
                }
            }, fix: function (e) {
                if (e[x.expando])return e;
                var t, n, r, i = e.type, o = e, s = this.fixHooks[i];
                s || (this.fixHooks[i] = s = z.test(i) ? this.mouseHooks : I.test(i) ? this.keyHooks : {}), r = s.props ? this.props.concat(s.props) : this.props, e = new x.Event(o), t = r.length;
                while (t--)n = r[t], e[n] = o[n];
                return 3 === e.target.nodeType && (e.target = e.target.parentNode), s.filter ? s.filter(e, o) : e
            }, special: {
                load: {noBubble: !0}, focus: {
                    trigger: function () {
                        return this !== V() && this.focus ? (this.focus(), !1) : undefined
                    }, delegateType: "focusin"
                }, blur: {
                    trigger: function () {
                        return this === V() && this.blur ? (this.blur(), !1) : undefined
                    }, delegateType: "focusout"
                }, click: {
                    trigger: function () {
                        return "checkbox" === this.type && this.click && x.nodeName(this, "input") ? (this.click(), !1) : undefined
                    }, _default: function (e) {
                        return x.nodeName(e.target, "a")
                    }
                }, beforeunload: {
                    postDispatch: function (e) {
                        e.result !== undefined && (e.originalEvent.returnValue = e.result)
                    }
                }
            }, simulate: function (e, t, n, r) {
                var i = x.extend(new x.Event, n, {type: e, isSimulated: !0, originalEvent: {}});
                r ? x.event.trigger(i, null, t) : x.event.dispatch.call(t, i), i.isDefaultPrevented() && n.preventDefault()
            }
        }, x.removeEvent = function (e, t, n) {
            e.removeEventListener && e.removeEventListener(t, n, !1)
        }, x.Event = function (e, t) {
            return this instanceof x.Event ? (e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || e.getPreventDefault && e.getPreventDefault() ? U : Y) : this.type = e, t && x.extend(this, t), this.timeStamp = e && e.timeStamp || x.now(), this[x.expando] = !0, undefined) : new x.Event(e, t)
        }, x.Event.prototype = {
            isDefaultPrevented: Y, isPropagationStopped: Y, isImmediatePropagationStopped: Y, preventDefault: function () {
                var e = this.originalEvent;
                this.isDefaultPrevented = U, e && e.preventDefault && e.preventDefault()
            }, stopPropagation: function () {
                var e = this.originalEvent;
                this.isPropagationStopped = U, e && e.stopPropagation && e.stopPropagation()
            }, stopImmediatePropagation: function () {
                this.isImmediatePropagationStopped = U, this.stopPropagation()
            }
        }, x.each({mouseenter: "mouseover", mouseleave: "mouseout"}, function (e, t) {
            x.event.special[e] = {
                delegateType: t, bindType: t, handle: function (e) {
                    var n, r = this, i = e.relatedTarget, o = e.handleObj;
                    return (!i || i !== r && !x.contains(r, i)) && (e.type = o.origType, n = o.handler.apply(this, arguments), e.type = t), n
                }
            }
        }), x.support.focusinBubbles || x.each({focus: "focusin", blur: "focusout"}, function (e, t) {
            var n = 0, r = function (e) {
                x.event.simulate(t, e.target, x.event.fix(e), !0)
            };
            x.event.special[t] = {
                setup: function () {
                    0 === n++ && o.addEventListener(e, r, !0)
                }, teardown: function () {
                    0 === --n && o.removeEventListener(e, r, !0)
                }
            }
        }), x.fn.extend({
            on: function (e, t, n, r, i) {
                var o, s;
                if ("object" == typeof e) {
                    "string" != typeof t && (n = n || t, t = undefined);
                    for (s in e)this.on(s, t, n, e[s], i);
                    return this
                }
                if (null == n && null == r ? (r = t, n = t = undefined) : null == r && ("string" == typeof t ? (r = n, n = undefined) : (r = n, n = t, t = undefined)), r === !1)r = Y; else if (!r)return this;
                return 1 === i && (o = r, r = function (e) {
                    return x().off(e), o.apply(this, arguments)
                }, r.guid = o.guid || (o.guid = x.guid++)), this.each(function () {
                    x.event.add(this, e, r, n, t)
                })
            }, one: function (e, t, n, r) {
                return this.on(e, t, n, r, 1)
            }, off: function (e, t, n) {
                var r, i;
                if (e && e.preventDefault && e.handleObj)return r = e.handleObj, x(e.delegateTarget).off(r.namespace ? r.origType + "." + r.namespace : r.origType, r.selector, r.handler), this;
                if ("object" == typeof e) {
                    for (i in e)this.off(i, t, e[i]);
                    return this
                }
                return (t === !1 || "function" == typeof t) && (n = t, t = undefined), n === !1 && (n = Y), this.each(function () {
                    x.event.remove(this, e, n, t)
                })
            }, trigger: function (e, t) {
                return this.each(function () {
                    x.event.trigger(e, t, this)
                })
            }, triggerHandler: function (e, t) {
                var n = this[0];
                return n ? x.event.trigger(e, t, n, !0) : undefined
            }
        });
        var G = /^.[^:#\[\.,]*$/, J = x.expr.match.needsContext, Q = {children: !0, contents: !0, next: !0, prev: !0};
        x.fn.extend({
            find: function (e) {
                var t, n, r, i = this.length;
                if ("string" != typeof e)return t = this, this.pushStack(x(e).filter(function () {
                    for (r = 0; i > r; r++)if (x.contains(t[r], this))return !0
                }));
                for (n = [], r = 0; i > r; r++)x.find(e, this[r], n);
                return n = this.pushStack(i > 1 ? x.unique(n) : n), n.selector = (this.selector ? this.selector + " " : "") + e, n
            }, has: function (e) {
                var t = x(e, this), n = t.length;
                return this.filter(function () {
                    var e = 0;
                    for (; n > e; e++)if (x.contains(this, t[e]))return !0
                })
            }, not: function (e) {
                return this.pushStack(Z(this, e || [], !0))
            }, filter: function (e) {
                return this.pushStack(Z(this, e || [], !1))
            }, is: function (e) {
                return !!e && ("string" == typeof e ? J.test(e) ? x(e, this.context).index(this[0]) >= 0 : x.filter(e, this).length > 0 : this.filter(e).length > 0)
            }, closest: function (e, t) {
                var n, r = 0, i = this.length, o = [], s = J.test(e) || "string" != typeof e ? x(e, t || this.context) : 0;
                for (; i > r; r++)for (n = this[r]; n && n !== t; n = n.parentNode)if (11 > n.nodeType && (s ? s.index(n) > -1 : 1 === n.nodeType && x.find.matchesSelector(n, e))) {
                    n = o.push(n);
                    break
                }
                return this.pushStack(o.length > 1 ? x.unique(o) : o)
            }, index: function (e) {
                return e ? "string" == typeof e ? g.call(x(e), this[0]) : g.call(this, e.jquery ? e[0] : e) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1
            }, add: function (e, t) {
                var n = "string" == typeof e ? x(e, t) : x.makeArray(e && e.nodeType ? [e] : e), r = x.merge(this.get(), n);
                return this.pushStack(x.unique(r))
            }, addBack: function (e) {
                return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
            }
        });
        function K(e, t) {
            while ((e = e[t]) && 1 !== e.nodeType);
            return e
        }

        x.each({
            parent: function (e) {
                var t = e.parentNode;
                return t && 11 !== t.nodeType ? t : null
            }, parents: function (e) {
                return x.dir(e, "parentNode")
            }, parentsUntil: function (e, t, n) {
                return x.dir(e, "parentNode", n)
            }, next: function (e) {
                return K(e, "nextSibling")
            }, prev: function (e) {
                return K(e, "previousSibling")
            }, nextAll: function (e) {
                return x.dir(e, "nextSibling")
            }, prevAll: function (e) {
                return x.dir(e, "previousSibling")
            }, nextUntil: function (e, t, n) {
                return x.dir(e, "nextSibling", n)
            }, prevUntil: function (e, t, n) {
                return x.dir(e, "previousSibling", n)
            }, siblings: function (e) {
                return x.sibling((e.parentNode || {}).firstChild, e)
            }, children: function (e) {
                return x.sibling(e.firstChild)
            }, contents: function (e) {
                return x.nodeName(e, "iframe") ? e.contentDocument || e.contentWindow.document : x.merge([], e.childNodes)
            }
        }, function (e, t) {
            x.fn[e] = function (n, r) {
                var i = x.map(this, t, n);
                return "Until" !== e.slice(-5) && (r = n), r && "string" == typeof r && (i = x.filter(r, i)), this.length > 1 && (Q[e] || x.unique(i), "p" === e[0] && i.reverse()), this.pushStack(i)
            }
        }), x.extend({
            filter: function (e, t, n) {
                var r = t[0];
                return n && (e = ":not(" + e + ")"), 1 === t.length && 1 === r.nodeType ? x.find.matchesSelector(r, e) ? [r] : [] : x.find.matches(e, x.grep(t, function (e) {
                    return 1 === e.nodeType
                }))
            }, dir: function (e, t, n) {
                var r = [], i = n !== undefined;
                while ((e = e[t]) && 9 !== e.nodeType)if (1 === e.nodeType) {
                    if (i && x(e).is(n))break;
                    r.push(e)
                }
                return r
            }, sibling: function (e, t) {
                var n = [];
                for (; e; e = e.nextSibling)1 === e.nodeType && e !== t && n.push(e);
                return n
            }
        });
        function Z(e, t, n) {
            if (x.isFunction(t))return x.grep(e, function (e, r) {
                return !!t.call(e, r, e) !== n
            });
            if (t.nodeType)return x.grep(e, function (e) {
                return e === t !== n
            });
            if ("string" == typeof t) {
                if (G.test(t))return x.filter(t, e, n);
                t = x.filter(t, e)
            }
            return x.grep(e, function (e) {
                return g.call(t, e) >= 0 !== n
            })
        }

        var et = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, tt = /<([\w:]+)/, nt = /<|&#?\w+;/, rt = /<(?:script|style|link)/i, it = /^(?:checkbox|radio)$/i, ot = /checked\s*(?:[^=]|=\s*.checked.)/i, st = /^$|\/(?:java|ecma)script/i, at = /^true\/(.*)/, ut = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, lt = {
            option: [1, "<select multiple='multiple'>", "</select>"],
            thead: [1, "<table>", "</table>"],
            tr: [2, "<table><tbody>", "</tbody></table>"],
            td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
            _default: [0, "", ""]
        };
        lt.optgroup = lt.option, lt.tbody = lt.tfoot = lt.colgroup = lt.caption = lt.col = lt.thead, lt.th = lt.td, x.fn.extend({
            text: function (e) {
                return x.access(this, function (e) {
                    return e === undefined ? x.text(this) : this.empty().append((this[0] && this[0].ownerDocument || o).createTextNode(e))
                }, null, e, arguments.length)
            }, append: function () {
                return this.domManip(arguments, function (e) {
                    if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                        var t = ct(this, e);
                        t.appendChild(e)
                    }
                })
            }, prepend: function () {
                return this.domManip(arguments, function (e) {
                    if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                        var t = ct(this, e);
                        t.insertBefore(e, t.firstChild)
                    }
                })
            }, before: function () {
                return this.domManip(arguments, function (e) {
                    this.parentNode && this.parentNode.insertBefore(e, this)
                })
            }, after: function () {
                return this.domManip(arguments, function (e) {
                    this.parentNode && this.parentNode.insertBefore(e, this.nextSibling)
                })
            }, remove: function (e, t) {
                var n, r = e ? x.filter(e, this) : this, i = 0;
                for (; null != (n = r[i]); i++)t || 1 !== n.nodeType || x.cleanData(gt(n)), n.parentNode && (t && x.contains(n.ownerDocument, n) && ht(gt(n, "script")), n.parentNode.removeChild(n));
                return this
            }, empty: function () {
                var e, t = 0;
                for (; null != (e = this[t]); t++)1 === e.nodeType && (x.cleanData(gt(e, !1)), e.textContent = "");
                return this
            }, clone: function (e, t) {
                return e = null == e ? !1 : e, t = null == t ? e : t, this.map(function () {
                    return x.clone(this, e, t)
                })
            }, html: function (e) {
                return x.access(this, function (e) {
                    var t = this[0] || {}, n = 0, r = this.length;
                    if (e === undefined && 1 === t.nodeType)return t.innerHTML;
                    if ("string" == typeof e && !rt.test(e) && !lt[(tt.exec(e) || ["", ""])[1].toLowerCase()]) {
                        e = e.replace(et, "<$1></$2>");
                        try {
                            for (; r > n; n++)t = this[n] || {}, 1 === t.nodeType && (x.cleanData(gt(t, !1)), t.innerHTML = e);
                            t = 0
                        } catch (i) {
                        }
                    }
                    t && this.empty().append(e)
                }, null, e, arguments.length)
            }, replaceWith: function () {
                var e = x.map(this, function (e) {
                    return [e.nextSibling, e.parentNode]
                }), t = 0;
                return this.domManip(arguments, function (n) {
                    var r = e[t++], i = e[t++];
                    i && (x(this).remove(), i.insertBefore(n, r))
                }, !0), t ? this : this.remove()
            }, detach: function (e) {
                return this.remove(e, !0)
            }, domManip: function (e, t, n) {
                e = p.apply([], e);
                var r, i, o, s, a, u, l = 0, c = this.length, f = this, h = c - 1, d = e[0], g = x.isFunction(d);
                if (g || !(1 >= c || "string" != typeof d || x.support.checkClone) && ot.test(d))return this.each(function (r) {
                    var i = f.eq(r);
                    g && (e[0] = d.call(this, r, i.html())), i.domManip(e, t, n)
                });
                if (c && (r = x.buildFragment(e, this[0].ownerDocument, !1, !n && this), i = r.firstChild, 1 === r.childNodes.length && (r = i), i)) {
                    for (o = x.map(gt(r, "script"), ft), s = o.length; c > l; l++)a = r, l !== h && (a = x.clone(a, !0, !0), s && x.merge(o, gt(a, "script"))), t.call(this[l], a, l);
                    if (s)for (u = o[o.length - 1].ownerDocument, x.map(o, pt), l = 0; s > l; l++)a = o[l], st.test(a.type || "") && !q.access(a, "globalEval") && x.contains(u, a) && (a.src ? x._evalUrl(a.src) : x.globalEval(a.textContent.replace(ut, "")))
                }
                return this
            }
        }), x.each({appendTo: "append", prependTo: "prepend", insertBefore: "before", insertAfter: "after", replaceAll: "replaceWith"}, function (e, t) {
            x.fn[e] = function (e) {
                var n, r = [], i = x(e), o = i.length - 1, s = 0;
                for (; o >= s; s++)n = s === o ? this : this.clone(!0), x(i[s])[t](n), h.apply(r, n.get());
                return this.pushStack(r)
            }
        }), x.extend({
            clone: function (e, t, n) {
                var r, i, o, s, a = e.cloneNode(!0), u = x.contains(e.ownerDocument, e);
                if (!(x.support.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || x.isXMLDoc(e)))for (s = gt(a), o = gt(e), r = 0, i = o.length; i > r; r++)mt(o[r], s[r]);
                if (t)if (n)for (o = o || gt(e), s = s || gt(a), r = 0, i = o.length; i > r; r++)dt(o[r], s[r]); else dt(e, a);
                return s = gt(a, "script"), s.length > 0 && ht(s, !u && gt(e, "script")), a
            }, buildFragment: function (e, t, n, r) {
                var i, o, s, a, u, l, c = 0, f = e.length, p = t.createDocumentFragment(), h = [];
                for (; f > c; c++)if (i = e[c], i || 0 === i)if ("object" === x.type(i))x.merge(h, i.nodeType ? [i] : i); else if (nt.test(i)) {
                    o = o || p.appendChild(t.createElement("div")), s = (tt.exec(i) || ["", ""])[1].toLowerCase(), a = lt[s] || lt._default, o.innerHTML = a[1] + i.replace(et, "<$1></$2>") + a[2], l = a[0];
                    while (l--)o = o.firstChild;
                    x.merge(h, o.childNodes), o = p.firstChild, o.textContent = ""
                } else h.push(t.createTextNode(i));
                p.textContent = "", c = 0;
                while (i = h[c++])if ((!r || -1 === x.inArray(i, r)) && (u = x.contains(i.ownerDocument, i), o = gt(p.appendChild(i), "script"), u && ht(o), n)) {
                    l = 0;
                    while (i = o[l++])st.test(i.type || "") && n.push(i)
                }
                return p
            }, cleanData: function (e) {
                var t, n, r, i = e.length, o = 0, s = x.event.special;
                for (; i > o; o++) {
                    if (n = e[o], x.acceptData(n) && (t = q.access(n)))for (r in t.events)s[r] ? x.event.remove(n, r) : x.removeEvent(n, r, t.handle);
                    L.discard(n), q.discard(n)
                }
            }, _evalUrl: function (e) {
                return x.ajax({url: e, type: "GET", dataType: "text", async: !1, global: !1, success: x.globalEval})
            }
        });
        function ct(e, t) {
            return x.nodeName(e, "table") && x.nodeName(1 === t.nodeType ? t : t.firstChild, "tr") ? e.getElementsByTagName("tbody")[0] || e.appendChild(e.ownerDocument.createElement("tbody")) : e
        }

        function ft(e) {
            return e.type = (null !== e.getAttribute("type")) + "/" + e.type, e
        }

        function pt(e) {
            var t = at.exec(e.type);
            return t ? e.type = t[1] : e.removeAttribute("type"), e
        }

        function ht(e, t) {
            var n = e.length, r = 0;
            for (; n > r; r++)q.set(e[r], "globalEval", !t || q.get(t[r], "globalEval"))
        }

        function dt(e, t) {
            var n, r, i, o, s, a, u, l;
            if (1 === t.nodeType) {
                if (q.hasData(e) && (o = q.access(e), s = x.extend({}, o), l = o.events, q.set(t, s), l)) {
                    delete s.handle, s.events = {};
                    for (i in l)for (n = 0, r = l[i].length; r > n; n++)x.event.add(t, i, l[i][n])
                }
                L.hasData(e) && (a = L.access(e), u = x.extend({}, a), L.set(t, u))
            }
        }

        function gt(e, t) {
            var n = e.getElementsByTagName ? e.getElementsByTagName(t || "*") : e.querySelectorAll ? e.querySelectorAll(t || "*") : [];
            return t === undefined || t && x.nodeName(e, t) ? x.merge([e], n) : n
        }

        function mt(e, t) {
            var n = t.nodeName.toLowerCase();
            "input" === n && it.test(e.type) ? t.checked = e.checked : ("input" === n || "textarea" === n) && (t.defaultValue = e.defaultValue)
        }

        x.fn.extend({
            wrapAll: function (e) {
                var t;
                return x.isFunction(e) ? this.each(function (t) {
                    x(this).wrapAll(e.call(this, t))
                }) : (this[0] && (t = x(e, this[0].ownerDocument).eq(0).clone(!0), this[0].parentNode && t.insertBefore(this[0]), t.map(function () {
                    var e = this;
                    while (e.firstElementChild)e = e.firstElementChild;
                    return e
                }).append(this)), this)
            }, wrapInner: function (e) {
                return x.isFunction(e) ? this.each(function (t) {
                    x(this).wrapInner(e.call(this, t))
                }) : this.each(function () {
                    var t = x(this), n = t.contents();
                    n.length ? n.wrapAll(e) : t.append(e)
                })
            }, wrap: function (e) {
                var t = x.isFunction(e);
                return this.each(function (n) {
                    x(this).wrapAll(t ? e.call(this, n) : e)
                })
            }, unwrap: function () {
                return this.parent().each(function () {
                    x.nodeName(this, "body") || x(this).replaceWith(this.childNodes)
                }).end()
            }
        });
        var yt, vt, xt = /^(none|table(?!-c[ea]).+)/, bt = /^margin/, wt = RegExp("^(" + b + ")(.*)$", "i"), Tt = RegExp("^(" + b + ")(?!px)[a-z%]+$", "i"), Ct = RegExp("^([+-])=(" + b + ")", "i"), kt = {BODY: "block"}, Nt = {position: "absolute", visibility: "hidden", display: "block"}, Et = {letterSpacing: 0, fontWeight: 400}, St = ["Top", "Right", "Bottom", "Left"], jt = ["Webkit", "O", "Moz", "ms"];

        function Dt(e, t) {
            if (t in e)return t;
            var n = t.charAt(0).toUpperCase() + t.slice(1), r = t, i = jt.length;
            while (i--)if (t = jt[i] + n, t in e)return t;
            return r
        }

        function At(e, t) {
            return e = t || e, "none" === x.css(e, "display") || !x.contains(e.ownerDocument, e)
        }

        function Lt(t) {
            return e.getComputedStyle(t, null)
        }

        function qt(e, t) {
            var n, r, i, o = [], s = 0, a = e.length;
            for (; a > s; s++)r = e[s], r.style && (o[s] = q.get(r, "olddisplay"), n = r.style.display, t ? (o[s] || "none" !== n || (r.style.display = ""), "" === r.style.display && At(r) && (o[s] = q.access(r, "olddisplay", Pt(r.nodeName)))) : o[s] || (i = At(r), (n && "none" !== n || !i) && q.set(r, "olddisplay", i ? n : x.css(r, "display"))));
            for (s = 0; a > s; s++)r = e[s], r.style && (t && "none" !== r.style.display && "" !== r.style.display || (r.style.display = t ? o[s] || "" : "none"));
            return e
        }

        x.fn.extend({
            css: function (e, t) {
                return x.access(this, function (e, t, n) {
                    var r, i, o = {}, s = 0;
                    if (x.isArray(t)) {
                        for (r = Lt(e), i = t.length; i > s; s++)o[t[s]] = x.css(e, t[s], !1, r);
                        return o
                    }
                    return n !== undefined ? x.style(e, t, n) : x.css(e, t)
                }, e, t, arguments.length > 1)
            }, show: function () {
                return qt(this, !0)
            }, hide: function () {
                return qt(this)
            }, toggle: function (e) {
                var t = "boolean" == typeof e;
                return this.each(function () {
                    (t ? e : At(this)) ? x(this).show() : x(this).hide()
                })
            }
        }), x.extend({
            cssHooks: {
                opacity: {
                    get: function (e, t) {
                        if (t) {
                            var n = yt(e, "opacity");
                            return "" === n ? "1" : n
                        }
                    }
                }
            }, cssNumber: {columnCount: !0, fillOpacity: !0, fontWeight: !0, lineHeight: !0, opacity: !0, orphans: !0, widows: !0, zIndex: !0, zoom: !0}, cssProps: {"float": "cssFloat"}, style: function (e, t, n, r) {
                if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) {
                    var i, o, s, a = x.camelCase(t), u = e.style;
                    return t = x.cssProps[a] || (x.cssProps[a] = Dt(u, a)), s = x.cssHooks[t] || x.cssHooks[a], n === undefined ? s && "get" in s && (i = s.get(e, !1, r)) !== undefined ? i : u[t] : (o = typeof n, "string" === o && (i = Ct.exec(n)) && (n = (i[1] + 1) * i[2] + parseFloat(x.css(e, t)), o = "number"), null == n || "number" === o && isNaN(n) || ("number" !== o || x.cssNumber[a] || (n += "px"), x.support.clearCloneStyle || "" !== n || 0 !== t.indexOf("background") || (u[t] = "inherit"), s && "set" in s && (n = s.set(e, n, r)) === undefined || (u[t] = n)), undefined)
                }
            }, css: function (e, t, n, r) {
                var i, o, s, a = x.camelCase(t);
                return t = x.cssProps[a] || (x.cssProps[a] = Dt(e.style, a)), s = x.cssHooks[t] || x.cssHooks[a], s && "get" in s && (i = s.get(e, !0, n)), i === undefined && (i = yt(e, t, r)), "normal" === i && t in Et && (i = Et[t]), "" === n || n ? (o = parseFloat(i), n === !0 || x.isNumeric(o) ? o || 0 : i) : i
            }
        }), yt = function (e, t, n) {
            var r, i, o, s = n || Lt(e), a = s ? s.getPropertyValue(t) || s[t] : undefined, u = e.style;
            return s && ("" !== a || x.contains(e.ownerDocument, e) || (a = x.style(e, t)), Tt.test(a) && bt.test(t) && (r = u.width, i = u.minWidth, o = u.maxWidth, u.minWidth = u.maxWidth = u.width = a, a = s.width, u.width = r, u.minWidth = i, u.maxWidth = o)), a
        };
        function Ht(e, t, n) {
            var r = wt.exec(t);
            return r ? Math.max(0, r[1] - (n || 0)) + (r[2] || "px") : t
        }

        function Ot(e, t, n, r, i) {
            var o = n === (r ? "border" : "content") ? 4 : "width" === t ? 1 : 0, s = 0;
            for (; 4 > o; o += 2)"margin" === n && (s += x.css(e, n + St[o], !0, i)), r ? ("content" === n && (s -= x.css(e, "padding" + St[o], !0, i)), "margin" !== n && (s -= x.css(e, "border" + St[o] + "Width", !0, i))) : (s += x.css(e, "padding" + St[o], !0, i), "padding" !== n && (s += x.css(e, "border" + St[o] + "Width", !0, i)));
            return s
        }

        function Ft(e, t, n) {
            var r = !0, i = "width" === t ? e.offsetWidth : e.offsetHeight, o = Lt(e), s = x.support.boxSizing && "border-box" === x.css(e, "boxSizing", !1, o);
            if (0 >= i || null == i) {
                if (i = yt(e, t, o), (0 > i || null == i) && (i = e.style[t]), Tt.test(i))return i;
                r = s && (x.support.boxSizingReliable || i === e.style[t]), i = parseFloat(i) || 0
            }
            return i + Ot(e, t, n || (s ? "border" : "content"), r, o) + "px"
        }

        function Pt(e) {
            var t = o, n = kt[e];
            return n || (n = Rt(e, t), "none" !== n && n || (vt = (vt || x("<iframe frameborder='0' width='0' height='0'/>").css("cssText", "display:block !important")).appendTo(t.documentElement), t = (vt[0].contentWindow || vt[0].contentDocument).document, t.write("<!doctype html><html><body>"), t.close(), n = Rt(e, t), vt.detach()), kt[e] = n), n
        }

        function Rt(e, t) {
            var n = x(t.createElement(e)).appendTo(t.body), r = x.css(n[0], "display");
            return n.remove(), r
        }

        x.each(["height", "width"], function (e, t) {
            x.cssHooks[t] = {
                get: function (e, n, r) {
                    return n ? 0 === e.offsetWidth && xt.test(x.css(e, "display")) ? x.swap(e, Nt, function () {
                        return Ft(e, t, r)
                    }) : Ft(e, t, r) : undefined
                }, set: function (e, n, r) {
                    var i = r && Lt(e);
                    return Ht(e, n, r ? Ot(e, t, r, x.support.boxSizing && "border-box" === x.css(e, "boxSizing", !1, i), i) : 0)
                }
            }
        }), x(function () {
            x.support.reliableMarginRight || (x.cssHooks.marginRight = {
                get: function (e, t) {
                    return t ? x.swap(e, {display: "inline-block"}, yt, [e, "marginRight"]) : undefined
                }
            }), !x.support.pixelPosition && x.fn.position && x.each(["top", "left"], function (e, t) {
                x.cssHooks[t] = {
                    get: function (e, n) {
                        return n ? (n = yt(e, t), Tt.test(n) ? x(e).position()[t] + "px" : n) : undefined
                    }
                }
            })
        }), x.expr && x.expr.filters && (x.expr.filters.hidden = function (e) {
            return 0 >= e.offsetWidth && 0 >= e.offsetHeight
        }, x.expr.filters.visible = function (e) {
            return !x.expr.filters.hidden(e)
        }), x.each({margin: "", padding: "", border: "Width"}, function (e, t) {
            x.cssHooks[e + t] = {
                expand: function (n) {
                    var r = 0, i = {}, o = "string" == typeof n ? n.split(" ") : [n];
                    for (; 4 > r; r++)i[e + St[r] + t] = o[r] || o[r - 2] || o[0];
                    return i
                }
            }, bt.test(e) || (x.cssHooks[e + t].set = Ht)
        });
        var Mt = /%20/g, Wt = /\[\]$/, $t = /\r?\n/g, Bt = /^(?:submit|button|image|reset|file)$/i, It = /^(?:input|select|textarea|keygen)/i;
        x.fn.extend({
            serialize: function () {
                return x.param(this.serializeArray())
            }, serializeArray: function () {
                return this.map(function () {
                    var e = x.prop(this, "elements");
                    return e ? x.makeArray(e) : this
                }).filter(function () {
                    var e = this.type;
                    return this.name && !x(this).is(":disabled") && It.test(this.nodeName) && !Bt.test(e) && (this.checked || !it.test(e))
                }).map(function (e, t) {
                    var n = x(this).val();
                    return null == n ? null : x.isArray(n) ? x.map(n, function (e) {
                        return {name: t.name, value: e.replace($t, "\r\n")}
                    }) : {name: t.name, value: n.replace($t, "\r\n")}
                }).get()
            }
        }), x.param = function (e, t) {
            var n, r = [], i = function (e, t) {
                t = x.isFunction(t) ? t() : null == t ? "" : t, r[r.length] = encodeURIComponent(e) + "=" + encodeURIComponent(t)
            };
            if (t === undefined && (t = x.ajaxSettings && x.ajaxSettings.traditional), x.isArray(e) || e.jquery && !x.isPlainObject(e))x.each(e, function () {
                i(this.name, this.value)
            }); else for (n in e)zt(n, e[n], t, i);
            return r.join("&").replace(Mt, "+")
        };
        function zt(e, t, n, r) {
            var i;
            if (x.isArray(t))x.each(t, function (t, i) {
                n || Wt.test(e) ? r(e, i) : zt(e + "[" + ("object" == typeof i ? t : "") + "]", i, n, r)
            }); else if (n || "object" !== x.type(t))r(e, t); else for (i in t)zt(e + "[" + i + "]", t[i], n, r)
        }

        x.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function (e, t) {
            x.fn[t] = function (e, n) {
                return arguments.length > 0 ? this.on(t, null, e, n) : this.trigger(t)
            }
        }), x.fn.extend({
            hover: function (e, t) {
                return this.mouseenter(e).mouseleave(t || e)
            }, bind: function (e, t, n) {
                return this.on(e, null, t, n)
            }, unbind: function (e, t) {
                return this.off(e, null, t)
            }, delegate: function (e, t, n, r) {
                return this.on(t, e, n, r)
            }, undelegate: function (e, t, n) {
                return 1 === arguments.length ? this.off(e, "**") : this.off(t, e || "**", n)
            }
        });
        var _t, Xt, Ut = x.now(), Yt = /\?/, Vt = /#.*$/, Gt = /([?&])_=[^&]*/, Jt = /^(.*?):[ \t]*([^\r\n]*)$/gm, Qt = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, Kt = /^(?:GET|HEAD)$/, Zt = /^\/\//, en = /^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/, tn = x.fn.load, nn = {}, rn = {}, on = "*/".concat("*");
        try {
            Xt = i.href
        } catch (sn) {
            Xt = o.createElement("a"), Xt.href = "", Xt = Xt.href
        }
        _t = en.exec(Xt.toLowerCase()) || [];
        function an(e) {
            return function (t, n) {
                "string" != typeof t && (n = t, t = "*");
                var r, i = 0, o = t.toLowerCase().match(w) || [];
                if (x.isFunction(n))while (r = o[i++])"+" === r[0] ? (r = r.slice(1) || "*", (e[r] = e[r] || []).unshift(n)) : (e[r] = e[r] || []).push(n)
            }
        }

        function un(e, t, n, r) {
            var i = {}, o = e === rn;

            function s(a) {
                var u;
                return i[a] = !0, x.each(e[a] || [], function (e, a) {
                    var l = a(t, n, r);
                    return "string" != typeof l || o || i[l] ? o ? !(u = l) : undefined : (t.dataTypes.unshift(l), s(l), !1)
                }), u
            }

            return s(t.dataTypes[0]) || !i["*"] && s("*")
        }

        function ln(e, t) {
            var n, r, i = x.ajaxSettings.flatOptions || {};
            for (n in t)t[n] !== undefined && ((i[n] ? e : r || (r = {}))[n] = t[n]);
            return r && x.extend(!0, e, r), e
        }

        x.fn.load = function (e, t, n) {
            if ("string" != typeof e && tn)return tn.apply(this, arguments);
            var r, i, o, s = this, a = e.indexOf(" ");
            return a >= 0 && (r = e.slice(a), e = e.slice(0, a)), x.isFunction(t) ? (n = t, t = undefined) : t && "object" == typeof t && (i = "POST"), s.length > 0 && x.ajax({url: e, type: i, dataType: "html", data: t}).done(function (e) {
                o = arguments, s.html(r ? x("<div>").append(x.parseHTML(e)).find(r) : e)
            }).complete(n && function (e, t) {
                        s.each(n, o || [e.responseText, t, e])
                    }), this
        }, x.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (e, t) {
            x.fn[t] = function (e) {
                return this.on(t, e)
            }
        }), x.extend({
            active: 0,
            lastModified: {},
            etag: {},
            ajaxSettings: {
                url: Xt,
                type: "GET",
                isLocal: Qt.test(_t[1]),
                global: !0,
                processData: !0,
                async: !0,
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                accepts: {"*": on, text: "text/plain", html: "text/html", xml: "application/xml, text/xml", json: "application/json, text/javascript"},
                contents: {xml: /xml/, html: /html/, json: /json/},
                responseFields: {xml: "responseXML", text: "responseText", json: "responseJSON"},
                converters: {"* text": String, "text html": !0, "text json": x.parseJSON, "text xml": x.parseXML},
                flatOptions: {url: !0, context: !0}
            },
            ajaxSetup: function (e, t) {
                return t ? ln(ln(e, x.ajaxSettings), t) : ln(x.ajaxSettings, e)
            },
            ajaxPrefilter: an(nn),
            ajaxTransport: an(rn),
            ajax: function (e, t) {
                "object" == typeof e && (t = e, e = undefined), t = t || {};
                var n, r, i, o, s, a, u, l, c = x.ajaxSetup({}, t), f = c.context || c, p = c.context && (f.nodeType || f.jquery) ? x(f) : x.event, h = x.Deferred(), d = x.Callbacks("once memory"), g = c.statusCode || {}, m = {}, y = {}, v = 0, b = "canceled", T = {
                    readyState: 0, getResponseHeader: function (e) {
                        var t;
                        if (2 === v) {
                            if (!o) {
                                o = {};
                                while (t = Jt.exec(i))o[t[1].toLowerCase()] = t[2]
                            }
                            t = o[e.toLowerCase()]
                        }
                        return null == t ? null : t
                    }, getAllResponseHeaders: function () {
                        return 2 === v ? i : null
                    }, setRequestHeader: function (e, t) {
                        var n = e.toLowerCase();
                        return v || (e = y[n] = y[n] || e, m[e] = t), this
                    }, overrideMimeType: function (e) {
                        return v || (c.mimeType = e), this
                    }, statusCode: function (e) {
                        var t;
                        if (e)if (2 > v)for (t in e)g[t] = [g[t], e[t]]; else T.always(e[T.status]);
                        return this
                    }, abort: function (e) {
                        var t = e || b;
                        return n && n.abort(t), k(0, t), this
                    }
                };
                if (h.promise(T).complete = d.add, T.success = T.done, T.error = T.fail, c.url = ((e || c.url || Xt) + "").replace(Vt, "").replace(Zt, _t[1] + "//"), c.type = t.method || t.type || c.method || c.type, c.dataTypes = x.trim(c.dataType || "*").toLowerCase().match(w) || [""], null == c.crossDomain && (a = en.exec(c.url.toLowerCase()), c.crossDomain = !(!a || a[1] === _t[1] && a[2] === _t[2] && (a[3] || ("http:" === a[1] ? "80" : "443")) === (_t[3] || ("http:" === _t[1] ? "80" : "443")))), c.data && c.processData && "string" != typeof c.data && (c.data = x.param(c.data, c.traditional)), un(nn, c, t, T), 2 === v)return T;
                u = c.global, u && 0 === x.active++ && x.event.trigger("ajaxStart"), c.type = c.type.toUpperCase(), c.hasContent = !Kt.test(c.type), r = c.url, c.hasContent || (c.data && (r = c.url += (Yt.test(r) ? "&" : "?") + c.data, delete c.data), c.cache === !1 && (c.url = Gt.test(r) ? r.replace(Gt, "$1_=" + Ut++) : r + (Yt.test(r) ? "&" : "?") + "_=" + Ut++)), c.ifModified && (x.lastModified[r] && T.setRequestHeader("If-Modified-Since", x.lastModified[r]), x.etag[r] && T.setRequestHeader("If-None-Match", x.etag[r])), (c.data && c.hasContent && c.contentType !== !1 || t.contentType) && T.setRequestHeader("Content-Type", c.contentType), T.setRequestHeader("Accept", c.dataTypes[0] && c.accepts[c.dataTypes[0]] ? c.accepts[c.dataTypes[0]] + ("*" !== c.dataTypes[0] ? ", " + on + "; q=0.01" : "") : c.accepts["*"]);
                for (l in c.headers)T.setRequestHeader(l, c.headers[l]);
                if (c.beforeSend && (c.beforeSend.call(f, T, c) === !1 || 2 === v))return T.abort();
                b = "abort";
                for (l in{success: 1, error: 1, complete: 1})T[l](c[l]);
                if (n = un(rn, c, t, T)) {
                    T.readyState = 1, u && p.trigger("ajaxSend", [T, c]), c.async && c.timeout > 0 && (s = setTimeout(function () {
                        T.abort("timeout")
                    }, c.timeout));
                    try {
                        v = 1, n.send(m, k)
                    } catch (C) {
                        if (!(2 > v))throw C;
                        k(-1, C)
                    }
                } else k(-1, "No Transport");
                function k(e, t, o, a) {
                    var l, m, y, b, w, C = t;
                    2 !== v && (v = 2, s && clearTimeout(s), n = undefined, i = a || "", T.readyState = e > 0 ? 4 : 0, l = e >= 200 && 300 > e || 304 === e, o && (b = cn(c, T, o)), b = fn(c, b, T, l), l ? (c.ifModified && (w = T.getResponseHeader("Last-Modified"), w && (x.lastModified[r] = w), w = T.getResponseHeader("etag"), w && (x.etag[r] = w)), 204 === e ? C = "nocontent" : 304 === e ? C = "notmodified" : (C = b.state, m = b.data, y = b.error, l = !y)) : (y = C, (e || !C) && (C = "error", 0 > e && (e = 0))), T.status = e, T.statusText = (t || C) + "", l ? h.resolveWith(f, [m, C, T]) : h.rejectWith(f, [T, C, y]), T.statusCode(g), g = undefined, u && p.trigger(l ? "ajaxSuccess" : "ajaxError", [T, c, l ? m : y]), d.fireWith(f, [T, C]), u && (p.trigger("ajaxComplete", [T, c]), --x.active || x.event.trigger("ajaxStop")))
                }

                return T
            },
            getJSON: function (e, t, n) {
                return x.get(e, t, n, "json")
            },
            getScript: function (e, t) {
                return x.get(e, undefined, t, "script")
            }
        }), x.each(["get", "post"], function (e, t) {
            x[t] = function (e, n, r, i) {
                return x.isFunction(n) && (i = i || r, r = n, n = undefined), x.ajax({url: e, type: t, dataType: i, data: n, success: r})
            }
        });
        function cn(e, t, n) {
            var r, i, o, s, a = e.contents, u = e.dataTypes;
            while ("*" === u[0])u.shift(), r === undefined && (r = e.mimeType || t.getResponseHeader("Content-Type"));
            if (r)for (i in a)if (a[i] && a[i].test(r)) {
                u.unshift(i);
                break
            }
            if (u[0] in n)o = u[0]; else {
                for (i in n) {
                    if (!u[0] || e.converters[i + " " + u[0]]) {
                        o = i;
                        break
                    }
                    s || (s = i)
                }
                o = o || s
            }
            return o ? (o !== u[0] && u.unshift(o), n[o]) : undefined
        }

        function fn(e, t, n, r) {
            var i, o, s, a, u, l = {}, c = e.dataTypes.slice();
            if (c[1])for (s in e.converters)l[s.toLowerCase()] = e.converters[s];
            o = c.shift();
            while (o)if (e.responseFields[o] && (n[e.responseFields[o]] = t), !u && r && e.dataFilter && (t = e.dataFilter(t, e.dataType)), u = o, o = c.shift())if ("*" === o)o = u; else if ("*" !== u && u !== o) {
                if (s = l[u + " " + o] || l["* " + o], !s)for (i in l)if (a = i.split(" "), a[1] === o && (s = l[u + " " + a[0]] || l["* " + a[0]])) {
                    s === !0 ? s = l[i] : l[i] !== !0 && (o = a[0], c.unshift(a[1]));
                    break
                }
                if (s !== !0)if (s && e["throws"])t = s(t); else try {
                    t = s(t)
                } catch (f) {
                    return {state: "parsererror", error: s ? f : "No conversion from " + u + " to " + o}
                }
            }
            return {state: "success", data: t}
        }

        x.ajaxSetup({
            accepts: {script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"}, contents: {script: /(?:java|ecma)script/}, converters: {
                "text script": function (e) {
                    return x.globalEval(e), e
                }
            }
        }), x.ajaxPrefilter("script", function (e) {
            e.cache === undefined && (e.cache = !1), e.crossDomain && (e.type = "GET")
        }), x.ajaxTransport("script", function (e) {
            if (e.crossDomain) {
                var t, n;
                return {
                    send: function (r, i) {
                        t = x("<script>").prop({async: !0, charset: e.scriptCharset, src: e.url}).on("load error", n = function (e) {
                            t.remove(), n = null, e && i("error" === e.type ? 404 : 200, e.type)
                        }), o.head.appendChild(t[0])
                    }, abort: function () {
                        n && n()
                    }
                }
            }
        });
        var pn = [], hn = /(=)\?(?=&|$)|\?\?/;
        x.ajaxSetup({
            jsonp: "callback", jsonpCallback: function () {
                var e = pn.pop() || x.expando + "_" + Ut++;
                return this[e] = !0, e
            }
        }), x.ajaxPrefilter("json jsonp", function (t, n, r) {
            var i, o, s, a = t.jsonp !== !1 && (hn.test(t.url) ? "url" : "string" == typeof t.data && !(t.contentType || "").indexOf("application/x-www-form-urlencoded") && hn.test(t.data) && "data");
            return a || "jsonp" === t.dataTypes[0] ? (i = t.jsonpCallback = x.isFunction(t.jsonpCallback) ? t.jsonpCallback() : t.jsonpCallback, a ? t[a] = t[a].replace(hn, "$1" + i) : t.jsonp !== !1 && (t.url += (Yt.test(t.url) ? "&" : "?") + t.jsonp + "=" + i), t.converters["script json"] = function () {
                return s || x.error(i + " was not called"), s[0]
            }, t.dataTypes[0] = "json", o = e[i], e[i] = function () {
                s = arguments
            }, r.always(function () {
                e[i] = o, t[i] && (t.jsonpCallback = n.jsonpCallback, pn.push(i)), s && x.isFunction(o) && o(s[0]), s = o = undefined
            }), "script") : undefined
        }), x.ajaxSettings.xhr = function () {
            try {
                return new XMLHttpRequest
            } catch (e) {
            }
        };
        var dn = x.ajaxSettings.xhr(), gn = {0: 200, 1223: 204}, mn = 0, yn = {};
        e.ActiveXObject && x(e).on("unload", function () {
            for (var e in yn)yn[e]();
            yn = undefined
        }), x.support.cors = !!dn && "withCredentials" in dn, x.support.ajax = dn = !!dn, x.ajaxTransport(function (e) {
            var t;
            return x.support.cors || dn && !e.crossDomain ? {
                send: function (n, r) {
                    var i, o, s = e.xhr();
                    if (s.open(e.type, e.url, e.async, e.username, e.password), e.xhrFields)for (i in e.xhrFields)s[i] = e.xhrFields[i];
                    e.mimeType && s.overrideMimeType && s.overrideMimeType(e.mimeType), e.crossDomain || n["X-Requested-With"] || (n["X-Requested-With"] = "XMLHttpRequest");
                    for (i in n)s.setRequestHeader(i, n[i]);
                    t = function (e) {
                        return function () {
                            t && (delete yn[o], t = s.onload = s.onerror = null, "abort" === e ? s.abort() : "error" === e ? r(s.status || 404, s.statusText) : r(gn[s.status] || s.status, s.statusText, "string" == typeof s.responseText ? {text: s.responseText} : undefined, s.getAllResponseHeaders()))
                        }
                    }, s.onload = t(), s.onerror = t("error"), t = yn[o = mn++] = t("abort"), s.send(e.hasContent && e.data || null)
                }, abort: function () {
                    t && t()
                }
            } : undefined
        });
        var vn, xn, bn = /^(?:toggle|show|hide)$/, wn = RegExp("^(?:([+-])=|)(" + b + ")([a-z%]*)$", "i"), Tn = /queueHooks$/, Cn = [Dn], kn = {
            "*": [function (e, t) {
                var n, r, i = this.createTween(e, t), o = wn.exec(t), s = i.cur(), a = +s || 0, u = 1, l = 20;
                if (o) {
                    if (n = +o[2], r = o[3] || (x.cssNumber[e] ? "" : "px"), "px" !== r && a) {
                        a = x.css(i.elem, e, !0) || n || 1;
                        do u = u || ".5", a /= u, x.style(i.elem, e, a + r); while (u !== (u = i.cur() / s) && 1 !== u && --l)
                    }
                    i.unit = r, i.start = a, i.end = o[1] ? a + (o[1] + 1) * n : n
                }
                return i
            }]
        };

        function Nn() {
            return setTimeout(function () {
                vn = undefined
            }), vn = x.now()
        }

        function En(e, t) {
            x.each(t, function (t, n) {
                var r = (kn[t] || []).concat(kn["*"]), i = 0, o = r.length;
                for (; o > i; i++)if (r[i].call(e, t, n))return
            })
        }

        function Sn(e, t, n) {
            var r, i, o = 0, s = Cn.length, a = x.Deferred().always(function () {
                delete u.elem
            }), u = function () {
                if (i)return !1;
                var t = vn || Nn(), n = Math.max(0, l.startTime + l.duration - t), r = n / l.duration || 0, o = 1 - r, s = 0, u = l.tweens.length;
                for (; u > s; s++)l.tweens[s].run(o);
                return a.notifyWith(e, [l, o, n]), 1 > o && u ? n : (a.resolveWith(e, [l]), !1)
            }, l = a.promise({
                elem: e, props: x.extend({}, t), opts: x.extend(!0, {specialEasing: {}}, n), originalProperties: t, originalOptions: n, startTime: vn || Nn(), duration: n.duration, tweens: [], createTween: function (t, n) {
                    var r = x.Tween(e, l.opts, t, n, l.opts.specialEasing[t] || l.opts.easing);
                    return l.tweens.push(r), r
                }, stop: function (t) {
                    var n = 0, r = t ? l.tweens.length : 0;
                    if (i)return this;
                    for (i = !0; r > n; n++)l.tweens[n].run(1);
                    return t ? a.resolveWith(e, [l, t]) : a.rejectWith(e, [l, t]), this
                }
            }), c = l.props;
            for (jn(c, l.opts.specialEasing); s > o; o++)if (r = Cn[o].call(l, e, c, l.opts))return r;
            return En(l, c), x.isFunction(l.opts.start) && l.opts.start.call(e, l), x.fx.timer(x.extend(u, {elem: e, anim: l, queue: l.opts.queue})), l.progress(l.opts.progress).done(l.opts.done, l.opts.complete).fail(l.opts.fail).always(l.opts.always)
        }

        function jn(e, t) {
            var n, r, i, o, s;
            for (n in e)if (r = x.camelCase(n), i = t[r], o = e[n], x.isArray(o) && (i = o[1], o = e[n] = o[0]), n !== r && (e[r] = o, delete e[n]), s = x.cssHooks[r], s && "expand" in s) {
                o = s.expand(o), delete e[r];
                for (n in o)n in e || (e[n] = o[n], t[n] = i)
            } else t[r] = i
        }

        x.Animation = x.extend(Sn, {
            tweener: function (e, t) {
                x.isFunction(e) ? (t = e, e = ["*"]) : e = e.split(" ");
                var n, r = 0, i = e.length;
                for (; i > r; r++)n = e[r], kn[n] = kn[n] || [], kn[n].unshift(t)
            }, prefilter: function (e, t) {
                t ? Cn.unshift(e) : Cn.push(e)
            }
        });
        function Dn(e, t, n) {
            var r, i, o, s, a, u, l, c, f, p = this, h = e.style, d = {}, g = [], m = e.nodeType && At(e);
            n.queue || (c = x._queueHooks(e, "fx"), null == c.unqueued && (c.unqueued = 0, f = c.empty.fire, c.empty.fire = function () {
                c.unqueued || f()
            }), c.unqueued++, p.always(function () {
                p.always(function () {
                    c.unqueued--, x.queue(e, "fx").length || c.empty.fire()
                })
            })), 1 === e.nodeType && ("height" in t || "width" in t) && (n.overflow = [h.overflow, h.overflowX, h.overflowY], "inline" === x.css(e, "display") && "none" === x.css(e, "float") && (h.display = "inline-block")), n.overflow && (h.overflow = "hidden", p.always(function () {
                h.overflow = n.overflow[0], h.overflowX = n.overflow[1], h.overflowY = n.overflow[2]
            })), a = q.get(e, "fxshow");
            for (r in t)if (o = t[r], bn.exec(o)) {
                if (delete t[r], u = u || "toggle" === o, o === (m ? "hide" : "show")) {
                    if ("show" !== o || a === undefined || a[r] === undefined)continue;
                    m = !0
                }
                g.push(r)
            }
            if (s = g.length) {
                a = q.get(e, "fxshow") || q.access(e, "fxshow", {}), "hidden" in a && (m = a.hidden), u && (a.hidden = !m), m ? x(e).show() : p.done(function () {
                    x(e).hide()
                }), p.done(function () {
                    var t;
                    q.remove(e, "fxshow");
                    for (t in d)x.style(e, t, d[t])
                });
                for (r = 0; s > r; r++)i = g[r], l = p.createTween(i, m ? a[i] : 0), d[i] = a[i] || x.style(e, i), i in a || (a[i] = l.start, m && (l.end = l.start, l.start = "width" === i || "height" === i ? 1 : 0))
            }
        }

        function An(e, t, n, r, i) {
            return new An.prototype.init(e, t, n, r, i)
        }

        x.Tween = An, An.prototype = {
            constructor: An, init: function (e, t, n, r, i, o) {
                this.elem = e, this.prop = n, this.easing = i || "swing", this.options = t, this.start = this.now = this.cur(), this.end = r, this.unit = o || (x.cssNumber[n] ? "" : "px")
            }, cur: function () {
                var e = An.propHooks[this.prop];
                return e && e.get ? e.get(this) : An.propHooks._default.get(this)
            }, run: function (e) {
                var t, n = An.propHooks[this.prop];
                return this.pos = t = this.options.duration ? x.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : e, this.now = (this.end - this.start) * t + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), n && n.set ? n.set(this) : An.propHooks._default.set(this), this
            }
        }, An.prototype.init.prototype = An.prototype, An.propHooks = {
            _default: {
                get: function (e) {
                    var t;
                    return null == e.elem[e.prop] || e.elem.style && null != e.elem.style[e.prop] ? (t = x.css(e.elem, e.prop, ""), t && "auto" !== t ? t : 0) : e.elem[e.prop]
                }, set: function (e) {
                    x.fx.step[e.prop] ? x.fx.step[e.prop](e) : e.elem.style && (null != e.elem.style[x.cssProps[e.prop]] || x.cssHooks[e.prop]) ? x.style(e.elem, e.prop, e.now + e.unit) : e.elem[e.prop] = e.now
                }
            }
        }, An.propHooks.scrollTop = An.propHooks.scrollLeft = {
            set: function (e) {
                e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now)
            }
        }, x.each(["toggle", "show", "hide"], function (e, t) {
            var n = x.fn[t];
            x.fn[t] = function (e, r, i) {
                return null == e || "boolean" == typeof e ? n.apply(this, arguments) : this.animate(Ln(t, !0), e, r, i)
            }
        }), x.fn.extend({
            fadeTo: function (e, t, n, r) {
                return this.filter(At).css("opacity", 0).show().end().animate({opacity: t}, e, n, r)
            }, animate: function (e, t, n, r) {
                var i = x.isEmptyObject(e), o = x.speed(t, n, r), s = function () {
                    var t = Sn(this, x.extend({}, e), o);
                    s.finish = function () {
                        t.stop(!0)
                    }, (i || q.get(this, "finish")) && t.stop(!0)
                };
                return s.finish = s, i || o.queue === !1 ? this.each(s) : this.queue(o.queue, s)
            }, stop: function (e, t, n) {
                var r = function (e) {
                    var t = e.stop;
                    delete e.stop, t(n)
                };
                return "string" != typeof e && (n = t, t = e, e = undefined), t && e !== !1 && this.queue(e || "fx", []), this.each(function () {
                    var t = !0, i = null != e && e + "queueHooks", o = x.timers, s = q.get(this);
                    if (i)s[i] && s[i].stop && r(s[i]); else for (i in s)s[i] && s[i].stop && Tn.test(i) && r(s[i]);
                    for (i = o.length; i--;)o[i].elem !== this || null != e && o[i].queue !== e || (o[i].anim.stop(n), t = !1, o.splice(i, 1));
                    (t || !n) && x.dequeue(this, e)
                })
            }, finish: function (e) {
                return e !== !1 && (e = e || "fx"), this.each(function () {
                    var t, n = q.get(this), r = n[e + "queue"], i = n[e + "queueHooks"], o = x.timers, s = r ? r.length : 0;
                    for (n.finish = !0, x.queue(this, e, []), i && i.cur && i.cur.finish && i.cur.finish.call(this), t = o.length; t--;)o[t].elem === this && o[t].queue === e && (o[t].anim.stop(!0), o.splice(t, 1));
                    for (t = 0; s > t; t++)r[t] && r[t].finish && r[t].finish.call(this);
                    delete n.finish
                })
            }
        });
        function Ln(e, t) {
            var n, r = {height: e}, i = 0;
            for (t = t ? 1 : 0; 4 > i; i += 2 - t)n = St[i], r["margin" + n] = r["padding" + n] = e;
            return t && (r.opacity = r.width = e), r
        }

        x.each({slideDown: Ln("show"), slideUp: Ln("hide"), slideToggle: Ln("toggle"), fadeIn: {opacity: "show"}, fadeOut: {opacity: "hide"}, fadeToggle: {opacity: "toggle"}}, function (e, t) {
            x.fn[e] = function (e, n, r) {
                return this.animate(t, e, n, r)
            }
        }), x.speed = function (e, t, n) {
            var r = e && "object" == typeof e ? x.extend({}, e) : {complete: n || !n && t || x.isFunction(e) && e, duration: e, easing: n && t || t && !x.isFunction(t) && t};
            return r.duration = x.fx.off ? 0 : "number" == typeof r.duration ? r.duration : r.duration in x.fx.speeds ? x.fx.speeds[r.duration] : x.fx.speeds._default, (null == r.queue || r.queue === !0) && (r.queue = "fx"), r.old = r.complete, r.complete = function () {
                x.isFunction(r.old) && r.old.call(this), r.queue && x.dequeue(this, r.queue)
            }, r
        }, x.easing = {
            linear: function (e) {
                return e
            }, swing: function (e) {
                return .5 - Math.cos(e * Math.PI) / 2
            }
        }, x.timers = [], x.fx = An.prototype.init, x.fx.tick = function () {
            var e, t = x.timers, n = 0;
            for (vn = x.now(); t.length > n; n++)e = t[n], e() || t[n] !== e || t.splice(n--, 1);
            t.length || x.fx.stop(), vn = undefined
        }, x.fx.timer = function (e) {
            e() && x.timers.push(e) && x.fx.start()
        }, x.fx.interval = 13, x.fx.start = function () {
            xn || (xn = setInterval(x.fx.tick, x.fx.interval))
        }, x.fx.stop = function () {
            clearInterval(xn), xn = null
        }, x.fx.speeds = {slow: 600, fast: 200, _default: 400}, x.fx.step = {}, x.expr && x.expr.filters && (x.expr.filters.animated = function (e) {
            return x.grep(x.timers, function (t) {
                return e === t.elem
            }).length
        }), x.fn.offset = function (e) {
            if (arguments.length)return e === undefined ? this : this.each(function (t) {
                x.offset.setOffset(this, e, t)
            });
            var t, n, i = this[0], o = {top: 0, left: 0}, s = i && i.ownerDocument;
            if (s)return t = s.documentElement, x.contains(t, i) ? (typeof i.getBoundingClientRect !== r && (o = i.getBoundingClientRect()), n = qn(s), {top: o.top + n.pageYOffset - t.clientTop, left: o.left + n.pageXOffset - t.clientLeft}) : o
        }, x.offset = {
            setOffset: function (e, t, n) {
                var r, i, o, s, a, u, l, c = x.css(e, "position"), f = x(e), p = {};
                "static" === c && (e.style.position = "relative"), a = f.offset(), o = x.css(e, "top"), u = x.css(e, "left"), l = ("absolute" === c || "fixed" === c) && (o + u).indexOf("auto") > -1, l ? (r = f.position(), s = r.top, i = r.left) : (s = parseFloat(o) || 0, i = parseFloat(u) || 0), x.isFunction(t) && (t = t.call(e, n, a)), null != t.top && (p.top = t.top - a.top + s), null != t.left && (p.left = t.left - a.left + i), "using" in t ? t.using.call(e, p) : f.css(p)
            }
        }, x.fn.extend({
            position: function () {
                if (this[0]) {
                    var e, t, n = this[0], r = {top: 0, left: 0};
                    return "fixed" === x.css(n, "position") ? t = n.getBoundingClientRect() : (e = this.offsetParent(), t = this.offset(), x.nodeName(e[0], "html") || (r = e.offset()), r.top += x.css(e[0], "borderTopWidth", !0), r.left += x.css(e[0], "borderLeftWidth", !0)), {top: t.top - r.top - x.css(n, "marginTop", !0), left: t.left - r.left - x.css(n, "marginLeft", !0)}
                }
            }, offsetParent: function () {
                return this.map(function () {
                    var e = this.offsetParent || s;
                    while (e && !x.nodeName(e, "html") && "static" === x.css(e, "position"))e = e.offsetParent;
                    return e || s
                })
            }
        }), x.each({scrollLeft: "pageXOffset", scrollTop: "pageYOffset"}, function (t, n) {
            var r = "pageYOffset" === n;
            x.fn[t] = function (i) {
                return x.access(this, function (t, i, o) {
                    var s = qn(t);
                    return o === undefined ? s ? s[n] : t[i] : (s ? s.scrollTo(r ? e.pageXOffset : o, r ? o : e.pageYOffset) : t[i] = o, undefined)
                }, t, i, arguments.length, null)
            }
        });
        function qn(e) {
            return x.isWindow(e) ? e : 9 === e.nodeType && e.defaultView
        }

        x.each({Height: "height", Width: "width"}, function (e, t) {
            x.each({padding: "inner" + e, content: t, "": "outer" + e}, function (n, r) {
                x.fn[r] = function (r, i) {
                    var o = arguments.length && (n || "boolean" != typeof r), s = n || (r === !0 || i === !0 ? "margin" : "border");
                    return x.access(this, function (t, n, r) {
                        var i;
                        return x.isWindow(t) ? t.document.documentElement["client" + e] : 9 === t.nodeType ? (i = t.documentElement, Math.max(t.body["scroll" + e], i["scroll" + e], t.body["offset" + e], i["offset" + e], i["client" + e])) : r === undefined ? x.css(t, n, s) : x.style(t, n, r, s)
                    }, t, o ? r : undefined, o, null)
                }
            })
        }), x.fn.size = function () {
            return this.length
        }, x.fn.andSelf = x.fn.addBack, "object" == typeof module && "object" == typeof module.exports ? module.exports = x : "function" == typeof define && define.amd && define("jquery", [], function () {
            return x
        }), "object" == typeof e && "object" == typeof e.document && (e.jQuery = e.$ = x)
    })(window);


    (function ($) {
        $.extend($.fn, {
            live: function (event, fn) {
                $(document).delegate(this.selector, event, fn);
                return this;
            },
            die: function (event, fn) {
                $(document).undelegate(this.selector, event, fn);
                return this;
            },
            swap: function (b) {
                b = $(b)[0];
                var a = this[0];
                if (a && b) {
                    var t = a.parentNode.insertBefore(document.createTextNode(''), a);
                    b.parentNode.insertBefore(a, b);
                    t.parentNode.insertBefore(b, t);
                    t.parentNode.removeChild(t);
                }
                return this;
            }
        });
    })($);

    /* Laura Doktorova https://github.com/olado/doT */
    (function () {
        function o() {
            var a = {"&": "&#38;", "<": "&#60;", ">": "&#62;", '"': "&#34;", "'": "&#39;", "/": "&#47;"}, b = /&(?!#?\w+;)|<|>|"|'|\//g;
            return function () {
                return this ? this.replace(b, function (c) {
                    return a[c] || c
                }) : this
            }
        }

        function p(a, b, c) {
            return (typeof b === "string" ? b : b.toString()).replace(a.define || i, function (l, e, f, g) {
                if (e.indexOf("def.") === 0)e = e.substring(4);
                if (!(e in c))if (f === ":") {
                    a.defineParams && g.replace(a.defineParams, function (n, h, d) {
                        c[e] = {arg: h, text: d}
                    });
                    e in c || (c[e] = g)
                } else(new Function("def", "def['" +
                        e + "']=" + g))(c);
                return ""
            }).replace(a.use || i, function (l, e) {
                if (a.useParams)e = e.replace(a.useParams, function (g, n, h, d) {
                    if (c[h] && c[h].arg && d) {
                        g = (h + ":" + d).replace(/'|\\/g, "_");
                        c.__exp = c.__exp || {};
                        c.__exp[g] = c[h].text.replace(RegExp("(^|[^\\w$])" + c[h].arg + "([^\\w$])", "g"), "$1" + d + "$2");
                        return n + "def.__exp['" + g + "']"
                    }
                });
                var f = (new Function("def", "return " + e))(c);
                return f ? p(a, f, c) : f
            })
        }

        function m(a) {
            return a.replace(/\\('|\\)/g, "$1").replace(/[\r\t\n]/g, " ")
        }

        var j = {
            version: "1.0.0", templateSettings: {
                evaluate: /\{\{([\s\S]+?\}?)\}\}/g,
                interpolate: /\{\{=([\s\S]+?)\}\}/g,
                encode: /\{\{!([\s\S]+?)\}\}/g,
                use: /\{\{#([\s\S]+?)\}\}/g,
                useParams: /(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,
                define: /\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,
                defineParams: /^\s*([\w$]+):([\s\S]+)/,
                conditional: /\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,
                iterate: /\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,
                varname: "it",
                strip: true,
                append: true,
                selfcontained: false
            }, template: undefined,
            compile: undefined
        };
        if (typeof module !== "undefined" && module.exports)module.exports = j; else if (typeof define === "function" && define.amd)define(function () {
            return j
        }); else(function () {
            return this || (0, eval)("this")
        })().doT = j;
        String.prototype.encodeHTML = o();
        var q = {append: {start: "'+(", end: ")+'", endencode: "||'').toString().encodeHTML()+'"}, split: {start: "';out+=(", end: ");out+='", endencode: "||'').toString().encodeHTML();out+='"}}, i = /$^/;
        j.template = function (a, b, c) {
            b = b || j.templateSettings;
            var l = b.append ? q.append :
                    q.split, e, f = 0, g;
            a = b.use || b.define ? p(b, a, c || {}) : a;
            a = ("var out='" + (b.strip ? a.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g, " ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g, "") : a).replace(/'|\\/g, "\\$&").replace(b.interpolate || i, function (h, d) {
                return l.start + m(d) + l.end
            }).replace(b.encode || i, function (h, d) {
                e = true;
                return l.start + m(d) + l.endencode
            }).replace(b.conditional || i, function (h, d, k) {
                return d ? k ? "';}else if(" + m(k) + "){out+='" : "';}else{out+='" : k ? "';if(" + m(k) + "){out+='" : "';}out+='"
            }).replace(b.iterate || i, function (h,
                                                 d, k, r) {
                if (!d)return "';} } out+='";
                f += 1;
                g = r || "i" + f;
                d = m(d);
                return "';var arr" + f + "=" + d + ";if(arr" + f + "){var " + k + "," + g + "=-1,l" + f + "=arr" + f + ".length-1;while(" + g + "<l" + f + "){" + k + "=arr" + f + "[" + g + "+=1];out+='"
            }).replace(b.evaluate || i, function (h, d) {
                return "';" + m(d) + "out+='"
            }) + "';return out;").replace(/\n/g, "\\n").replace(/\t/g, "\\t").replace(/\r/g, "\\r").replace(/(\s|;|\}|^|\{)out\+='';/g, "$1").replace(/\+''/g, "").replace(/(\s|;|\}|^|\{)out\+=''\+/g, "$1out+=");
            if (e && b.selfcontained)a = "String.prototype.encodeHTML=(" +
                    o.toString() + "());" + a;
            try {
                return new Function(b.varname, a)
            } catch (n) {
                typeof console !== "undefined" && console.log("Could not create a template function: " + a);
                throw n;
            }
        };
        j.compile = function (a, b) {
            return j.template(a, null, b)
        }
    })();


    function hex_md5(e) {
        return rstr2hex(rstr_md5(str2rstr_utf8(e)))
    }

    function hex_hmac_md5(e, t) {
        return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e), str2rstr_utf8(t)))
    }

    function md5_vm_test() {
        return hex_md5("abc").toLowerCase() == "900150983cd24fb0d6963f7d28e17f72"
    }

    function rstr_md5(e) {
        return binl2rstr(binl_md5(rstr2binl(e), e.length * 8))
    }

    function rstr_hmac_md5(e, t) {
        var n = rstr2binl(e);
        n.length > 16 && (n = binl_md5(n, e.length * 8));
        var r = Array(16), i = Array(16);
        for (var s = 0; s < 16; s++)r[s] = n[s] ^ 909522486, i[s] = n[s] ^ 1549556828;
        var o = binl_md5(r.concat(rstr2binl(t)), 512 + t.length * 8);
        return binl2rstr(binl_md5(i.concat(o), 640))
    }

    function rstr2hex(e) {
        try {
            hexcase
        } catch (t) {
            hexcase = 0
        }
        var n = hexcase ? "0123456789ABCDEF" : "0123456789abcdef", r = "", i;
        for (var s = 0; s < e.length; s++)i = e.charCodeAt(s), r += n.charAt(i >>> 4 & 15) + n.charAt(i & 15);
        return r
    }

    function str2rstr_utf8(e) {
        var t = "", n = -1, r, i;
        while (++n < e.length)r = e.charCodeAt(n), i = n + 1 < e.length ? e.charCodeAt(n + 1) : 0, 55296 <= r && r <= 56319 && 56320 <= i && i <= 57343 && (r = 65536 + ((r & 1023) << 10) + (i & 1023), n++), r <= 127 ? t += String.fromCharCode(r) : r <= 2047 ? t += String.fromCharCode(192 | r >>> 6 & 31, 128 | r & 63) : r <= 65535 ? t += String.fromCharCode(224 | r >>> 12 & 15, 128 | r >>> 6 & 63, 128 | r & 63) : r <= 2097151 && (t += String.fromCharCode(240 | r >>> 18 & 7, 128 | r >>> 12 & 63, 128 | r >>> 6 & 63, 128 | r & 63));
        return t
    }

    function rstr2binl(e) {
        var t = Array(e.length >> 2);
        for (var n = 0; n < t.length; n++)t[n] = 0;
        for (var n = 0; n < e.length * 8; n += 8)t[n >> 5] |= (e.charCodeAt(n / 8) & 255) << n % 32;
        return t
    }

    function binl2rstr(e) {
        var t = "";
        for (var n = 0; n < e.length * 32; n += 8)t += String.fromCharCode(e[n >> 5] >>> n % 32 & 255);
        return t
    }

    function binl_md5(e, t) {
        e[t >> 5] |= 128 << t % 32, e[(t + 64 >>> 9 << 4) + 14] = t;
        var n = 1732584193, r = -271733879, i = -1732584194, s = 271733878;
        for (var o = 0; o < e.length; o += 16) {
            var u = n, a = r, f = i, l = s;
            n = md5_ff(n, r, i, s, e[o + 0], 7, -680876936), s = md5_ff(s, n, r, i, e[o + 1], 12, -389564586), i = md5_ff(i, s, n, r, e[o + 2], 17, 606105819), r = md5_ff(r, i, s, n, e[o + 3], 22, -1044525330), n = md5_ff(n, r, i, s, e[o + 4], 7, -176418897), s = md5_ff(s, n, r, i, e[o + 5], 12, 1200080426), i = md5_ff(i, s, n, r, e[o + 6], 17, -1473231341), r = md5_ff(r, i, s, n, e[o + 7], 22, -45705983), n = md5_ff(n, r, i, s, e[o + 8], 7, 1770035416), s = md5_ff(s, n, r, i, e[o + 9], 12, -1958414417), i = md5_ff(i, s, n, r, e[o + 10], 17, -42063), r = md5_ff(r, i, s, n, e[o + 11], 22, -1990404162), n = md5_ff(n, r, i, s, e[o + 12], 7, 1804603682), s = md5_ff(s, n, r, i, e[o + 13], 12, -40341101), i = md5_ff(i, s, n, r, e[o + 14], 17, -1502002290), r = md5_ff(r, i, s, n, e[o + 15], 22, 1236535329), n = md5_gg(n, r, i, s, e[o + 1], 5, -165796510), s = md5_gg(s, n, r, i, e[o + 6], 9, -1069501632), i = md5_gg(i, s, n, r, e[o + 11], 14, 643717713), r = md5_gg(r, i, s, n, e[o + 0], 20, -373897302), n = md5_gg(n, r, i, s, e[o + 5], 5, -701558691), s = md5_gg(s, n, r, i, e[o + 10], 9, 38016083), i = md5_gg(i, s, n, r, e[o + 15], 14, -660478335), r = md5_gg(r, i, s, n, e[o + 4], 20, -405537848), n = md5_gg(n, r, i, s, e[o + 9], 5, 568446438), s = md5_gg(s, n, r, i, e[o + 14], 9, -1019803690), i = md5_gg(i, s, n, r, e[o + 3], 14, -187363961), r = md5_gg(r, i, s, n, e[o + 8], 20, 1163531501), n = md5_gg(n, r, i, s, e[o + 13], 5, -1444681467), s = md5_gg(s, n, r, i, e[o + 2], 9, -51403784), i = md5_gg(i, s, n, r, e[o + 7], 14, 1735328473), r = md5_gg(r, i, s, n, e[o + 12], 20, -1926607734), n = md5_hh(n, r, i, s, e[o + 5], 4, -378558), s = md5_hh(s, n, r, i, e[o + 8], 11, -2022574463), i = md5_hh(i, s, n, r, e[o + 11], 16, 1839030562), r = md5_hh(r, i, s, n, e[o + 14], 23, -35309556), n = md5_hh(n, r, i, s, e[o + 1], 4, -1530992060), s = md5_hh(s, n, r, i, e[o + 4], 11, 1272893353), i = md5_hh(i, s, n, r, e[o + 7], 16, -155497632), r = md5_hh(r, i, s, n, e[o + 10], 23, -1094730640), n = md5_hh(n, r, i, s, e[o + 13], 4, 681279174), s = md5_hh(s, n, r, i, e[o + 0], 11, -358537222), i = md5_hh(i, s, n, r, e[o + 3], 16, -722521979), r = md5_hh(r, i, s, n, e[o + 6], 23, 76029189), n = md5_hh(n, r, i, s, e[o + 9], 4, -640364487), s = md5_hh(s, n, r, i, e[o + 12], 11, -421815835), i = md5_hh(i, s, n, r, e[o + 15], 16, 530742520), r = md5_hh(r, i, s, n, e[o + 2], 23, -995338651), n = md5_ii(n, r, i, s, e[o + 0], 6, -198630844), s = md5_ii(s, n, r, i, e[o + 7], 10, 1126891415), i = md5_ii(i, s, n, r, e[o + 14], 15, -1416354905), r = md5_ii(r, i, s, n, e[o + 5], 21, -57434055), n = md5_ii(n, r, i, s, e[o + 12], 6, 1700485571), s = md5_ii(s, n, r, i, e[o + 3], 10, -1894986606), i = md5_ii(i, s, n, r, e[o + 10], 15, -1051523), r = md5_ii(r, i, s, n, e[o + 1], 21, -2054922799), n = md5_ii(n, r, i, s, e[o + 8], 6, 1873313359), s = md5_ii(s, n, r, i, e[o + 15], 10, -30611744), i = md5_ii(i, s, n, r, e[o + 6], 15, -1560198380), r = md5_ii(r, i, s, n, e[o + 13], 21, 1309151649), n = md5_ii(n, r, i, s, e[o + 4], 6, -145523070), s = md5_ii(s, n, r, i, e[o + 11], 10, -1120210379), i = md5_ii(i, s, n, r, e[o + 2], 15, 718787259), r = md5_ii(r, i, s, n, e[o + 9], 21, -343485551), n = safe_add(n, u), r = safe_add(r, a), i = safe_add(i, f), s = safe_add(s, l)
        }
        return Array(n, r, i, s)
    }

    function md5_cmn(e, t, n, r, i, s) {
        return safe_add(bit_rol(safe_add(safe_add(t, e), safe_add(r, s)), i), n)
    }

    function md5_ff(e, t, n, r, i, s, o) {
        return md5_cmn(t & n | ~t & r, e, t, i, s, o)
    }

    function md5_gg(e, t, n, r, i, s, o) {
        return md5_cmn(t & r | n & ~r, e, t, i, s, o)
    }

    function md5_hh(e, t, n, r, i, s, o) {
        return md5_cmn(t ^ n ^ r, e, t, i, s, o)
    }

    function md5_ii(e, t, n, r, i, s, o) {
        return md5_cmn(n ^ (t | ~r), e, t, i, s, o)
    }

    function safe_add(e, t) {
        var n = (e & 65535) + (t & 65535), r = (e >> 16) + (t >> 16) + (n >> 16);
        return r << 16 | n & 65535
    }

    function bit_rol(e, t) {
        return e << t | e >>> 32 - t
    }

    var hexcase = 0;

﻿/*
     * jQuery Autocomplete plugin 1.1
     *
     * Copyright (c) 2009 Jörn Zaefferer
     *
     * Revision: $Id: jquery.autocomplete.js 15 2009-08-22 10:30:27Z joern.zaefferer $
     */

    ;
    (function ($) {

        $.extend($.fn, {
            autocomplete: function (urlOrData, options) {
                var isUrl = typeof urlOrData == "string";
                options = $.extend({},
                        $.Autocompleter.defaults, {
                            url: isUrl ? urlOrData : null,
                            data: isUrl ? null : urlOrData,
                            delay: isUrl ? $.Autocompleter.defaults.delay : 10,
                            max: options && !options.scroll ? 10 : 150
                        },
                        options);

                // if highlight is set to false, replace it with a do-nothing function
                options.highlight = options.highlight || function (value) {
                            return value;
                        };

                // if the formatMatch option is not specified, then use formatItem for backwards compatibility
                options.formatMatch = options.formatMatch || options.formatItem;

                return this.each(function () {
                    new $.Autocompleter(this, options);
                });
            },
            result: function (handler) {
                return this.bind("result", handler);
            },
            search: function (handler) {
                return this.trigger("search", [handler]);
            },
            flushCache: function () {
                return this.trigger("flushCache");
            },
            setOptions: function (options) {
                return this.trigger("setOptions", [options]);
            },
            unautocomplete: function () {
                return this.trigger("unautocomplete");
            }
        });

        $.Autocompleter = function (input, options) {

            var KEY = {
                UP: 38,
                DOWN: 40,
                DEL: 46,
                TAB: 9,
                RETURN: 13,
                ESC: 27,
                COMMA: 188,
                PAGEUP: 33,
                PAGEDOWN: 34,
                BACKSPACE: 8
            };

            // Create $ object for input element
            var $input = $(input).attr("autocomplete", "off").addClass(options.inputClass);

            var timeout;
            var previousValue = "";
            var cache = $.Autocompleter.Cache(options);
            var hasFocus = 0;
            var lastKeyPressCode;
            var config = {
                mouseDownOnSelect: false
            };
            var select = $.Autocompleter.Select(options, input, selectCurrent, config);
            $(window).on('resize', function () {
                setTimeout(select.repos, 10);
            });
            if (input.id == 'search-kw') {
                window.sugSelect = select;
            }
            select.display([], '');
            /*select.display([{data:['abc'], value:'abc', result:'abc'}, {data:['abc'], value:'abc', result:'abc'}], '');
             select.show();*/

            var blockSubmit;

            $input.bind("input.autocomplete", function (event) {
                clearTimeout(timeout);
                timeout = setTimeout(onChange, options.delay);
            });
            // only opera doesn't trigger keydown multiple times while pressed, others don't work with keypress at all
            $input.bind("keydown.autocomplete", function (event) {
                // a keypress means the input has focus
                // avoids issue where input had focus before the autocomplete was applied
                hasFocus = 1;
                // track last key pressed
                lastKeyPressCode = event.keyCode;
                switch (event.keyCode) {

                    case KEY.UP:
                        event.preventDefault();
                        if (select.visible()) {
                            select.prev();
                        } else {
                            onChange(0, true);
                        }
                        break;

                    case KEY.DOWN:
                        event.preventDefault();
                        if (select.visible()) {
                            select.next();
                        } else {
                            onChange(0, true);
                        }
                        break;

                    case KEY.PAGEUP:
                        event.preventDefault();
                        if (select.visible()) {
                            select.pageUp();
                        } else {
                            onChange(0, true);
                        }
                        break;

                    case KEY.PAGEDOWN:
                        event.preventDefault();
                        if (select.visible()) {
                            select.pageDown();
                        } else {
                            onChange(0, true);
                        }
                        break;

                    // matches also semicolon
                    case options.multiple && $.trim(options.multipleSeparator) == "," && KEY.COMMA:
                    case KEY.TAB:
                    case KEY.RETURN:
                        if (selectCurrent()) {
                            // stop default to prevent a form submit, Opera needs special handling
                            event.preventDefault();
                            blockSubmit = true;
                            return false;
                        }
                        break;

                    case KEY.ESC:
                        select.hide();
                        break;

                    default:
                        clearTimeout(timeout);
                        timeout = setTimeout(onChange, options.delay);
                        break;
                }
            }).focus(function () {
                // track whether the field has focus, we shouldn't process any
                // results if the field no longer has focus
                hasFocus++;
            }).blur(function () {
                hasFocus = 0;
                if (!config.mouseDownOnSelect) {
                    hideResults();
                }
            }).click(function () {
                // show select when clicking in a focused field
                if (hasFocus++ > 1 && !select.visible()) {
                    onChange(0, true);
                }
            }).bind("search", function () {
                // TODO why not just specifying both arguments?
                var fn = (arguments.length > 1) ? arguments[1] : null;

                function findValueCallback(q, data) {
                    var result;
                    if (data && data.length) {
                        for (var i = 0; i < data.length; i++) {
                            if (data[i].result.toLowerCase() == q.toLowerCase()) {
                                result = data[i];
                                break;
                            }
                        }
                    }
                    if (typeof fn == "function") fn(result);
                    else $input.trigger("result", result && [result.data, result.value]);
                }

                $.each(trimWords($input.val()), function (i, value) {
                    request(value, findValueCallback, findValueCallback);
                });
            }).bind("flushCache", function () {
                cache.flush();
            }).bind("setOptions", function () {
                $.extend(options, arguments[1]);
                // if we've updated the data, repopulate
                if ("data" in arguments[1]) cache.populate();
            }).bind("unautocomplete", function () {
                select.unbind();
                $input.unbind();
                $(input.form).unbind(".autocomplete");
            });

            $(document).mousedown(function () {
                hasFocus = 0;
                hideResults();
            });

            function selectCurrent() {
                var selected = select.selected();
                if (!selected) return false;

                var v = selected.keyword || selected.result;
                previousValue = v;

                if (options.multiple) {
                    var words = trimWords($input.val());
                    if (words.length > 1) {
                        var seperator = options.multipleSeparator.length;
                        var cursorAt = $(input).selection().start;
                        var wordAt, progress = 0;
                        $.each(words, function (i, word) {
                            progress += word.length;
                            if (cursorAt <= progress) {
                                wordAt = i;
                                return false;
                            }
                            progress += seperator;
                        });
                        words[wordAt] = v;
                        // TODO this should set the cursor to the right position, but it gets overriden somewhere
                        //$.Autocompleter.Selection(input, progress + seperator, progress + seperator);
                        v = words.join(options.multipleSeparator);
                    }
                    v += options.multipleSeparator;
                }

                $input.val(v);
                hideResultsNow();
                $input.trigger("result", [selected]);
                return true;
            }

            function onChange(crap, skipPrevCheck) {
                // // 按删除键不触发suggest
                // if (lastKeyPressCode == KEY.DEL) {
                //   select.hide();
                //   return;
                // }

                var currentValue = $input.val();

                if (!skipPrevCheck && currentValue == previousValue) return;

                previousValue = currentValue;

                currentValue = lastWord(currentValue);
                if (currentValue.length >= options.minChars) {
                    $input.addClass(options.loadingClass);
                    if (!options.matchCase) currentValue = currentValue.toLowerCase();
                    request(currentValue, receiveData, hideResultsNow);
                } else {
                    stopLoading();
                    select.hide();
                }
            };

            function trimWords(value) {
                if (!value) return [""];
                if (!options.multiple) return [$.trim(value)];
                return $.map(value.split(options.multipleSeparator), function (word) {
                    return $.trim(value).length ? $.trim(word) : null;
                });
            }

            function lastWord(value) {
                if (!options.multiple) return value;
                var words = trimWords(value);
                if (words.length == 1) return words[0];
                var cursorAt = $(input).selection().start;
                if (cursorAt == value.length) {
                    words = trimWords(value)
                } else {
                    words = trimWords(value.replace(value.substring(cursorAt), ""));
                }
                return words[words.length - 1];
            }

            // fills in the input box w/the first match (assumed to be the best match)
            // q: the term entered
            // sValue: the first matching result
            function autoFill(q, sValue) {
                // autofill in the complete box w/the first match as long as the user hasn't entered in more data
                // if the last user key pressed was backspace, don't autofill
                if (options.autoFill && (lastWord($input.val()).toLowerCase() == q.toLowerCase()) && lastKeyPressCode != KEY.BACKSPACE) {
                    // fill in the value (keep the case the user has typed)
                    $input.val($input.val() + sValue.substring(lastWord(previousValue).length));
                    // select the portion of the value not typed by the user (so the next character will erase)
                    $(input).selection(previousValue.length, previousValue.length + sValue.length);
                }
            };

            function hideResults() {
                clearTimeout(timeout);
                timeout = window.sug_hide_timeout = setTimeout(hideResultsNow, 0);
            };

            function hideResultsNow() {
                var wasVisible = select.visible();
                select.hide();
                $('#search-hotword').removeClass('open');
                clearTimeout(timeout);
                stopLoading();
                if (options.mustMatch) {
                    // call search and run callback
                    $input.search(
                            function (result) {
                                // if no value found, clear the input box
                                if (!result) {
                                    if (options.multiple) {
                                        var words = trimWords($input.val()).slice(0, -1);
                                        $input.val(words.join(options.multipleSeparator) + (words.length ? options.multipleSeparator : ""));
                                    } else {
                                        $input.val("");
                                        $input.trigger("result", null);
                                    }
                                }
                            });
                }
            };

            function receiveData(q, data) {
                if (data && data.length && hasFocus) {

                    if (options.zhida === true) {
                        do360soZhida(q, data);
                    }

                    stopLoading();
                    select.display(data, q);
                    autoFill(q, data[0].value);
                    select.show();
                    $('#search-hotword').removeClass('open');
                } else {
                    hideResultsNow();
                }
            };

            function do360soZhida(q, data) {
                var q1 = q;
                var q2 = data[0].value;

                if (q1.length < 2) {
                    return;
                }

                if (/^[\x00-\xff]+$/.test(q1)) {
                    q1 = '';
                }

                $.ajax({
                    url: 'http://gem.www.so.com/zhida',
                    dataType: 'jsonp',
                    data: {
                        'q1': q1,
                        'q2': q2
                    },
                    success: function (ret) {
                        var json;
                        if (ret.errno === 0) {
                            try {
                                json = JSON.parse(ret.msg);
                            } catch (e) {
                            }
                        }
                        if (json && json.SiteName) {
                            var v = json.SiteName;
                            if (data[0].zhida) {
                                data.shift();
                            }
                            data.unshift({
                                data: json,
                                result: v,
                                value: v,
                                link: json.Host,
                                zhida: true
                            });
                            select.display(data, q);
                        }
                    }
                });
            }

            function request(term, success, failure) {
                if (!options.matchCase) term = term.toLowerCase();
                var data = cache.load(term);
                // recieve the cached data
                if (data && data.length) {
                    success(term, data);
                    // if an AJAX url has been supplied, try loading the data now
                } else if ((typeof options.url == "string") && (options.url.length > 0)) {

                    var extraParams = {
                        timestamp: +new Date()
                    };
                    $.each(options.extraParams, function (key, param) {
                        extraParams[key] = typeof param == "function" ? param() : param;
                    });

                    $.ajax({
                        // try to leverage ajaxQueue plugin to abort previous requests
                        mode: "abort",
                        // limit abortion to this input
                        port: "autocomplete" + input.name,
                        dataType: options.dataType,
                        url: options.url,
                        data: $.extend({
                                    word: filterUrl(filterParam(lastWord(term))),
                                    limit: options.max
                                },
                                extraParams),
                        success: function (data) {
                            var parsed = options.parse && options.parse(data) || parse(data);
                            cache.add(term, parsed);
                            success(term, parsed);
                        }
                    });
                } else {
                    // if we have a failure, we need to empty the list -- this prevents the the [TAB] key from selecting the last successful match
                    select.emptyList();
                    failure(term);
                }
            };

            function parse(data) {
                var parsed = [];
                var rows = data.split("\n");
                for (var i = 0; i < rows.length; i++) {
                    var row = $.trim(rows[i]);
                    if (row) {
                        row = row.split("|");
                        parsed[parsed.length] = {
                            data: row,
                            value: row[0],
                            result: options.formatResult && options.formatResult(row, row[0]) || row[0]
                        };
                    }
                }
                return parsed;
            };

            function stopLoading() {
                $input.removeClass(options.loadingClass);
            };

        };

        $.Autocompleter.defaults = {
            inputClass: "ac_input",
            resultsClass: "ac_results",
            loadingClass: "ac_loading",
            minChars: 1,
            delay: 200,
            matchCase: false,
            matchSubset: false,
            matchContains: false,
            cacheLength: 10,
            max: 100,
            mustMatch: false,
            extraParams: {},
            selectFirst: true,
            formatItem: function (row) {
                return row[0];
            },
            formatMatch: null,
            autoFill: false,
            width: 0,
            multiple: false,
            multipleSeparator: ", ",
            highlight: function (value, term) {
                return value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)(" + term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi, "\\$1") + ")(?![^<>]*>)(?![^&;]+;)", "gi"), '<span class="no-strong">$1</span>');
            },
            scroll: true,
            scrollHeight: 180
        };

        $.Autocompleter.Cache = function (options) {

            var data = {};
            var length = 0;

            function matchSubset(s, sub) {
                if (!options.matchCase) s = s.toLowerCase();
                var i = s.indexOf(sub);
                if (options.matchContains == "word") {
                    i = s.toLowerCase().search("\\b" + sub.toLowerCase());
                }
                if (i == -1) return false;
                return i == 0 || options.matchContains;
            };

            function add(q, value) {
                if (length > options.cacheLength) {
                    flush();
                }
                if (!data[q]) {
                    length++;
                }
                data[q] = value;
            }

            function populate() {
                if (!options.data) return false;
                // track the matches
                var stMatchSets = {},
                        nullData = 0;

                // no url was specified, we need to adjust the cache length to make sure it fits the local data store
                if (!options.url) options.cacheLength = 1;

                // track all options for minChars = 0
                stMatchSets[""] = [];

                // loop through the array and create a lookup structure
                for (var i = 0, ol = options.data.length; i < ol; i++) {
                    var rawValue = options.data[i];
                    // if rawValue is a string, make an array otherwise just reference the array
                    rawValue = (typeof rawValue == "string") ? [rawValue] : rawValue;

                    var value = options.formatMatch(rawValue, i + 1, options.data.length);
                    if (value === false) continue;

                    var firstChar = value.charAt(0).toLowerCase();
                    // if no lookup array for this character exists, look it up now
                    if (!stMatchSets[firstChar]) stMatchSets[firstChar] = [];

                    // if the match is a string
                    var row = {
                        value: value,
                        data: rawValue,
                        result: options.formatResult && options.formatResult(rawValue) || value
                    };

                    // push the current match into the set list
                    stMatchSets[firstChar].push(row);

                    // keep track of minChars zero items
                    if (nullData++ < options.max) {
                        stMatchSets[""].push(row);
                    }
                }
                ;

                // add the data items to the cache
                $.each(stMatchSets, function (i, value) {
                    // increase the cache size
                    options.cacheLength++;
                    // add to the cache
                    add(i, value);
                });
            }

            // populate any existing data
            setTimeout(populate, 25);

            function flush() {
                data = {};
                length = 0;
            }

            return {
                flush: flush,
                add: add,
                populate: populate,
                load: function (q) {
                    if (!options.cacheLength || !length) return null;
                    /*
                     * if dealing w/local data and matchContains than we must make sure
                     * to loop through all the data collections looking for matches
                     */
                    if (!options.url && options.matchContains) {
                        // track all matches
                        var csub = [];
                        // loop through all the data grids for matches
                        for (var k in data) {
                            // don't search through the stMatchSets[""] (minChars: 0) cache
                            // this prevents duplicates
                            if (k.length > 0) {
                                var c = data[k];
                                $.each(c, function (i, x) {
                                    // if we've got a match, add it to the array
                                    if (matchSubset(x.value, q)) {
                                        csub.push(x);
                                    }
                                });
                            }
                        }
                        return csub;
                    } else
                    // if the exact item exists, use it
                    if (data[q]) {
                        return data[q];
                    } else if (options.matchSubset) {
                        for (var i = q.length - 1; i >= options.minChars; i--) {
                            var c = data[q.substr(0, i)];
                            if (c) {
                                var csub = [];
                                $.each(c, function (i, x) {
                                    if (matchSubset(x.value, q)) {
                                        csub[csub.length] = x;
                                    }
                                });
                                return csub;
                            }
                        }
                    }
                    return null;
                }
            };
        };

        $.Autocompleter.Select = function (options, input, select, config) {
            var CLASSES = {
                ACTIVE: "ac_over"
            };

            var listItems, active = -1,
                    data, term = "",
                    needsInit = true,
                    element, list;

            // Create results
            function init() {
                if (!needsInit) return;
                element = $("<div/>").hide().addClass(options.resultsClass).css("position", "absolute").appendTo('.ntp-body');

                list = $("<ul/>").appendTo(element).mouseover(function (event) {
                    if (target(event).nodeName && target(event).nodeName.toUpperCase() == 'LI') {
                        active = $("li", list).removeClass(CLASSES.ACTIVE).index(target(event));
                        $(target(event)).addClass(CLASSES.ACTIVE);
                    }
                }).click(function (event) {
                    $(target(event)).addClass(CLASSES.ACTIVE);
                    select();
                    // TODO provide option to avoid setting focus again after selection? useful for cleanup-on-focus
                    input.focus();
                    return false;
                }).mousedown(function (e) {
                    config.mouseDownOnSelect = true;
                    return false;
                }).mouseup(function () {
                    config.mouseDownOnSelect = false;
                });

                element.append('<div class="powered">由3亿人都在使用的<i>360搜索</i>提供</div>');

                if (options.width > 0) element.css("width", options.width);

                needsInit = false;
            }

            function target(event) {
                var element = event.target;
                while (element && element.tagName != "LI")
                    element = element.parentNode;
                // more fun with IE, sometimes event.target is empty, just ignore it then
                if (!element) return [];
                return element;
            }

            function moveSelect(step) {
                listItems = list.find("li");
                listItems.slice(active, active + 1).removeClass(CLASSES.ACTIVE);
                movePosition(step);
                var activeItem = listItems.slice(active, active + 1).addClass(CLASSES.ACTIVE);
                if (activeItem.length > 0) {
                    var data = $.data(activeItem[0], "ac_data");
                    if (data && data.result) {
                        $(input).val(data.result);
                    }
                }
                if (options.scroll) {
                    var offset = 0;
                    listItems.slice(0, active).each(function () {
                        offset += this.offsetHeight;
                    });
                    if ((offset + activeItem[0].offsetHeight - list.scrollTop()) > list[0].clientHeight) {
                        list.scrollTop(offset + activeItem[0].offsetHeight - list.innerHeight());
                    } else if (offset < list.scrollTop()) {
                        list.scrollTop(offset);
                    }
                }
            };

            function movePosition(step) {
                active += step;
                if (active < 0) {
                    active = listItems.size() - 1;
                } else if (active >= listItems.size()) {
                    active = 0;
                }
            }

            function limitNumberOfItems(available) {
                return options.max && options.max < available ? options.max : available;
            }

            function fillList() {
                list.empty();
                var max = limitNumberOfItems(data.length);
                for (var i = 0; i < max; i++) {
                    if (!data[i]) continue;
                    var li;
                    if (data[i].zhida) {
                        var sb = [],
                                icon;
                        if (icon = data[i].data.Favicon) {
                            sb.push('<img src="' + icon + '">');
                        }
                        sb.push('<b>' + data[i].value + '</b>');
                        if (!icon) {
                            sb.push('<span class="tag_site">官网</span>');
                        }
                        sb.push('<span class="site_url">' + data[i].data.Host.replace(/^.*?:\/\/|\/$/g, '') + '</span>');
                        li = $("<li/>").html(sb.join('')).addClass('zhida').appendTo(list)[0];
                    } else {
                        var formatted = options.formatItem(data[i].data, i + 1, max, data[i].value, term);
                        if (formatted === false) continue;
                        li = $("<li/>").html(options.highlight(formatted, term)).addClass(i % 2 == 0 ? "ac_even" : "ac_odd").appendTo(list)[0];
                    }
                    $.data(li, "ac_data", data[i]);
                }
                listItems = list.find("li");
                if (options.selectFirst) {
                    listItems.slice(0, 1).addClass(CLASSES.ACTIVE);
                    active = 0;
                }
                // apply bgiframe if available
                if ($.fn.bgiframe) list.bgiframe();
            }

            return {
                display: function (d, q) {
                    init();
                    data = d;
                    term = q;
                    fillList();
                },
                next: function () {
                    moveSelect(1);
                },
                prev: function () {
                    moveSelect(-1);
                },
                pageUp: function () {
                    if (active != 0 && active - 8 < 0) {
                        moveSelect(-active);
                    } else {
                        moveSelect(-8);
                    }
                },
                pageDown: function () {
                    if (active != listItems.size() - 1 && active + 8 > listItems.size()) {
                        moveSelect(listItems.size() - 1 - active);
                    } else {
                        moveSelect(8);
                    }
                },
                hide: function () {
                    element && element.hide(); //slideUp({duration:100});
                    listItems && listItems.removeClass(CLASSES.ACTIVE);
                    active = -1;
                },
                visible: function () {
                    return element && element.is(":visible");
                },
                current: function () {
                    return this.visible() && (listItems.filter("." + CLASSES.ACTIVE)[0] || options.selectFirst && listItems[0]);
                },
                show: function (hotkeyword) {
                    var $this = this;

                    function showSuggest() {
                        active = -1;
                        if (hotkeyword) {
                            element.addClass('hot-keyword');
                        } else {
                            element.removeClass('hot-keyword');
                        }
                        $this.repos();
                        element.show(); //slideDown({duration:300});
                        if (options.scroll) {
                            list.scrollTop(0);
                            list.css({
                                maxHeight: options.scrollHeight,
                                overflow: 'auto'
                            });
                        }
                    }

                    if (options.onbeforeshow) {
                        options.onbeforeshow(showSuggest)
                    } else {
                        showSuggest();
                    }

                },
                repos: function () {
                    var offset = $(input).offset();
                    element.css({
                        width: typeof options.width == "string" || options.width > 0 ? options.width : $('.ipt').width(),
                        top: offset.top + $('.ntp-body').scrollTop() + input.offsetHeight + 3,
                        left: offset.left + options.offset.left || 0
                    });
                },
                selected: function () {
                    listItems = list.find("li");
                    var selected = listItems && listItems.filter("." + CLASSES.ACTIVE).removeClass(CLASSES.ACTIVE);
                    return selected && selected.length && $.data(selected[0], "ac_data");
                },
                emptyList: function () {
                    list && list.empty();
                },
                unbind: function () {
                    element && element.remove();
                }
            };
        };

        $.fn.selection = function (start, end) {
            if (start !== undefined) {
                return this.each(function () {
                    if (this.createTextRange) {
                        var selRange = this.createTextRange();
                        if (end === undefined || start == end) {
                            selRange.move("character", start);
                            selRange.select();
                        } else {
                            selRange.collapse(true);
                            selRange.moveStart("character", start);
                            selRange.moveEnd("character", end);
                            selRange.select();
                        }
                    } else if (this.setSelectionRange) {
                        this.setSelectionRange(start, end);
                    } else if (this.selectionStart) {
                        this.selectionStart = start;
                        this.selectionEnd = end;
                    }
                });
            }
            var field = this[0];
            if (field.createTextRange) {
                var range = document.selection.createRange(),
                        orig = field.value,
                        teststring = "<->",
                        textLength = range.text.length;
                range.text = teststring;
                var caretAt = field.value.indexOf(teststring);
                field.value = orig;
                this.selection(caretAt, caretAt + textLength);
                return {
                    start: caretAt,
                    end: caretAt + textLength
                }
            } else if (field.selectionStart !== undefined) {
                return {
                    start: field.selectionStart,
                    end: field.selectionEnd
                }
            }
        };

    })($);

    /**
     * CETH CustomEventTargetHelper - component event fx
     *
     * @version: 1.0
     * @mail: lichao3@360.cn
     */
    (function (host, undef) {

        /**
         * @class CustomEvent event object class
         * @param {object} target
         * @param {string} type
         * @param {json} eventArgs
         */
        function CustomEvent(target, type, eventArgs) {
            this.target = target;
            this.type = type;
            $.extend(this, eventArgs || {});
        }

        $.extend(CustomEvent.prototype, {
            target: null,
            currentTarget: null,
            type: null,
            returnValue: undef,
            preventDefault: function () {
                this.returnValue = false;
            }
        });

        /**
         * @class CustomEventTargetH  componet event fx
         * @singleton
         */
        var CustomEventTargetH = {
            /**
             * @method on
             * @param {object} target
             * @param {string} sEvent
             * @param {Functor} fn
             * @return {boolean}
             */
            on: function (target, sEvent, fn) {
                var cbs = target.__customListeners && target.__customListeners[sEvent];
                if (!cbs) {
                    CustomEventTargetH.createEvents(target, sEvent);
                    cbs = target.__customListeners && target.__customListeners[sEvent];
                }
                cbs.push(fn);
                return true;
            },
            /**
             * @method un
             * @param {object} target
             * @param {string} sEvent
             * @param {Functor} fn
             * @return {boolean}
             */
            un: function (target, sEvent, fn) {
                var cbs = target.__customListeners && target.__customListeners[sEvent];
                if (!cbs) {
                    return false;
                }
                if (fn) {
                    var idx = [].indexOf.call(cbs, fn);
                    if (idx < 0) {
                        return false;
                    }
                    cbs.splice(idx, 1);
                } else {
                    cbs.length = 0;
                }
                return true;
            },
            fire: function (target, sEvent, eventArgs) {
                if (sEvent instanceof CustomEvent) {
                    var customEvent = $.extend(sEvent, eventArgs);
                    sEvent = sEvent.type;
                } else {
                    customEvent = new CustomEvent(target, sEvent, eventArgs);
                }
                var cbs = target.__customListeners && target.__customListeners[sEvent];
                if (!cbs) {
                    CustomEventTargetH.createEvents(target, sEvent);
                    cbs = target.__customListeners && target.__customListeners[sEvent];
                }
                if (sEvent != '*') {
                    cbs = cbs.concat(target.__customListeners['*'] || []);
                }
                customEvent.returnValue = undef;
                var obj = customEvent.currentTarget = target;

                if (obj && obj['on' + customEvent.type]) {
                    var retDef = obj['on' + customEvent.type].call(obj, customEvent); //先调用默认的onxxx
                }
                for (var i = 0; i < cbs.length; i++) {
                    cbs[i].call(obj, customEvent);
                }

                return customEvent.returnValue !== false && (retDef !== false || customEvent.returnValue !== undef);
            },
            createEvents: function (target, types) {
                types = types || [];
                if (typeof types == 'string') {
                    types = types.split(',');
                }
                var listeners = target.__customListeners = target.__customListeners || {};
                for (var i = 0; i < types.length; i++) {
                    listeners[types[i]] = listeners[types[i]] || [];
                }
                listeners['*'] = listeners['*'] || [];
                return target;
            }
        };

        $.extend(host, { //写入宿主
            CETH: CustomEventTargetH
        });
    })(window);


    /**
     * ChromeWebUIApis
     *
     * @version: 1.0
     * @mail: lichao3@360.cn
     */
    (function (host, chrome, undef) {

        var slice = Array.prototype.slice,
                noop = $.noop;

        /**
         * @function exportPath
         * @param1 name
         * @param2 opt_object
         * @param3 opt_objectToExportTo
         */
        function exportPath(name, opt_object, opt_objectToExportTo) {
            var parts = name.split('.');
            var cur = opt_objectToExportTo || host;

            for (var part; parts.length && (part = parts.shift());) {
                if (!parts.length && opt_object !== undefined) {
                    // last part and we have an object; use it
                    cur[part] = opt_object;
                } else if (part in cur) {
                    cur = cur[part];
                } else {
                    cur = cur[part] = {};
                }
            }
            return cur;
        };

        /**
         * @function unname
         * @param1 path
         * @param2 obj
         */
        function unname(path, obj) {
            var parts = path.split('.');
            var cur = obj || host;
            var previous = cur;
            for (var part; parts.length && (part = parts.shift());) {
                if (cur[part]) {
                    previous = cur;
                    cur = cur[part];
                }
            }
            delete previous[part];
        }

        var ChromeWebUIApis = function (opts) {

            var self = this,
                    opts = opts || {},
                    methods = opts.methods || [];

            $.extend(self, opts);

            if (typeof methods == 'string') {
                methods = methods.split(',');
            }

            methods.forEach(function (methodName) {

                /**
                 * reg functor as runtime
                 */
                self[methodName] = function () { //注册每个chrome接口函数
                    var args = slice.call(arguments, 0),
                            isUnname = args.length && typeof args[args.length - 1] == 'boolean' && args.pop() || false,
                            callToken = args.length && typeof args[args.length - 1] == 'string' && args.pop() || '__' + ( +new Date) + '_' + Math.floor(Math.random() * 1e5),
                            callback = args.length && typeof args[args.length - 1] == 'function' && args.pop() || noop;

                    exportPath(callToken, function (ret) {
                                callback.apply(self, slice.call(arguments, 0));
                                isUnname && unname(callToken, host);
                            },
                            host);

                    try {
                        CETH.fire(self, 'before', {
                            methodName: methodName,
                            args: [callToken].concat(args)
                        });
                        self.post(methodName, [callToken].concat(args));
                    } catch (ex) {
                        CETH.fire(self, 'error', {
                            methodName: methodName,
                            callback: host[callToken]
                        });
                    }

                };

            });

            CETH.createEvents(this, ChromeWebUIApis.EVENTS);
        };

        ChromeWebUIApis.EVENTS = 'before,after,error';
        ChromeWebUIApis.prototype = {
            post: function (methodName, args) {
                try {
                    var cancel = false;
                    if (methodName == 'screenShot') {
                        if ($(document.body).css('opacity') == '0') {
                            cancel = true;
                        }
                    }
                    if (!cancel) {
                        chrome.send(methodName, args);
                    }
                } catch (e) {
                }
            }
        };

        $.extend(host, {
            ChromeWebUIApis: ChromeWebUIApis
        });

    })(window, window.chrome);


    var RENDER_DELAY = 250;

    var ntpApis = new ChromeWebUIApis({
        methods: 'screenShot,hideScreenShot,getCurrentURLS,getCustomData,setCustomData,getMostVisitedData,saveMostVisitedURLs,' +
        'captureWebpage,blacklistURLFromMostVisited,onClickThumbnail,openUrl,sendRset',
        onerror: function (ev) {
            //console.log('error:', arguments);
        },
        onbefore: function (ev) {
            console.log('before call:' + ev.methodName, ev.args, +new Date - st + 'ms(距页面打开)');
        }
    });

    var ScreenShot = {
        capture: function (action) {
            if ($(document.body).css('opacity') == '0') {
                return;
            }
            if ($('.search-menu').is(':visible') ||
                    $('.ac_results').is(':visible') ||
                    $('#page-manager').is(':visible') ||
                    $('.customs-startup-mask').is(':visible') ||
                    $('.screen-mask-guide').is(':visible') ||
                    $('.add-url').is(':visible') ||
                    $('.setup-pop').hasClass('setup-pop-end')
            ) {
                action = 'delete';
            }
            ntpApis.screenShot(action);
        },
        safeHide: function () {
            var self = this;
            setTimeout(function () {
                self._hideAndCapture();
            }, 1000);
        },
        hideAndCapture: function (arg, firstPageRenered, setWallpapered) {
            var self = this;
            if (firstPageRenered) this.firstPageRenered = true;
            if (setWallpapered) this.setWallpapered = true;
            if (!this.hideScreenShoted && this.firstPageRenered && this.setWallpapered) {
                this.hideScreenShoted = true
                console.log('ScreenShot.hideAndCapture:', arg, +new Date - st + 'ms(距页面打开)');

                var pageId;
                try {
                    pageId = ($('.sliders>a.selected').attr('class').replace('selected', '').replace(/\s+/g, ''));
                } catch (e) {
                }

                var imgs;

                // 对mosts customs 等待图片加载
                if (pageId == 'mosts' || pageId == 'customs') {
                    imgs = $('.page-list .current img');
                } else {
                    imgs = $();
                }

                var count = imgs.length;
                imgs.each(function () {
                    if (this.complete) {
                        count--;
                    }
                });
                if (count <= 0) {
                    console.log('imgs onload:', +new Date - st + 'ms(距页面打开)');
                    self._hideAndCapture(arg);
                } else {
                    function complete() {
                        if (--count <= 0) {
                            console.log('imgs onload:', +new Date - st + 'ms(距页面打开)');
                            self._hideAndCapture(arg);
                        }
                        ;
                    }

                    imgs.on('load error', complete);
                }
            } else {
                self.capture(arg);
            }
        },
        _hideAndCapture: function (arg) {
            if (!this.triggerHideScreenShot) {
                this.triggerHideScreenShot = true;
                document.body.style.opacity = 1;
                // 延迟200ms隐藏贴图，防止闪烁
                setTimeout(function () {
                    ntpApis.hideScreenShot(0, arg);
                    ScreenShot.capture(arg);
                }, 200);
                console.log('### newpages onload timer: ' + Date.now());
                setTimeout(function () {
                    $(window).trigger('newpages:firstPageOnLoad');
                    window.newpagesFirstPageOnLoad = true;
                });
            }
        }
    };

    ScreenShot.safeHide();


    var api = {
        GetSID: function () {
            if (api.sid) {
                return api.sid;
            }
            try {
                api.sid = external.GetSID(window);
                return api.sid;
            } catch (e) {
                return '';
            }
        },
        GetMID: function () {
            if (api.mid) {
                return api.mid;
            }
            api.mid = api.GetSID() && external.GetMID(api.sid);
            return api.mid
        },
        GetVersion: function () {
            if (api.ver) {
                return api.ver;
            }
            api.ver = api.GetSID() && external.GetVersion(api.sid);
            return api.ver
        }
    };
    var storage = {
        get: function (key) {
            try {
                return JSON.parse(localStorage[key] || '{}');
            } catch (e) {
                return {};
            }
        },
        set: function (key, subkey, val) {
            var data = this.get(key);
            data[subkey] = val;
            this.setData(key, data);
        },
        setData: function (key, data) {
            localStorage[key] = JSON.stringify(data);
        }
    };

    var version;
    if (external.GetSID) {
        version = external.GetVersion(external.GetSID(window));
    }
    var __storage_version = storage.get('__import_data')['version'];
    if (__storage_version != version) {
        var __old_version = '';
        if (__storage_version != undefined) {
            __old_version = __storage_version;
        } else {
            if (!isNaN(parseInt(storage.get('sliders')['default']))) {
                __old_version = '6.2';
            } else if (localStorage['settings'] != undefined) {
                __old_version = '6.1';
            }
        }
        storage.set('__import_data', 'old_version', __old_version);
        storage.set('__import_data', 'version', version);
    }
    window.existVersion61 = storage.get('__import_data')['old_version'] == '6.1'; //localStorage['exist_oldversion'] == 'true';

    var AddUrlDlg = function () {
        var inited = false;
        var sitesData;

        function init() {
            if (inited) {
                return;
            }
            inited = true;
            $('.add-url .url-cats li').on('click', function () {
                showTab($(this).attr('cat-name'));
            });
            $('input[name=add-url-q]').on('search', function (e) {
                var q = $(this).val();
                if (q) {
                    search(q);
                } else {
                    buildTab();
                }
            });
            $('.add-url .recommend .loaderror .reload').on('click', loadData);
            loadData();
        }

        function loadData() {
            DC.get('http://site.browser.360.cn/csite.php?callback=?', {
                        version: 'se62',
                        rn: Date.now(),
                        v: api.GetVersion()
                    },
                    function (ret) {
                        sitesData = ret && ret.data;
                        $(document).trigger('AddUrlDlg:showtab');
                    },
                    1000 * 60 * 60,
                    function () {
                        $('.add-url .recommend .loaderror .reload').show();
                    });
            return false;
        }

        function showTab(name) {
            $('.add-url .url-cats li').removeClass('on').filter('[cat-name=' + name + ']').addClass('on');
            if (name == 'custom') {
                $('.add-url .recommend').hide();
                $('.add-url .custom').show();
                localStorage['__addurl_default_tab'] = 'custom';
                return;
            }
            $('.add-url .recommend').show();
            $('.add-url .custom').hide();
            localStorage['__addurl_default_tab'] = 'hot';
            if (sitesData) {
                buildTab();
            } else {
                $(document).on('AddUrlDlg:showtab', buildTab);
            }
        }

        function buildTab() {
            var name = $('.add-url .url-cats li.on').attr('cat-name');
            render(sitesData[name]);
        }

        function render(list) {
            list = list || [];
            var sb = [];
            $.each(list, function (i, item) {
                var added = mostsUrlMap[item.url] || mostsUrlMap[item.url + '/'] || customsUrlMap[item.url] || customsUrlMap[item.url + '/'];
                sb.push('<li class="' + ' ' + (added ? 'added' : '') + '" url="' + htmlEncode(checkUrlProtocol(item.url)) + '"> <i class=""></i><img src="' + htmlEncode(item.logo) + '" onerror="src=\'images/default_logo.png\'"><h4 title="' + htmlEncode(item.title) + '">' + htmlEncode(item.title) + '</h4></li>');
            });
            if (list.length > 0) {
                $('.add-url .recommend .nodata').hide();
            }
            $('.add-url .recommend .logo-list').html(sb.join(''));
            $('.add-url .recommend .logo-list li').click(function () {
                window.isOftenUrl = true;
                $('#js-addurl-title').val($(this).find('h4').attr('title'));
                $('#js-addurl-url').val($(this).attr('url'));
                $('#add-url-form').submit();
            });
            $('.add-url .recommend .logo-list li img').on('mousedown', function () {
                return false;
            });
            getStatus();
        }

        function search(q) {
            var ret = [];
            var urlTable = {};
            $.each(sitesData, function (name, list) {
                $.each(list, function (i, item) {
                    if (item.title.indexOf(q) > -1 || item.url.indexOf(q) > -1) {
                        if (!urlTable[item.url]) {
                            urlTable[item.url] = true;
                            ret.push(item);
                        }
                    }
                })
            });
            if (ret.length <= 0) {
                $('.add-url .recommend .nodata').show();
            }
            render(ret);
        }

        function getStatus() {

        }

        return {
            show: function () {
                init();
                this.onshow();
            },
            onshow: function () {
                sugSelect.hide();
                //PlaceHolder._setValue($('input[name=add-url-q]')[0]);
                $('input[name=add-url-q]').val('');
                $('.ipt-2+label.error').hide();
                showTab(localStorage['__addurl_default_tab'] || 'hot');
            }
        };
    }();

    var HotKeyword = function () {
        var keywordData, mvData = [];
        var input, container, toggle;

        function toggleSug(e) {
            if (e && e.button != 0) {
                return;
            }
            hideUpdateNum();
            clearTimeout(window.sug_hide_timeout);
            if (!toggle.hasClass('open')) {
                input.focus();
                if (render()) {
                    sugSelect.show('hot-keyword');
                    Stat.send('336.5186.gif');
                    sendMvStat();
                }
            } else {
                toggle.removeClass('open');
                sugSelect.hide();
            }
            return false;
        }

        function showUpdateNum() {
            if (storage.get('settings')['hide-update-num'] == new Date().Format('yyyy-MM-dd')) {
                return;
            }
            var cat = $('.search-cat .on').attr('cat-name');
            var list = keywordData; // && keywordData[cat];
            var newcount = 0;
            list.forEach(function (item) {
                if (item.new == '1') {
                    newcount++;
                }
            });
            if (newcount > 0) {
                $('#search-hotword-update').text(newcount).show();
            }
        }

        function hideUpdateNum() {
            $('#search-hotword-update').hide();
            ScreenShot.capture('delete');
            storage.set('settings', 'hide-update-num', new Date().Format('yyyy-MM-dd'));
        }

        function render() {
            var cat = $('.search-cat .on').attr('cat-name');
            var list = keywordData; // && keywordData[cat];
            if (!list) {
                return false;
            }
            var ul = container.find('ul');
            ul.empty();
            list.forEach(function (item, i) {
                var li = $('<li asin="' + (item.asin || '') + '"><a' + (item.link ? ' href="' + htmlEncode(checkUrlProtocol(item.link)) + '"' : '') + '><em class="hot">' + (i + 1) + '</em><span class="' + (item.new == '1' ? 'new' : '') + '">' + htmlEncode(item.text) + '</span></a></li>');
                ul.append(li);
                item.result = item.text;
                li.data('ac_data', item);
            });
            toggle.addClass('open');
            return true;
        }

        var _mvStatSended = false;

        function sendMvStat() {
            if (_mvStatSended) {
                return;
            }
            _mvStatSended = true;

            var group = [];
            $('.hot-keyword li[asin!=""]').each(function (i, item) {
                group.push($(item).attr('asin'));
                if (i % 10 == 9 || i == ($('.hot-keyword li[asin!=""]').length - 1)) {
                    var _stat_name = '_stat_img_' + new Date().getTime();
                    window[_stat_name] = new Image();
                    window[_stat_name].src = 'https://xd-q.mediav.com/s?type=1&r=20&asin=' + group.join(';');
                    group = [];
                }
            });
        }

        return {
            init: function (ele) {
                container = $('.ac_results:first');
                input = ele.on('mousedown', function (e) {
                    if (e.button != 0) {
                        return;
                    }
                    if ($(this).val() == '' || $(this).val() == $(this).attr('_placeholder')) {
                        toggleSug();
                    }
                    e.stopPropagation();
                });
                toggle = $('#search-hotword').on('mousedown', toggleSug);
                $('#search-hotword-update').on('mousedown', toggleSug);

                var _requestCount = 2;
                $.ajax({
                    url: 'https://show-s.mediav.com/s?pubid=117337&type=1&of=4&tags=70_2%2C80_2%2C53_2',
                    data: {},
                    dataType: 'jsonp',
                    jsonp: 'jsonp',
                    success: function (data) {
                        data = data && data[0] && data[0].info;
                        for (var k in data) {
                            mvData = mvData.concat(data[k]);
                        }
                        if (--_requestCount == 0) {
                            HotKeyword.ondata();
                        }
                    },
                    error: function () {
                        if (--_requestCount == 0) {
                            HotKeyword.ondata();
                        }
                    }
                });

                DC.get('http://site.browser.360.cn/msgmodel.php?callback=?&mt=["tabssrc"]', {
                            v: api.GetVersion()
                        },
                        function (ret) {
                            keywordData = ret && ret.data && ret.data.tabssrc && ret.data.tabssrc.data;
                            if (--_requestCount == 0) {
                                HotKeyword.ondata();
                            }
                        });
            },
            ondata: function () {
                var mvDataItem, mvIdx = 0;
                if (keywordData[1] && keywordData[1].locked != true && (mvDataItem = mvData[mvIdx++])) {
                    keywordData[1] = {
                        text: mvDataItem[0],
                        link: mvDataItem[1],
                        asin: mvDataItem[3]
                    };
                }

                if (keywordData[3] && keywordData[3].locked != true && (mvDataItem = mvData[mvIdx++])) {
                    keywordData[3] = {
                        text: mvDataItem[0],
                        link: mvDataItem[1],
                        asin: mvDataItem[3]
                    };
                }

                if (keywordData[5] && keywordData[5].locked != true && (mvDataItem = mvData[mvIdx++])) {
                    keywordData[5] = {
                        text: mvDataItem[0],
                        link: mvDataItem[1],
                        asin: mvDataItem[3]
                    };
                }

                toggle.show();
                showUpdateNum();
            }
        };
    }();

    var DC = function () {
        var _key = '__ajax_cache';
        var expires = 1000 * 60 * 60;
        var storage = {
            get: function (key) {
                try {
                    return JSON.parse(localStorage[key] || '{}');
                } catch (e) {
                    return {};
                }
            },
            set: function (key, data) {
                localStorage[key] = JSON.stringify(data);
            },
            getCache: function (key, expire) {
                var cache = storage.get(_key)[key];
                if (cache) {
                    expire = expire === undefined ? expires : expire;
                    var dist = Date.now() - cache['expires'];
                    var expired = dist < 0 || dist > expire;
                    if (!expired) {
                        return cache['data'];
                    }
                }
                return null;
            },
            setCache: function (key, val) {
                var data = storage.get(_key);
                data[key] = {
                    data: val,
                    expires: Date.now()
                };
                storage.set(_key, data);
            }
        };

        return {
            storage: storage,
            get: function (url, data, success, expire, cacheCallback) {
                var cache;
                if (cache = storage.getCache(url, expire)) {
                    if (cacheCallback !== false) {
                        success(cache);
                    }
                } else {
                    $.getJSON(url, data, function (ret) {
                        storage.setCache(url, ret);
                        success(ret);
                    });
                }
            }
        };
    }();


    var PageDataSource = function () {
        var expires = 5 * 60 * 1000;
        return {
            load: function (pageArr) {
                pageArr = pageArr || [];
                if (pageArr.length == 0) {
                    return;
                }
                pageArr.forEach(function (item) {
                    var datas = storage.get('__ajax_cache')['page_data_' + item];
                    if (datas) {
                        try {
                            datas = JSON.parse(datas);
                        } catch (e) {
                            datas = null;
                        }
                    }
                });
                var dist = Date.now() - (storage.get('__ajax_cache')['page_data_expires'] || 0);
                var expired = dist < 0 || dist > expires;
                if (expired) {
                    $.getJSON('http://site.browser.360.cn/msgmodel.php?callback=?&mt=' + JSON.stringify(pageArr) + '&v=' + api.GetVersion(), function (datas) {
                        if (datas.errno == 0 && datas.data) {
                            try {
                                for (var key in datas.data) {
                                    var data = datas.data[key];
                                    if (key == 'news8') {
                                        data = NewsPage.cutImg(data);
                                    }
                                    storage.set('__ajax_cache', 'page_data_' + key, JSON.stringify(data));
                                    switch (key) {
                                        case '360kan':
                                            VideosPage.render();
                                            break;
                                        case 'news8':
                                            NewsPage.render();
                                            break;
                                        case 'newgame':
                                            GamesPage.render(false);
                                            break;
                                        case 'newmusic':
                                            MusicPage.render(false);
                                            break;
                                        case 'newmall3':
                                            ShoppingPage.render();
                                            break;
                                    }

                                }
                                storage.set('__ajax_cache', 'page_data_expires', Date.now());
                            } catch (e) {
                            }
                        }
                    });
                }
            }
        };
    }();

    var ImportData = function () {
        function isDone() {
            return storage.get('__import_data')['done'];
        }

        return {
            setting: function () {
                if (isDone()) {
                    return;
                }
            },
            done: function () {
                storage.set('__import_data', 'done', true);
            },
            resetSearch: function () {
                if (storage.get('__import_data')['reset-search']) {
                    return;
                }
                storage.set('__import_data', 'reset-search', true);

                localStorage.removeItem('default_engine');
            }
        };
    }();

    var TipsManager = function () {

        return {
            showMostsDragTips: function () {
                $('.mosts-drag-tips').remove();
                var htmls = '<div class="mosts-drag-tips slider-nav-tips">在最常访问里，浏览越多的网站排得越靠前，不支持拖动</div>',
                        tipsLeft,
                        tipsTop;

                var tips = $(htmls).appendTo($('.ntp-body'));

                $(window).on('resize', function () {
                    var mosts = $('.sliders>a.mosts');
                    if (mosts.length == 0) {
                        return;
                    }
                    tips.css({
                        left: tipsLeft = mosts.offset().left + mosts.width() / 2,
                        top: tipsTop = $('.sliders').offset().top + $('.ntp-body').scrollTop() - 2
                    })

                    setTimeout(function () {
                        tips.css({
                            left: tipsLeft - tips.width() / 2 - 10,
                            top: tipsTop - tips.height() - 25
                        })
                    });
                    return arguments.callee;
                }());
                tips.fadeIn(function () {
                    setTimeout(function () {
                        tips.fadeOut(function () {
                            tips.remove();
                        });
                    }, 5000);
                });
            },
            showCustomsStartup: function (showAddUrl, addRecommondTiles) {
                if (storage.get('__tips_manager')['customs-startup']) {
                    return;
                }
                storage.set('__tips_manager', 'customs-startup', true);

                window.customsUrlMap = window.customsUrlMap || {};
                var neCount = 0;
                for (var x in customsUrlMap) {
                    neCount++;
                    ;
                }
                if (neCount > 0) {
                    return;
                }

                $('.customs-startup-mask').show();
                $('.customs-startup').show();
                $('.customs-startup img[data-src]').each(function () {
                    var img = $(this);
                    img.height(this.offsetWidth * 224 / 370);
                    this.src = img.attr('data-src');
                    this.onload = function () {
                        img.height('auto')
                    };
                });
                $('.customs-startup').height($('.customs-startup .content').height() + 50).animate({
                    opacity: 1,
                    top: 0
                }, 400, function () {
                    if ($('.sliders>.customs.selected').length == 0) {
                        TipsManager.hideCustomsStartupNow();
                    }
                });

                $(window).on('resize', function () {
                    $('.customs-startup').height($('.customs-startup .content').height() + 50);
                });

                $('.customs-startup .open-add-url').live('click', function (e) {
                    showAddUrl();
                    TipsManager.hideCustomsStartup();
                    return false;
                });

                $('.customs-startup li:not(.open-add-url)').live('click', function () {
                    var _this = $(this);
                    _this.toggleClass('checked');
                    if (_this.hasClass('checked')) {
                        addRecommondTiles([{
                            url: _this.attr('url'),
                            title: _this.attr('title')
                        }]);
                    } else {
                        removeTileByUrl(_this.attr('url'));
                    }
                });

                $('.customs-startup a.ok').live('click', function () {
                    var data = [];
                    $('.customs-startup li.checked').each(function () {
                        var _this = $(this);
                        data.push({
                            url: _this.attr('url'),
                            title: _this.attr('title')
                        });
                    });
                    TipsManager.hideCustomsStartup(function () {
                        addRecommondTiles(data);
                    });
                });
                $('.customs-startup a.cancel, .customs-startup a.close').live('click', function () {
                    TipsManager.hideCustomsStartup();
                });
            },
            hideCustomsStartup: function (callback) {
                $('.customs-startup-mask').hide();
                $('.customs-startup').animate({
                    opacity: 0,
                    top: -$('.customs-startup').height()
                }, 300, 'linear', function () {
                    $(this).hide();
                    callback && callback();
                });
            },
            hideCustomsStartupNow: function () {
                $('.customs-startup,.customs-startup-mask').hide();
            },
            showNavigateNew: function () {
                if (!storage.get('__tips_manager')['video-new']) {
                    $('.sliders>a.video').addClass('new');
                }
                if (!storage.get('__tips_manager')['news-new']) {
                    $('.sliders>a.news').addClass('new');
                }
                if (!storage.get('__tips_manager')['games-new']) {
                    $('.sliders>a.games').addClass('new');
                }
                if (!storage.get('__tips_manager')['musics-new']) {
                    $('.sliders>a.musics').addClass('new');
                }

                if (!storage.get('__tips_manager')['customs-new']) {
                    $('.sliders>a.customs').addClass('new');
                }
                if (!storage.get('__tips_manager')['shopping-new']) {
                    $('.sliders>a.shopping').addClass('new');
                }
                if (!storage.get('__tips_manager')['huajiao-new']) {
                    $('.sliders>a.huajiao').addClass('new');
                }
            },
            hideNavigateNew: function (el) {
                el.removeClass('new');
                el[0] && storage.set('__tips_manager', el[0].className.replace(/\s.*?$/, '') + '-new', true);
            },
            showPageManagerTips: function () {
                if (!storage.get('__tips_manager')['page-manager-shopping-new']) {
                    $('.sliders-nav .page-manager').addClass('new');
                }
            },
            hidePageManagerTips: function () {
                storage.set('__tips_manager', 'page-manager-shopping-new', true);
                $('.sliders-nav .page-manager').removeClass('new');
            },
            showPageManagerStartupTips: function () {
                if (!storage.get('__tips_manager')['page-manager-toggle-tips']) {
                    $('#page-manager .toggle-tips').show();
                    storage.set('__tips_manager', 'page-manager-toggle-tips', true);
                } else if (!storage.get('__tips_manager')['page-manager-drag-tips']) {
                    $('#page-manager .drag-tips').show();
                    storage.set('__tips_manager', 'page-manager-drag-tips', true);
                }
            },
            showNavPageManagerMask: function () {
                if (storage.get('__tips_manager')['first-page-manager-mask']) {
                    return;
                }
                storage.set('__tips_manager', 'first-page-manager-mask', true);
                $('.screen-mask-guide').remove();
                var htmls = '<div class="screen-mask-guide"><div class="nav-page-manager-guide"><a class="close"></a><a class="npm-manager"></a>点击这里添加<span>“我的网址”</span>，还可以显示/隐藏更多频道。</div></div>',
                        tipsLeft,
                        tipsTop;

                var tips = $(htmls).appendTo($('.ntp-body')).find('.nav-page-manager-guide');
                $('.screen-mask-guide .close').click(TipsManager.hideNavPageManagerMask);
                $('.screen-mask-guide .npm-manager').click(function () {
                    TipsManager.hideNavPageManagerMask();
                    $('.page-manager:first').trigger('click');
                });
                setTimeout(TipsManager.hideNavPageManagerMask, 10000);

                $(window).on('resize', function () {
                    var base, offset;
                    if ($('.ntp-body').hasClass('nopage') || $('.ntp-body').hasClass('nopage-animate')) {
                        tips.addClass('right-top-page-manager-mask');
                        base = $('.setup .setup-tit');
                        offset = {
                            x: 170,
                            y: 4100
                        };
                    } else {
                        base = $('.sliders-nav .page-manager');
                        offset = {
                            x: 125,
                            y: 90
                        };
                    }
                    if (base.length == 0) {
                        return;
                    }
                    tipsLeft = base.offset().left + base.width() / 2;
                    tipsTop = base.offset().top + $('.ntp-body').scrollTop() - 2;

                    tips.css({
                        left: tipsLeft - offset.x,
                        top: tipsTop - offset.y
                    });
                    return arguments.callee;
                }());
            },
            hideNavPageManagerMask: function (now) {
                if ($('.screen-mask-guide').length == 0) {
                    return;
                }
                if (now) {
                    $('.screen-mask-guide').remove();
                } else {
                    $('.screen-mask-guide').fadeOut('fast', function () {
                        $(this).remove();
                    })
                }
                ntpApis.screenShot('screen-mask-remove');
            },
            showRightTopPageManagerGuide: function () {
                if (storage.get('__tips_manager')['right-top-page-manager-guide']) {
                    return;
                }
                storage.set('__tips_manager', 'right-top-page-manager-guide', true);
                if ($('.right-top-page-manager-guide').length > 0) {
                    return;
                }
                var guide = $('<div class="right-top-page-manager-guide"></div>').appendTo($('.ntp-body'));
                setTimeout(function () {
                    guide.remove();
                }, 10000);
            },
            hideRightTopPageManagerGuide: function () {
                $('.right-top-page-manager-guide').remove();
            }
        };
    }();

    Array.prototype.clone = function () {
        return this.concat();
    };

// (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423
    Date.prototype.Format = function (fmt) {
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt))
            fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt))
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };

    String.prototype.shorting = function (len, omiss) {
        omiss = omiss || '...';
        if (this.length > len) {
            return this.substr(0, len / 2) + omiss + this.substr(this.length - len / 2);
        } else {
            return this;
        }
    };

    var StringH = {
        //字符串长度,中文算两个字符
        byteLen: function (s) {
            return (s || '').replace(/[^\x00-\xff]/g, "--").length;
        },
        //截取字符串,超长部分替换为...
        subByte: function (s, len, tail) {
            if (StringH.byteLen(s) <= len) {
                return s;
            }
            tail = tail === undefined ? '...' : tail;
            len -= StringH.byteLen(tail);
            return s.substr(0, len).replace(/([^\x00-\xff])/g, "$1 ") //双字节字符替换成两个
                            .substr(0, len) //截取长度
                            .replace(/[^\x00-\xff]$/, "") //去掉临界双字节字符
                            .replace(/([^\x00-\xff]) /g, "$1") + tail; //还原
        }
    };

    function filterHtml(str) {
        str = (str || '').toString();
        str = str.replace(/"/g, '&quot;');
        return str.replace(/<[^>]*>/g, '');
    }

    function htmlEncode(str) {
        var div = document.createElement("div");
        var text = document.createTextNode(str);
        div.appendChild(text);
        var ret = div.innerHTML;
        ret = ret.replace(/"/g, '&quot;');
        return ret;
    }

    function htmlDecode(str) {
        var div = document.createElement('div');
        div.innerHTML = str.replace(/<[^>]*>/gi, '');
        return div.childNodes[0] ? div.childNodes[0].nodeValue || '' : '';
    }

    function checkUrlProtocol(url) {
        if (url) {
            if (url.substr(0, 7) == 'http://' || url.substr(0, 8) == 'https://' || url.substr(0, 6) == 'ftp://' || url.substr(0, 7) == 'ftps://') {
                return url;
            }
        }
        return '';
    }

    function loadJS(src) {
        var script = document.createElement('script');
        document.getElementsByTagName("head")[0].appendChild(script);
        script.src = src;
    }

    filterUrl.filterRegex = /&?(adsession|key|clientkey|pass|psd|password|usr|user|username|usrname|shoujhao|mima|xingming|userid|usrid|shoujihao|addr|address|dizhi)=[^&]*(&|$)/ig;

    function filterUrl(url) {
        return url.replace(filterUrl.filterRegex, '');
    }

    function filterParam(url) {
        return (url || '').replace(/\?.*$/ig, '');
    }

    function urlAddSrc(url) {
        return url;
        // if (url.indexOf('#') > -1) {
        //   return url;
        // }
        // if (/(\?|&)src=/ig.test(url)) {
        //   return url;
        // }
        // var src = 'src=se6_newtab';
        // src = (url.indexOf('?') > -1 ? '&' : '?') + src;
        // return url + src;
    }

    function openUrl(url) {
        setTimeout(function () {
            ntpApis.openUrl(url, 1, 0, 0);
        });
    }

    function openFormUrl(form) {
        var url = form.action.replace(/\?.*/, '');
        var sb = [];
        $(form).find('input').each(function (i, item) {
            if (item.name) {
                var val = item.value || '';
                try {
                    val = encodeURIComponent(val);
                } catch (e) {
                }
                sb.push(item.name + '=' + val);
            }
        });
        url += '?' + sb.join('&');
        openUrl(url);
    }

    function getHotKeywordUrl(item, src) {
        src = src || 'se7_newtab_new_link';
        return urlAddSrc2(item.link, src) || 'https://www.so.com/s?q=' + (item.keyword || item.text) + '&ie=utf-8&src=' + src;
    }

    function cutImg(url, size) {
        var n = size || "dmsmty/365_227_";
        return url ? url.replace(/(p\d).qhimg.com\/(\w{2,}\/\d*_\d*_\d*\/)*/g, "$1.qhimg.com/" + n + "/") : ""
    }

    function cutImg2(img, size) {
        img = img.replace(/\?.*$/, '');
        var url = /^https?:\/\//.test(img) ? img : ('http://p' + Math.floor(Math.random() * 10) + '.qhimg.com/' + img);
        var cut = 'dmtfd/' + size + '_/';
        return cutImg(url, cut);
    }

    var Stat = {
        init: function () {
            this.bindClickPV();
            this.allPV();
            this.screenPV(this.getScreen());
            this.bindWeatherClickPV();
            this.bindSoHotwordClickPV();
            this.bindShoppingClickPV();
            this.bindWallpaperClickPV();
        },
        allPV: function () {
            this.send('40.7042.gif');
        },
        searchPV: function () {
            this.send('41.1301.gif');
        },
        screenPV: function (pageId) {
            var filename;
            switch (pageId) {
                case 'mosts':
                    filename = '40.9307.gif';
                    break;
                case 'customs':
                    filename = '40.1118.gif';
                    break;
                case 'video':
                    filename = '394.4319.gif';
                    break;
                case 'news':
                    filename = '36.2301.gif';
                    break;
                case 'games':
                    filename = '37.7156.gif';
                    break;
                case 'musics':
                    filename = '38.7429.gif';
                    break;
                case 'shopping':
                    filename = '307.1788.gif';
                    break;
                case 'huajiao':
                    filename = '409.3881.gif';
                    break;
            }
            if (filename) {
                this.send(filename);
            }
        },
        clickPV: function (pageId) {
            var filename;
            switch (pageId) {
                case 'mosts':
                    filename = '40.6111.gif';
                    break;
                case 'customs':
                    filename = '40.209.gif';
                    break;
                case 'video':
                    filename = '394.9232.gif';
                    break;
                case 'news':
                    filename = '36.7357.gif';
                    break;
                case 'games':
                    filename = '37.5070.gif';
                    break;
                case 'musics':
                    filename = '38.6881.gif';
                    break;
                case 'shopping':
                    filename = '307.3974.gif';
                    break;
                case 'huajiao':
                    filename = '409.9847.gif';
                    break;
            }
            if (filename) {
                this.send(filename);
            }
        },
        bindClickPV: function () {
            var self = this;
            $('.page-list > .page a[href]').live('mouseup', function (e) {
                if (e.button == 0 || e.button == 1) {
                    if (!$(e.target).hasClass('pin') && !$(e.target).hasClass('remove')) {
                        self.clickPV(self.getScreen());
                    }
                }
            });
        },
        bindWeatherClickPV: function () {
            var self = this;
            $('#so_weather a[href]').live('click', function () {
                self.send('306.6253.gif');
            });
            $('#so_weather a.change').live('click', function () {
                self.send('306.3673.gif');
            });
        },
        bindSoHotwordClickPV: function () {
            var self = this;
            $('.so-hotword a[href]').live('click', function () {
                var gif;
                if (/^ad_/.test($(this).data('from'))) {
                    gif = '357.7519.gif';
                } else {
                    gif = '357.4373.gif';
                }
                self.send(gif);
            });
        },
        bindShoppingClickPV: function () {
            var self = this;
            $('.np-shopping .category .tab-item a[href]').live('click', function () {
                var $tab = $(this).parents('.tab-item');
                var statUrls = ['307.2197.gif', '307.2075.gif', '307.8388.gif', '307.6457.gif'];
                var url = statUrls[$tab.index()];
                url && self.send(url);
            });
        },
        bindWallpaperClickPV: function () {
            var self = this;
            $('.wallpaper-push-links a.btn[href]').live('click', function () {
                self.send('388.6430.gif');
            });
            $('.angle-right-bottom-ad a.angle-ad-link[href]').live('click', function () {
                self.send('388.1224.gif');
            });
        },
        getScreen: function () {
            var pageId;
            try {
                pageId = ($('.sliders>a.selected').attr('class').replace('selected', '').replace(/\s+/g, ''));
            } catch (e) {
            }
            return pageId;
        },
        send: function (filename) {
            window._stat_request = new Image();
            _stat_request.src = 'http://dd.browser.360.cn/static/a/' + filename + (filename.indexOf('?') > -1 ? '&' : '?') + Date.now() + Math.random().toString().replace('0.', '').substr(0, 10);
        }
    };

    var _nativeLog = console.log;
    console.log = localStorage['__debug'] ? _nativeLog : function () {
    };

    $(window).on('newpages:firstPageOnLoad', function () {
        Stat.init();
        setTimeout(function () {
            monitor.setProject('se_newtab').getTrack().getClickAndKeydown();
        });
    });

﻿/**
     * page manager
     *
     * @version: 1.0
     * @mail: lichao3@360.cn
     */
    (function () {

        var pageManager = {
            $el: $('#page-manager'),
            DRAG_OFFSET: 4,
            tmplFn: doT.template($('#page-manager-tmpl').html()),
            events: {
                'click .tab-list>li>div': 'toggle',
                'mousedown .pm-div': 'markupDown',
                'mousemove .pm-div': 'readyDrag',
                'mousemove global': 'drag',
                'mouseup global': 'dragEnd',
                'click .close': 'shutdown'
            },
            shutdown: function () {
                this.living = false;
                $(this._proxyDiv).remove();
                this.$el.remove();
                $('#page-manager-mask').remove();

                if ($('.ntp-body').hasClass('nopage') || $('.ntp-body').hasClass('nopage-animate')) {
                    //  TipsManager.showRightTopPageManagerGuide();
                }
            },
            init: function () {
                TipsManager.hideNavPageManagerMask();
                TipsManager.hideRightTopPageManagerGuide();

                this.living = true;
                var self = this;
                self.render();

                self.$el = $(self.$el.selector);
                Object.keys(self.events).forEach(function (evt) {
                    var events = /(\S+)\s(.+)/.exec(evt);
                    if (events) {
                        var eventName = events[1],
                                eventSelector = events[2];
                    } else {
                        eventName = evt;
                    }
                    if (eventSelector == 'global') {
                        $(document).delegate('', eventName, function (e) {
                            self[self.events[evt]].call(self, e);
                        });
                    } else {
                        if (eventSelector) {
                            self.$el.on(eventName, eventSelector, function (e) {
                                self[self.events[evt]].call(self, e);
                            });
                        } else {
                            self.$el.on(eventName, function (e) {
                                self[self.events[evt]].call(self, e);
                            });
                        }
                    }
                });

                //TipsManager.showPageManagerStartupTips();
            },
            find: function (selector) {
                return (this.$el || $(document)).find(selector);
            },
            markupDown: function (e) {
                this._downDiv = e.currentTarget;
                this._downPos = {
                    x: e.clientX,
                    y: e.clientY,
                    boxX: e.clientX - $(e.currentTarget).offset().left,
                    boxY: e.clientY - $(e.currentTarget).offset().top
                };
            },
            getPrevDiv: function (title) {
                var prevLi = this.find('.pm-div:contains(' + title + ')').parent().prev();
                while (!prevLi.find('.pm-div.selected').length && prevLi.length) {
                    prevLi = prevLi.prev();
                }
                return prevLi.children();
            },
            dragEnd: function () {
                var self = this;

                if (!this.living) {
                    self._downDiv = null;
                    self._proxyDiv = null;
                    return;
                }

                this.find('.drag-ghost').hide();

                var __downDiv = self._downDiv,
                        __proxyDiv = self._proxyDiv;

                if (self._proxyDiv) {
                    if (self._passDiv) {
                        var cur = $(__proxyDiv).hasClass('selected') ? self._passDiv : __proxyDiv;
                        var prev = self.getPrevDiv(JSON.parse($(cur).attr('datas')).title);
                        var prevData = null;
                        if (prev.length) {
                            prevData = JSON.parse(prev.attr('datas'));
                        }

                        var eventData = {
                            from: JSON.parse($(__proxyDiv).attr('datas')),
                            to: JSON.parse($(self._passDiv).attr('datas')),
                            prev: prevData
                        };
                        var tasks = 0;
                        self.justMoveTo($(self._proxyDiv), $(self._passDiv), true, function () {
                            $(self._passDiv).parent().html($(__downDiv.outerHTML).css('opacity', 1)[0].outerHTML);
                            $(__proxyDiv).remove();
                            tasks++;
                            if (tasks == 2) {
                                CETH.fire(self, 'swapPage', eventData);
                            }
                        });

                        $(self._passDiv)
                                .removeClass('pass-drag')
                                .removeClass('pass-drag-left')
                                .removeClass('pass-drag-top')
                                .removeClass('pass-drag-right')
                                .removeClass('pass-drag-bottom');
                        self.moveTo($(self._passDiv), $(self._downDiv), function () {
                            tasks++;
                            if (tasks == 2) {
                                CETH.fire(self, 'swapPage', eventData);
                            }
                        });
                    } else {
                        self.justMoveTo($(self._proxyDiv), $(self._downDiv), true, function () {
                            $(__downDiv).css('opacity', 1);
                            $(__proxyDiv).remove();
                        });
                    }
                }

                self._downDiv = null;
                self._proxyDiv = null;
            },
            createProxy: function ($div) {
                var $proxy = $div.clone();
                $div.css('opacity', 0);
                $proxy
                        .addClass('drag-proxy')
                        .removeClass('pm-div')
                        .appendTo(document.body);

                this._proxyDiv = $proxy[0];

                this.find('.drag-ghost').css($div.position()).show();
            },
            createGrid: function () {
                var self = this,
                        dragRects = [];

                self.find('.pm-div').each(function (index, item) {
                    var jItem = $(item).parent(),
                            offset = jItem.offset();
                    dragRects.push(item.rect = {
                        index: index,
                        drag: item,
                        left: offset.left,
                        top: offset.top,
                        right: offset.left + jItem.width(),
                        bottom: offset.top + jItem.height()
                    });
                });
                self._downGrid = dragRects;
            },
            readyDrag: function (e) {
                var self = this;
                if (self._downDiv && !self._proxyDiv) {
                    if (Math.max(Math.abs(e.clientX - self._downPos.x), Math.abs(e.clientY - self._downPos.y)) > self.DRAG_OFFSET) {
                        self.createProxy($(self._downDiv));
                        self.createGrid();
                    }
                }
            },
            drag: function (e) {
                var self = this;
                if (self._proxyDiv) {
                    var $proxy = $(self._proxyDiv);
                    $proxy.css({
                        left: e.clientX - self._downPos.boxX,
                        top: e.clientY - self._downPos.boxY
                    });


                    var hitDiv;
                    self._downGrid.every(function (rect) {
                        if (e.pageX > rect.left && e.pageX < rect.right) {
                            if (e.pageY > rect.top && e.pageY < rect.bottom) {
                                if (rect.drag !== self._downDiv) {
                                    hitDiv = rect.drag;
                                }
                                return false;
                            }
                        }
                        return true;
                    });

                    if (hitDiv !== self._passDiv) {
                        if (self._passDiv) {
                            $(self._passDiv).removeClass('pass-drag').removeClass('pass-drag-left').removeClass('pass-drag-top').removeClass('pass-drag-right').removeClass('pass-drag-bottom');
                        }

                        self._passDiv = hitDiv;

                        if (!self._passDiv) {
                            return;
                        }

                        var $downDiv = $(self._downDiv),
                                $passDiv = $(self._passDiv);

                        var dragRect = {
                                    left: $downDiv.offset().left,
                                    top: $downDiv.offset().top,
                                    right: $downDiv.offset().left + $downDiv.width(),
                                    bottom: $downDiv.offset().top + $downDiv.height()
                                },
                                passRect = {
                                    left: $passDiv.offset().left,
                                    top: $passDiv.offset().top,
                                    right: $passDiv.offset().left + $passDiv.width(),
                                    bottom: $passDiv.offset().top + $passDiv.height()
                                };

                        $passDiv.addClass('pass-drag');

                        if (passRect.left > dragRect.left) {
                            $passDiv.addClass('pass-drag-left');
                        } else if (passRect.left < dragRect.left) {
                            $passDiv.addClass('pass-drag-right');
                        }

                        if (passRect.top > dragRect.top) {
                            $passDiv.addClass('pass-drag-top');
                        } else if (passRect.top < dragRect.top) {
                            $passDiv.addClass('pass-drag-bottom');
                        }

                    }

                }
            },
            moveTo: function ($from, $to, high, callback) {
                var proxy = $from.clone(),

                        fromOffset = $from.offset(),
                        toOffset = $to.offset();

                if (typeof high == 'function') {
                    callback = high;
                    high = null;
                }

                var fhtmls = $from.parent().html(),
                        thtmls = $to.parent().html();

                $from.css('opacity', 0);
                proxy
                        .addClass(high ? 'high-switch-proxy' : 'switch-proxy')
                        .css({
                            left: fromOffset.left,
                            top: fromOffset.top
                        })
                        .appendTo(document.body)
                        .animate({
                            left: toOffset.left,
                            top: toOffset.top
                        }, 300, 'linear', function () {
                            //$to.parent().html($(fhtmls).css('opacity', 1)[0].outerHTML);
                            $to.parent().html(fhtmls);
                            proxy.remove();
                            callback && callback();
                        });
            },
            justMoveTo: function ($from, $to, high, callback) {
                var fromOffset = $from.offset();
                var toOffset = $to.offset();
                var fixStyle = window.getComputedStyle($to[0]);
                toOffset.left -= parseInt(fixStyle.left) || 0;
                toOffset.top -= parseInt(fixStyle.top) || 0;


                if (typeof high == 'function') {
                    callback = high;
                    high = null;
                }
                $from.addClass(high ? 'high-switch-proxy' : '');

                $from.animate({
                    left: toOffset.left,
                    top: toOffset.top
                }, 300, 'linear', function () {
                    callback && callback();
                });
            },
            toggle: function (e) {
                var $div = $(e.currentTarget),
                        self = this;

                $div.toggleClass('selected');

                if ($div.hasClass('selected')) {
                    var cur = JSON.parse($div.attr('datas')),
                            prevLi = self.find('.pm-div:contains(' + cur.title + ')').parent().prev();

                    while (!prevLi.find('.pm-div.selected').length && prevLi.length) {
                        prevLi = prevLi.prev();
                    }

                    CETH.fire(self, 'addPage', {
                        cur: cur,
                        prev: prevLi.length ? JSON.parse($(prevLi.children()[0]).attr('datas')) : null
                    });
                } else {
                    CETH.fire(self, 'removePage', JSON.parse($div.attr('datas')));
                }
            },
            render: function () {
                $('.ntp-body').append(this.tmplFn(this.getPageList()));
            },
            getPageList: function () {
                if (storage.get('__import_data')['old_version'] == '6.2') {
                    storage.set('__tips_manager', 'customs-new', true);
                }

                var list = storage.get('sliders')['page-list'];

                if (!list || list.length == 0) {
                    if (storage.get('__import_data')['old_version'] == '6.2') {
                        list = [{
                            pageId: 'mosts',
                            title: '最常访问',
                            img: 'images/page_manager/icon_most.png',
                            selected: 'selected',
                            'new': ''
                        }, {
                            pageId: 'customs',
                            title: '我的网址',
                            img: 'images/page_manager/icon_custom.png',
                            selected: 'selected',
                            'new': ''
                        }, {
                            pageId: 'video',
                            title: '热播影视',
                            img: 'images/page_manager/icon_video.png',
                            selected: 'selected',
                            'new': ''
                        }, {
                            pageId: 'news',
                            title: '今日头条',
                            img: 'images/page_manager/icon_news.png',
                            selected: 'selected',
                            'new': ''
                        }];
                    } else {
                        list = [{
                            pageId: 'mosts',
                            title: '最常访问',
                            img: 'images/page_manager/icon_most.png',
                            selected: 'selected',
                            'new': ''
                        }, {
                            pageId: 'huajiao',
                            title: '花椒直播',
                            img: 'images/page_manager/icon_huajiao.png',
                            selected: 'selected',
                            'new': ''
                        }, {
                            pageId: 'video',
                            title: '热播影视',
                            img: 'images/page_manager/icon_video.png',
                            selected: 'selected',
                            'new': ''
                        }, {
                            pageId: 'news',
                            title: '今日头条',
                            img: 'images/page_manager/icon_news.png',
                            selected: 'selected',
                            'new': ''
                        }, {
                            pageId: 'games',
                            title: '游戏中心',
                            img: 'images/page_manager/icon_games.png',
                            selected: 'selected',
                            'new': ''
                        }, {
                            pageId: 'musics',
                            title: '音乐精选',
                            img: 'images/page_manager/icon_music.png',
                            selected: 'selected',
                            'new': ''
                        }, {
                            pageId: 'shopping',
                            title: '精品购物',
                            img: 'images/page_manager/icon_shopping.png',
                            selected: 'selected',
                            'new': ''
                        }];
                    }
                }

                var map = {};
                list.forEach(function (item) {
                    map[item.pageId] = item;
                });
                if (!map['customs']) list.push({
                    pageId: 'customs',
                    title: '我的网址',
                    img: 'images/page_manager/icon_custom.png',
                    selected: '',
                    'new': 'new'
                });
                else map['customs'].title = '我的网址';
                if (!map['games']) list.push({
                    pageId: 'games',
                    title: '游戏中心',
                    img: 'images/page_manager/icon_games.png',
                    selected: '',
                    'new': 'new'
                });
                if (!map['musics']) list.push({
                    pageId: 'musics',
                    title: '音乐精选',
                    img: 'images/page_manager/icon_music.png',
                    selected: '',
                    'new': 'new'
                });
                if (!map['shopping']) list.push({
                    pageId: 'shopping',
                    title: '精品购物',
                    img: 'images/page_manager/icon_shopping.png',
                    selected: '',
                    'new': 'new'
                });
                if (!map['huajiao']) {
                    list.splice(1, 0, {
                        pageId: 'huajiao',
                        title: '花椒直播',
                        img: 'images/page_manager/icon_huajiao.png',
                        selected: 'selected',
                        'new': ''
                    });
                    var index = PageSlider.getSlideIndex();
                    if (index > 0) {
                        storage.set('sliders', 'default', index + 1);
                    }
                }

                list.forEach(function (item, i) {
                    if (!PageSlider.configs.PAGES_TITLE[item.pageId]) {
                        list.splice(i, 1);
                    }
                });

                if (!storage.get('__import_data')['sliders-done']) {
                    if (window.existVersion61) {
                        storage.set('__import_data', 'sliders-done', true);
                        if (storage.get('settings')['js-grid-count'] == '$("#js-grid-count").val("0")') {
                            list.forEach(function (item) {
                                item.selected = '';
                            });
                        }
                    } else {
                        if (loadTimeData.data.SE5ShowGrid !== undefined) {
                            storage.set('__import_data', 'sliders-done', true);
                            if (loadTimeData.data.SE5ShowGrid === false) {
                                list.forEach(function (item) {
                                    item.selected = '';
                                });
                            }
                        }
                    }
                }

                storage.set('sliders', 'page-list', list);

                return list;
            },
            save: function () {
                var self = this;

                setTimeout(function () {
                    var list = [];
                    self.find('.pm-div').each(function (i) {
                        var data = JSON.parse($(this).attr('datas'));
                        if ($(this).hasClass('selected')) {
                            data.selected = 'selected';
                            data.sort = i - 1000;

                            $(this).removeClass('new');
                            data['new'] = '';
                        } else {
                            if (!$(this).hasClass('new')) data['new'] = '';
                            data.selected = '';
                            data.sort = i;
                        }
                        list.push(data);
                    });
                    list.sort(function (x, y) {
                        return x.sort - y.sort;
                    });
                    storage.set('sliders', 'page-list', list);
                }, 100);
            },
            editPage: function (pageId, key, value) {
                var list = storage.get('sliders')['page-list'] || [];
                list.forEach(function (item) {
                    if (item.pageId == pageId) {
                        item[key] = value;
                    }
                });
                storage.set('sliders', 'page-list', list);
            },
            removePage: function (pageId) {
                var list = storage.get('sliders')['page-list'] || [];
                var list2 = [];
                list.forEach(function (item) {
                    if (item.pageId != pageId) {
                        list2.push(item);
                    }
                });
                storage.set('sliders', 'page-list', list2);
            }
        };


        CETH.createEvents(pageManager, 'addPage, removePage, swapPage');

        CETH.on(pageManager, 'addPage', function () {
            this.save();
            $('#page-manager .toggle-tips').hide();
        });
        CETH.on(pageManager, 'removePage', function () {
            this.save();
            $('#page-manager .toggle-tips').hide();
        });
        CETH.on(pageManager, 'swapPage', function () {
            this.save();
            $('#page-manager .drag-tips').hide();
        });

        $(document).on('keydown', function (e) {
            switch (e.keyCode) {
                case 27:
                    pageManager.shutdown();
                    break;
            }
        });

        window.pageManager = pageManager;


    })();


    $(function () {

        /**
         * @tmpl method strongNumber
         * @desc use for doT.js tmpl
         */
        window.strongNumber = function (str) {
            return str.replace(/(\d(?:\d|\.|-)*)/, "<strong>$1</strong>");
        };


        window.VideosPage = {
            $el: null,
            initialize: function (firstPage, request) {
                var self = this;
                this.$el = $('#page-video');
                Object.keys(self.events).forEach(function (evt) {
                    var events = /(\S+)\s(.+)/.exec(evt),
                            eventName = events[1],
                            eventSelector = events[2];
                    self.$el.on(eventName, eventSelector, function (e, arg) {
                        return self[self.events[evt]].call(self, e, this, arg);
                    });
                });
                if (firstPage) {
                    self.nowRender(true, request);
                } else {
                    self.delayRender(RENDER_DELAY);
                }
                $('#video-search-form').die('submit').live('submit', function () {
                    Stat.searchPV();
                    openFormUrl(this);
                    return false;
                });
                $('#video-search-form')[0].submit = function () {
                    openFormUrl(this);
                };
                $('#search-videos').autocomplete('https://sug.so.360.cn/suggest?encodein=utf-8&encodeout=utf-8', {
                    zhida: false,
                    selectFirst: false,
                    type: 'jsonp',
                    dataType: 'jsonp',
                    scrollHeight: 300,
                    width: 228,
                    offset: {left: -6, top: 0},
                    parse: function (data) {
                        var parsed = [];
                        data.s.forEach(function (v) {
                            parsed.push({
                                data: [v],
                                value: v,
                                result: v
                            });
                        });
                        return parsed;
                    }
                }).on('result', function (e, data) {
                    Stat.searchPV();
                    if (data.link) {
                        //location = data.link;
                        openUrl(data.link);
                        return;
                    }
                    $(this).parents('form')[0].submit();
                });

            },
            nowRender: function (screenshot, request) {
                var self = this;
                console.log('VideosPage render:', +new Date - st + 'ms(距页面打开)');
                var error = false;
                try {
                    error = self.render();
                } catch (e) {
                    error = true
                }
                if (request || error)  self.updateData();
                //try {this.find('.top-area .nav>li a:eq(' + storage.get('__ajax_cache')['page_videos_default_bigimg'] + ')').trigger('mouseenter', true);}catch(e){}
                try {
                    this.find('.tabs>li.' + storage.get('__ajax_cache')['page_videos_default_tab']).trigger('mouseenter');
                } catch (e) {
                }
                //try {this.find('.bottom-area .nav>li a.' + storage.get('__ajax_cache')['page_videos_default_page']).trigger('mouseenter');}catch(e){}
                self.startSlider();
                $(document).trigger('mousemove');
                if (screenshot) {
                    ScreenShot.hideAndCapture('VideoPage-Rendered', true);
                }
            },
            delayRender: function (delay) {
                var self = this;
                $(window).on('newpages:firstPageOnLoad', function () {
                    self.nowRender();
                });
            },
            find: function (selector) {
                return this.$el ? this.$el.find(selector) : $('');
            },
            events: {
                'mouseenter .vslider': 'stopSlider',
                'mouseleave .vslider': 'startSlider',
                'mouseenter .top-area .nav>li a': 'selectSubImage',
                'mouseenter .tabs>li': 'selectSubTab',
                'mouseenter .bottom-area .nav>li a': 'selectSubPage'
            },
            startSlider: function () {
                var self = this;
                this.stopSlider();
                this.vSliderInterval = setInterval(function () {
                    var navs = self.find('.top-area .nav>li a');
                    var index = navs.filter('.selected').parent().index();
                    index++;
                    if (index > navs.length - 1) {
                        index = 0;
                    }
                    self.find('.top-area .nav>li a:eq(' + index + ')').trigger('mouseenter');
                }, 1000 * 5);
            },
            stopSlider: function () {
                clearInterval(this.vSliderInterval);
            },
            selectSubTab: function (e) {
                this.find('.tabs>li').removeClass('selected');
                this.find('.video-page').hide();

                storage.set('__ajax_cache', 'page_videos_default_tab', e.target.className)

                this.find('.video-page.' + e.target.className).show();
                $(e.target).addClass('selected');

                ScreenShot.capture('VideoTabChanged');
            },
            selectSubImage: function (e, ele, arg) {
                var index = $(ele).parent().index();
                if (!arg && /*storage.get('__ajax_cache')['page_videos_default_bigimg']*/this.find('.top-area .nav>li a.selected').parent().index() == index) {
                    return false;
                }
                //storage.set('__ajax_cache', 'page_videos_default_bigimg', index);
                this.find('.top-area .vslider .title span').text($(ele).attr('_title') || '');
                this.find('.top-area .nav>li a').removeClass('selected');
                this.find('.bigimgs img').stop(true, true).fadeOut(arg ? 0 : 400);
                this.find('.bigimgs img:eq(' + index + ')').stop(true, true).fadeIn(arg ? 0 : 400);
                $(ele).addClass('selected');
                return false;
            },
            selectSubPage: function (e) {
                this.find('.bottom-area .nav>li a').removeClass('selected');
                this.find('.img-pages > ul').css({visibility: 'hidden'});

                storage.set('__ajax_cache', 'page_videos_default_page', e.target.className)

                this.find('.img-pages > ul.' + e.target.className).css({visibility: 'visible'});
                $(e.target).addClass('selected');
            },
            resizeUi: function () {
                if ($('.page>.videos').length == 0) {
                    return;
                }
                var vslideW = $('.videos .hide-tmpl')[0].clientWidth - $('.videos .side').width() - 5;
                $('.videos .vslider').width(vslideW);

                var videoPageHeight;
                $('.videos .video-page').height(videoPageHeight = $('.videos.grid .side').height()
                        - $('.videos .tops>.title').height()
                        - $('.videos .tops>.tabs').height() - 8);

                if (videoPageHeight < 275) {
                    $('.videos .tops').addClass('hide8');
                    this.find('.video-page li').removeAttr('style');
                } else {
                    $('.videos .tops').removeClass('hide8');
                    this.find('.video-page li').css('line-height', Math.min((videoPageHeight - 20) / 10, 33) + 'px');
                }

                this.find('.img-pages').height(this.find('.bottom-area').height() - this.find('.bottom-area .nav').height());

                var imgs = this.find('.bottom-area .img img');
                if (imgs.length > 0) {
                    imgs.css({width: '100%', height: '100%'});
                    //imgs.height(Math.floor(imgs[0].offsetWidth * 125 / 220));
                    setTimeout(function () {
                        imgs.css({width: imgs.width(), height: imgs.height()});
                    });
                }
                var slider_imgs = this.find('.vslider .nav img');
                if (slider_imgs.length > 0) {
                    slider_imgs.width('100%');
                    slider_imgs.height(Math.floor(slider_imgs[0].offsetWidth * 75 / 105));
                    setTimeout(function () {
                        slider_imgs.width(slider_imgs.width());
                    });
                }
            },
            render: function () {
                return function () {
                    var self = this;
                    var collectionMap = {
                        '.vslider .bigimgs': 'cyclingplay',
                        '.vslider .title span': ['cyclingplay', 0],
                        '.vslider .nav': 'cyclingplay',
                        '.img-pages .page1': 'bottom_group_tongbu',
                        '.img-pages .page2': 'bottom_group_huayu',
                        '.img-pages .page3': 'bottom_group_oumei',
                        '.video-page.movie ul': 'filmlist',
                        '.video-page.tv ul': 'teleplaylist',
                        '.video-page.hot ul': 'zongyilist',
                        '.video-page.comic ul': 'cartoonlist'
                    };

                    var collectionTmplFns = {};
                    for (selector in collectionMap) {
                        if (!self.find(selector).data('tmpl')) {
                            self.find(selector).data('tmpl', self.find(selector).html());
                        }
                        collectionTmplFns[selector] = doT.template(self.find(selector).data('tmpl') || '');
                    }

                    var error = false;
                    var datas, key, data;
                    datas = storage.get('__ajax_cache')['page_data_360kan'];
                    if (datas) {
                        try {
                            datas = JSON.parse(datas);
                        } catch (e) {
                            datas = null;
                        }
                        if (datas) {
                            try {
                                try {
                                    var poster360 = {bigPoster: datas.selfdata[0].img, name: datas.selfdata[0].title, playurl: datas.selfdata[0].url, smallPoster: datas.selfdata[0].s_img};
                                    if (datas.cyclingplay.length < 8) {
                                        datas.cyclingplay.push(poster360);
                                    } else {
                                        datas.cyclingplay[7] = poster360;
                                    }
                                    var tongbu360 = {poster: datas.selfdata[1].img, name: datas.selfdata[1].title, playurl: datas.selfdata[1].url};
                                    if (datas.bottom_group_tongbu.length < 8) {
                                        datas.bottom_group_tongbu.push(tongbu360);
                                    } else {
                                        datas.bottom_group_tongbu[7] = tongbu360;
                                    }
                                } catch (e) {
                                }
                                for (var selector in collectionMap) {
                                    key = collectionMap[selector];
                                    if (key instanceof Array) {
                                        data = datas;
                                        key.forEach(function (ck) {
                                            data = (data || {})[ck];
                                        });
                                    } else {
                                        data = datas[key];
                                    }
                                    try {
                                        self.find(selector).html(collectionTmplFns[selector](data))
                                                .find('img[data-src]').each(function () {
                                            this.src = $(this).attr('data-src');
                                        });
                                    } catch (e) {
                                        self.find(selector).html('');
                                        error = true;
                                    }
                                }
                                self.find('img[data-src-delay]').each(function () {
                                    this.src = $(this).attr('data-src-delay');
                                });
                                self.find('.hide-tmpl').show();
                                self.resizeUi();
                            } catch (e) {
                                self.find('.page-loading').css('display', 'table');
                                error = true;
                            }
                        }
                        self.find('.page-loading').hide();
                    } else {
                        self.find('.page-loading').css('display', 'table');
                        self.find('.hide-tmpl').show();
                        error = true;
                    }
                    return error;
                };
            }(),
            updateData: function () {
                var self = this;
                $.getJSON('http://site.browser.360.cn/msgmodel.php?callback=?&mt=["360kan"]&v=' + api.GetVersion(), function (datas) {
                    if (!datas.errno) {
                        try {
                            var data = datas.data['360kan'];
                            if (data.cyclingplay.length > 0 && data.bottom_group_tongbu.length > 0 && data.bottom_group_huayu.length > 0 && data.bottom_group_oumei.length > 0
                                    && data.teleplaylist.length > 0 && data.filmlist.length > 0 && data.cartoonlist.length > 0 && data.zongyilist.length > 0) {
                                storage.set('__ajax_cache', 'page_data_360kan', JSON.stringify(data));
                                self.render();
                            }
                        } catch (e) {
                        }
                    }
                });
            }
        };

        $(window).on('resize', function () {
            setTimeout(function () {
                VideosPage.resizeUi();
            });
        });

    });


    $(function () {
        window.NewsPage = {
            $el: null,
            initialize: function (firstPage, request) {
                var self = this;
                this.$el = $('#page-news');
                Object.keys(self.events).forEach(function (evt) {
                    var events = /(\S+)\s(.+)/.exec(evt),
                            eventName = events[1],
                            eventSelector = events[2];
                    self.$el.on(eventName, eventSelector, function (e, arg) {
                        return self[self.events[evt]].call(self, e, this, arg);
                    });
                });
                if (firstPage) {
                    self.nowRender(true, request);
                    AD.showNews(true);
                } else {
                    self.delayRender(RENDER_DELAY);
                }
            },
            nowRender: function (screenshot, request) {
                var self = this;
                console.log('NewsPage render:', +new Date - st + 'ms(距页面打开)');
                var error = false;
                try {
                    error = self.render();
                } catch (e) {
                    error = true
                }
                if (request || error) self.updateData();
                this.find('.tabs>li.' + (storage.get('__ajax_cache')['page_news_default_tab'] || 'ad')).trigger('mouseenter');
                if (screenshot) {
                    ScreenShot.hideAndCapture('NewsPage-Rendered', true);
                }
            },
            delayRender: function (delay) {
                var self = this;
                $(window).on('newpages:firstPageOnLoad', function () {
                    self.nowRender();
                    AD.showNews();
                });
            },
            onSlideShow: function () {
                AD.newsStat();
            },
            find: function (selector) {
                return (this.$el || $(document)).find(selector);
            },
            events: {
                'mouseenter .tabs>li': 'selectSubPage',
            },
            selectSubPage: function (e) {
                this.find('.tabs>li').removeClass('selected');
                this.find('.contents>ul').hide();

                storage.set('__ajax_cache', 'page_news_default_tab', e.target.className)

                this.find('.contents>ul.' + e.target.className).show();
                $(e.target).addClass('selected');

                ScreenShot.capture('ShoppingPageChanged');
            },
            render: function () {
                return function () {
                    var collectionMap = {
                        '.np-news-left .slide': 'datu',
                        '.np-news-left .img': 'xiaotu',
                        '.np-news-center h2': ['jiaodian', 0],
                        '.np-news-center ul:eq(0)': ['jiaodian', 1],
                        '.np-news-center ul:eq(1)': ['jiaodian', 2],
                        '.np-news-center ul:eq(2)': ['jiaodian', 3],
                        '.np-news-right .keywords ul.weibo': 'right_list',
                        '.np-news-right .img': 'right_turn'
                    };

                    var collectionTmplFns = {};
                    for (selector in collectionMap) {
                        if (!$(selector).data('tmpl')) {
                            $(selector).data('tmpl', $(selector).html());
                        }
                        collectionTmplFns[selector] = doT.template($(selector).data('tmpl') || '');
                    }

                    var self = this;
                    var error = false;
                    var datas, key, data;
                    datas = storage.get('__ajax_cache')['page_data_news8'];
                    if (datas) {
                        try {
                            datas = JSON.parse(datas);
                        } catch (e) {
                            datas = null;
                        }
                        if (datas) {
                            datas.jiaodian = [];
                            try {
                                datas.datu = datas.shimage.slice(0, 1);
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.xiaotu = datas.shimage.slice(1, 5);
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.jiaodian[0] = datas.shtext.slice(0, 1);
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.jiaodian[1] = datas.shtext.slice(1, 5);
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.jiaodian[2] = datas.shtext.slice(5, 10);
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.jiaodian[3] = datas.shtext.slice(10, 13);
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.right_list = datas.wbtext.slice(0, 10);
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.right_turn = datas.wbimage.slice(0, 2);
                            } catch (e) {
                                error = true
                            }
                            try {
                                for (var selector in collectionMap) {
                                    key = collectionMap[selector];
                                    if (key instanceof Array) {
                                        data = datas;
                                        key.forEach(function (ck) {
                                            data = (data || {})[ck];
                                        });
                                    } else {
                                        data = datas[key];
                                    }
                                    try {
                                        self.find(selector).html(collectionTmplFns[selector](data))
                                                .find('img[data-src]').each(function () {
                                            this.src = $(this).attr('data-src');
                                        });
                                    } catch (e) {
                                        self.find(selector).html('');
                                        error = true;
                                    }
                                }
                                self.find('.hide-tmpl').show();
                                wrapResize();
                            } catch (e) {
                                self.find('.page-loading').css('display', 'table');
                                error = true;
                            }
                            self.find('.page-loading').hide();
                        }
                    } else {
                        self.find('.page-loading').css('display', 'table');
                        self.find('.hide-tmpl').show();
                        error = true;
                    }
                    return error;
                };
            }(),
            updateData: function () {
                var self = this;
                $.getJSON('http://site.browser.360.cn/msgmodel.php?callback=?&mt=["news8"]&v=' + api.GetVersion(), function (datas) {
                    if (!datas.errno) {
                        try {
                            var data = datas.data.news8;
                            if (data.shtext.length > 0 && data.shimage.length > 0 &&
                                    data.wbtext.length > 0 && data.wbimage.length > 0) {
                                storage.set('__ajax_cache', 'page_data_news8', JSON.stringify(self.cutImg(data)));
                                self.render();
                            }
                        } catch (e) {
                        }
                    }
                });
            },
            cutImg: function (data) {
                try {
                    data.shimage.forEach(function (item, i) {
                        item.img = cutImg2(item.img, i == 0 ? '360_214' : '182_117');
                    });
                } catch (e) {
                }
                return data;
            }
        };

    });

    $(function () {
        window.GamesPage = {
            $el: null,
            initialize: function (firstPage, request) {
                var self = this;
                this.$el = $('#page-games');
                if (firstPage) {
                    self.nowRender(true, request);
                } else {
                    self.delayRender(RENDER_DELAY);
                }
            },
            nowRender: function (screenshot, request) {
                var self = this;
                console.log('GamesPage render:', +new Date - st + 'ms(距页面打开)');
                self.requestData(true, 500);
                if (screenshot) {
                    ScreenShot.hideAndCapture('GamesPage-Rendered', true);
                }
            },
            delayRender: function (delay) {
                var self = this;
                this.shouldRequest = true;
                $(window).on('newpages:firstPageOnLoad', function () {
                    if (self.render()) {
                        self.requestData(true);
                    }
                });
            },
            requestData: function (render, timeout, recursion) {
                timeout = timeout || 10 * 1000;
                var self = this;
                if (render) {
                    self.find('.page-loading').css('display', 'table');
                    self.find('.hide-tmpl').show();
                }
                $.ajax({
                    url: 'http://eye.mygame82.com/api/getMultiList/',
                    data: {
                        mid: api.GetMID(),
                        mtype: 'mid',
                        p: 6,
                        multibid: 'llqjpyy|llqrmyx|llqzxhw'
                    },
                    dataType: 'jsonp',
                    jsonp: '_callback',
                    timeout: timeout,
                    success: function (data) {
                        if (data && data.errno === 0) {
                            storage.setData('__game_cache', data);
                            if (render) {
                                self.render();
                            }
                        }
                    },
                    error: function (xhr, status) {
                        if (status == 'timeout') {
                            if (self.render()) {
                                if (recursion !== false) {
                                    self.requestData(true, null, false);
                                } else {
                                    self.find('.page-loading').hide();
                                    self.find('.hide-tmpl').hide();
                                }
                            }
                        }
                    }
                });
            },
            onSlideShow: function () {
                if (this.shouldRequest && !this.slideRequested) {
                    this.slideRequested = true;
                    this.requestData(false);
                }
            },
            find: function (selector) {
                return (this.$el || $(document)).find(selector);
            },
            resizeUi: function () {
                if (!this.$el) {
                    return;
                }
                try {
                    var self = this;
                    var icon_imgs = self.find('.np-games-left ul img');
                    if (icon_imgs.length > 0) icon_imgs.height(icon_imgs[0].offsetWidth);
                    var webgame_imgs = self.find('.np-games-right ul img');
                    if (webgame_imgs.length > 0) webgame_imgs.height(Math.floor(webgame_imgs[0].offsetWidth * 90 / 144));
                } catch (e) {
                }
            },
            render: function () {
                return function (random) {
                    var collectionMap = {
                        '.np-games .new ul': 'llqzxhw',
                        '.np-games .hot ul': 'llqrmyx',
                        '.np-games-right ul': 'llqjpyy'
                    };

                    var collectionTmplFns = {};
                    for (selector in collectionMap) {
                        if (!$(selector).data('tmpl')) {
                            $(selector).data('tmpl', $(selector).html());
                        }
                        collectionTmplFns[selector] = doT.template($(selector).data('tmpl') || '');
                    }

                    var self = this;
                    var error = false;
                    var datas, key, data;
                    datas = storage.get('__game_cache')['data'];
                    if (datas) {
                        if (datas) {
                            try {
                                datas.llqzxhw = datas.llqzxhw.slice(0, 12);
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.llqrmyx = datas.llqrmyx.slice(0, 12);
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.llqjpyy = datas.llqjpyy.slice(0, 9);
                            } catch (e) {
                                error = true
                            }
                            try {
                                for (var selector in collectionMap) {
                                    key = collectionMap[selector];
                                    if (key instanceof Array) {
                                        data = datas;
                                        key.forEach(function (ck) {
                                            data = (data || {})[ck];
                                        });
                                    } else {
                                        data = datas[key];
                                    }
                                    try {
                                        self.find(selector).html(collectionTmplFns[selector](data))
                                                .find('img[data-src]').each(function () {
                                            this.src = $(this).attr('data-src');
                                        });
                                    } catch (e) {
                                        self.find(selector).html('');
                                        error = true;
                                    }
                                }
                                self.find('.hide-tmpl').show();
                                self.resizeUi();
                                self.bindStat();
                            } catch (e) {
                                self.find('.page-loading').css('display', 'table');
                                error = true;
                            }
                        }
                        self.find('.page-loading').hide();
                    } else {
                        self.find('.page-loading').css('display', 'table');
                        self.find('.hide-tmpl').show();
                        error = true;
                    }
                    return error;
                };
            }(),
            bindStat: function () {
                this.find('a[_bid]').on('click', function () {
                    var $this = $(this);
                    var data = {
                        setp_id: 2,
                        bid: $this.attr('_bid'),
                        ad_id: $this.attr('_ad_id'),
                        pos_id: $this.attr('_pos_id'),
                        p: 6,
                        type: 3,
                        mtype: 'mid',
                        mid: api.GetMID(),
                        round: $this.attr('_round'),
                        r: Date.now() + Math.random().toString().replace('0.', '').substr(0, 10)
                    };
                    var params = [];
                    for (var k in data) {
                        params.push(k + '=' + data[k]);
                    }
                    new Image().src = 'http://r.yx-s.net/b/eye/s/wan/?' + params.join('&');
                });
            }
        };

        $(window).on('resize', function () {
            setTimeout(function () {
                GamesPage.resizeUi();
            });
        });
    });


    $(function () {
        window.fixNum = function (num) {
            if (num < 10) {
                return '0' + num;
            }
            return num;
        };

        window.MusicPage = {
            $el: null,
            initialize: function (firstPage, request) {
                var self = this;
                this.$el = $('#page-musics');
                if (firstPage) {
                    self.nowRender(true, request);
                } else {
                    self.delayRender(RENDER_DELAY);
                }

                this.find('.refresh').click(function () {
                    MusicPage.render();
                    ScreenShot.capture('MusicPageRefresh');
                });
            },
            nowRender: function (screenshot, request) {
                var self = this;
                console.log('MusicPage render:', +new Date - st + 'ms(距页面打开)');
                var error = false;
                try {
                    error = self.render(false);
                } catch (e) {
                    error = true
                }
                if (request || error)  self.updateData();
                self.rendered = true;
                if (screenshot) {
                    ScreenShot.hideAndCapture('MusicPage-Rendered', true);
                }
            },
            delayRender: function (delay) {
                var self = this;
                $(window).on('newpages:firstPageOnLoad', function () {
                    self.nowRender();
                });
            },
            find: function (selector) {
                return (this.$el || $(document)).find(selector);
            },
            resizeUi: function () {
                if (!this.$el || !this.rendered) {
                    return;
                }
                try {
                    var self = this;
                    clearTimeout(self._t_resize_render);
                    self._t_resize_render = setTimeout(function () {
                        var size = self.getSizeClass();
                        if (self.size != size) {
                            self.size = size;
                            self.render(false);
                        }
                    }, 5);

                    var recommend_imgs = self.find('.np-music .recommend ul img');
                    if (recommend_imgs.length > 0) recommend_imgs.height(Math.floor(recommend_imgs[0].offsetWidth * 100 / 157));
                    var hot_imgs = self.find('.np-music .hot ul img');
                    if (hot_imgs.length > 0) hot_imgs.height(hot_imgs[0].offsetWidth);
                } catch (e) {
                }
            },
            getSizeClass: function () {
                var size;
                if (this.$el && this.$el.children().hasClass('w1024')) {
                    size = 'w1024';
                } else {
                    size = 'w1440';
                }
                return size;
            },
            render: function () {
                return function (random) {
                    var collectionMap = {
                        '.np-music .recommend ul': 'recommendalbum',
                        '.np-music .hot ul': 'hotalbum',
                        '.np-music .topsong ul': 'topsong',
                        '.np-music .topnew ul': 'topnew',
                        '.np-music .topnetwork ul': 'topnetwork',
                        '.np-music .topclassic ul': 'topclassic',
                    };

                    var collectionTmplFns = {};
                    for (selector in collectionMap) {
                        if (!$(selector).data('tmpl')) {
                            $(selector).data('tmpl', $(selector).html());
                        }
                        collectionTmplFns[selector] = doT.template($(selector).data('tmpl') || '');
                    }

                    var self = this;
                    var error = false;
                    var datas, key, data;
                    datas = storage.get('__ajax_cache')['page_data_newmusic'];
                    if (datas) {
                        try {
                            datas = JSON.parse(datas);
                        } catch (e) {
                            datas = null;
                        }
                        if (datas) {
                            try {
                                datas.recommendalbum = datas.recommendalbum.slice(0, 8);
                            } catch (e) {
                                error = true
                            }
                            try {
                                this.rndIndex = storage.get('__ajax_cache')['page_music_rnd_index'];
                                if (this.rndIndex == undefined) this.rndIndex = 1;
                                if (random !== false)  this.rndIndex++;
                                if (this.rndIndex > 6)  this.rndIndex = 1;
                                storage.set('__ajax_cache', 'page_music_rnd_index', this.rndIndex);
                                var end = this.rndIndex * 5;
                                datas.hotalbum = datas.hotalbum.slice(end - 5, end);
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.topsong = datas.topsong.slice(0, 6);
                                datas.topsong.forEach(function (item) {
                                    item.songURL = 'http://s.music.so.com/s?q=' + item.song;
                                });
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.topnew = datas.topnew.slice(0, 6);
                                datas.topnew.forEach(function (item) {
                                    item.songURL = 'http://s.music.so.com/s?q=' + item.song;
                                });
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.topnetwork = datas.topnetwork.slice(0, 6);
                                datas.topnetwork.forEach(function (item) {
                                    item.songURL = 'http://s.music.so.com/s?q=' + item.song;
                                });
                            } catch (e) {
                                error = true
                            }
                            try {
                                datas.topclassic = datas.topclassic.slice(0, 6);
                                datas.topclassic.forEach(function (item) {
                                    item.songURL = 'http://s.music.so.com/s?q=' + item.song;
                                });
                            } catch (e) {
                                error = true
                            }
                            try {
                                for (var selector in collectionMap) {
                                    key = collectionMap[selector];
                                    if (key instanceof Array) {
                                        data = datas;
                                        key.forEach(function (ck) {
                                            data = (data || {})[ck];
                                        });
                                    } else {
                                        data = datas[key];
                                    }
                                    try {
                                        self.find(selector).html(collectionTmplFns[selector](data))
                                                .find('img[data-src]').each(function () {
                                            this.src = $(this).attr('data-src');
                                        });
                                    } catch (e) {
                                        self.find(selector).html('');
                                        error = true;
                                    }
                                }
                                self.find('.hide-tmpl').show();
                            } catch (e) {
                                self.find('.page-loading').css('display', 'table');
                                error = true;
                            }
                        }
                        self.find('.page-loading').hide();

                        var recommend_imgs = self.find('.np-music .recommend ul img');
                        if (recommend_imgs.length > 0) recommend_imgs.height(Math.floor(recommend_imgs[0].offsetWidth * 100 / 157));
                        var hot_imgs = self.find('.np-music .hot ul img');
                        if (hot_imgs.length > 0) hot_imgs.height(hot_imgs[0].offsetWidth);
                    } else {
                        self.find('.page-loading').css('display', 'table');
                        self.find('.hide-tmpl').show();
                        error = true;
                    }
                    return error;
                };
            }(),
            updateData: function () {
                var self = this;
                $.getJSON('http://site.browser.360.cn/msgmodel.php?callback=?&mt=["newmusic"]&v=' + api.GetVersion(), function (datas) {
                    if (!datas.errno) {
                        try {
                            var data = datas.data.newmusic;
                            if (data.recommendalbum.length > 0 && data.hotalbum.length > 0 &&
                                    data.topsong.length > 0 && data.topnew.length > 0 && data.topnetwork.length > 0 && data.topclassic.length > 0) {
                                storage.set('__ajax_cache', 'page_data_newmusic', JSON.stringify(data));
                                self.render(false);
                            }
                        } catch (e) {
                        }
                    }
                });
            }
        };

        $(window).on('resize', function () {
            setTimeout(function () {
                MusicPage.resizeUi();
            });
        });
    });


    $(function () {
        window.ShoppingPage = {
            $el: null,
            sendRequestSwitch: false,
            configs: {
                ANIMATE_EASING: '',
                ANIMATE_TIMES: 200
            },
            initialize: function (firstPage, request) {
                //this.updateData();
                //firstPage ? this.sendRequestLink(): false;
                if (firstPage) {
                    this.nowRender(true, request);
                    //this.updateData();
                    //this.sendRequestLink()
                } else {
                    this.delayRender(RENDER_DELAY);
                }
                this.initAutoPlay();
            },
            initAutoPlay: function () {
                startAutoPlay();
                $('.shopping-middle').hover(stopAutoPlay, startAutoPlay);

                var _autoPlayTimer;

                function startAutoPlay() {
                    stopAutoPlay();
                    _autoPlayTimer = setInterval(doAutoPlay, 5000);
                }

                function stopAutoPlay() {
                    clearInterval(_autoPlayTimer);
                }

                function doAutoPlay() {
                    var $current = $('#nav-list li.active:visible');
                    if ($current.length == 0) {
                        return;
                    }
                    var $next = $current.next(':visible');
                    if ($next.length == 0) {
                        $next = $('#nav-list li:visible').eq(0);
                    }
                    // $next.trigger('click');
                    ShoppingPage.doPageRecommend($next.index());
                }
            },
            nowRender: function (screenshot, request) {
                var self = this;
                //console.log('GamesPage render:', +new Date - st + 'ms(距页面打开)');
                self.updateData();
                if (screenshot) {
                    ScreenShot.hideAndCapture('ShoppingPage-Rendered', true);
                }
            },
            delayRender: function (delay) {
                var self = this;
                $(window).on('newpages:firstPageOnLoad', function () {
                    self.updateData();
                });
            },
            onSlideShow: function () {
                this.sendRequestLink();
            },
            sendRequestLink: function () {
                if (this.sendRequestSwitch) return;
                this.sendRequestSwitch = true;

                try {
                    var datas_text = JSON.parse(storage.get('__ajax_cache')['shopping_right_top_text']);
                } catch (e) {
                    return
                }
                ;

                var len = datas_text.length,
                        datasArr = [],
                        img;

                for (var i = 0; i < len; i++) {
                    if (datas_text[i][3]) datasArr.push(datas_text[i][3]);
                }
                datas_text = datasArr.join(";");

                img = new Image();
                img.src = "https://xd-q.mediav.com/s?type=1&r=20&asin=" + datas_text;
            },
            render: function () {
                //提交打点
                this.sendRequestLink();

                var collectionMap = {
                    "#js-shopping-left-bottom ul": "js_shopping_left_bottom",
                    "#shopping-middle-list ul": "shopping_middle_list",
                    "#ad_1": "ad_1",
                    "#ad_2": "ad_2",
                    "#ad_3": "ad_3",
                    ".shopping-right-top ul": "shopping_right_top_text"
                }
                var collectionTmplFns = {};
                for (selector in collectionMap) {
                    if (!$(selector).data('tmpl')) {
                        $(selector).data('tmpl', $(selector).html());
                    }
                    collectionTmplFns[selector] = doT.template($(selector).data('tmpl') || '');
                }

                var self = this;
                var error = false;
                var datas, datas_ad1, datas_ad2, datas_ad3, datas_text, key, data, datas_left4;
                var shoppings = {};

                datas = storage.get('__ajax_cache')['page_data_newshopping'];
                datas_left4 = storage.get('__ajax_cache')['page_data_newshopping_left4'];
                datas_ad1 = storage.get('__ajax_cache')['page_data_newshopping_ad1'];
                datas_ad2 = storage.get('__ajax_cache')['page_data_newshopping_ad2'];
                datas_ad3 = storage.get('__ajax_cache')['page_data_newshopping_ad3'];
                datas_text = storage.get('__ajax_cache')['shopping_right_top_text'];

                //数据解析
                function jsonParse(data) {
                    try {
                        switch (data) {
                            case "datas":
                                datas = JSON.parse(datas);
                                break;
                            case "datas_left4":
                                datas_left4 = JSON.parse(datas_left4);
                                break;
                            case "datas_ad1":
                                datas_ad1 = JSON.parse(datas_ad1);
                                break;
                            case "datas_ad2":
                                datas_ad2 = JSON.parse(datas_ad2);
                                break;
                            case "datas_ad3":
                                datas_ad3 = JSON.parse(datas_ad3);
                                break;
                            case "datas_text":
                                datas_text = JSON.parse(datas_text);
                                break;
                        }
                    } catch (e) {
                    }
                    ;

                    return jsonParse;
                }

                jsonParse("datas")("datas_ad1")("datas_ad2")("datas_ad3")("datas_text")("datas_left4");

                //获取数据
                shoppings["js_shopping_left_bottom"] = datas_left4.slice(1, 5);
                shoppings["shopping_middle_list"] = datas.slice(1, 10);
                shoppings["ad_1"] = datas_ad1.slice(0, 1);
                shoppings["ad_2"] = datas_ad2.slice(0, 1);
                shoppings["ad_3"] = datas_ad3.slice(0, 1);
                shoppings["shopping_right_top_text"] = datas_text;

                for (selector in collectionMap) {
                    var tempVal = collectionMap[selector];
                    var data = shoppings[tempVal];
                    $(selector).html(collectionTmplFns[selector](data))
                            .find('img[data-src]').each(function () {
                        this.src = $(this).attr('data-src');
                    });
                }

                //nav-list
                $("#nav-list li").hide();
                var datas_len = $('#shopping-middle-list ul > li').length;
                if (datas_len > 3) {
                    $("#nav-list li").eq(0).show();
                    $("#nav-list li").eq(1).show();
                }
                if (datas_len > 6) {
                    $("#nav-list li").show();
                }

                $('#page-shopping .page-loading').css('display', 'none');
            },
            updateData: function () {
                var mediavUID = this.getMediaVUID();
                $('#page-shopping .page-loading').css('display', 'table');
                this.ajax("https://show-3.mediav.com/s?type=1&of=4&showid=P2tq0t", "jsonp", "page_data_newshopping_left4");
                this.ajax("https://show-3.mediav.com/s?type=1&of=4&showid=xXJ7Wm", "jsonp", "page_data_newshopping");
                this.ajax("https://show-g.mediav.com/s?type=1&of=4&showid=YuOf8U&uid=" + mediavUID, "jsonp", "page_data_newshopping_ad1");
                this.ajax("https://show-g.mediav.com/s?type=1&of=4&showid=YVZ8wD&uid=" + mediavUID, "jsonp", "page_data_newshopping_ad2");
                this.ajax("https://show-g.mediav.com/s?type=1&of=4&showid=FnNbxf&uid=" + mediavUID, "jsonp", "page_data_newshopping_ad3");
                this.ajax("https://show-s.mediav.com/s?pubid=122630&type=1&of=4&tags=15_3%2C76_3%2C53_3", "jsonp", "shopping_right_top_text");
            },
            getMediaVUID: function () {
                function getHash(str) {
                    var hash = 1,
                            charCode = 0,
                            idx;
                    if (str) {
                        hash = 0;
                        for (idx = str.length - 1; idx >= 0; idx--) {
                            charCode = str.charCodeAt(idx);
                            hash = (hash << 6 & 268435455) + charCode + (charCode << 14);
                            charCode = hash & 266338304;
                            hash = charCode != 0 ? hash ^ charCode >> 21 : hash;
                        }
                    }
                    return hash;
                }

                var d = (new Date() - 0);
                var s = window.location.href;
                var hash = getHash(s);
                var uid = "" + d + hash + Math.random() + Math.random() + Math.random() + Math.random();
                uid = uid.replace(/\./g, "").substring(0, 32);
                return uid;
            },
            ajax: function (url, callback, saveData) {
                var self = this;
                self.ajaxRequestCount++;
                $.ajax({
                    url: url,
                    type: "get",
                    dataType: "jsonp",
                    jsonp: callback,
                    success: function (datas) {
                        datas = self.isAjaxInterface(saveData, datas);
                        storage.set('__ajax_cache', saveData, JSON.stringify(datas));
                        if (--self.ajaxRequestCount <= 0) self.render();
                    },
                    error: function () {
                        datas = self.isAjaxInterface(saveData, []);
                        storage.set('__ajax_cache', saveData, JSON.stringify(datas));
                        if (--self.ajaxRequestCount <= 0) self.render();
                    }
                });
            },
            isAjaxInterface: function (saveData, datas) {
                //shopping_right_top_text
                var arr, addData
                if (saveData == "shopping_right_top_text") {
                    if (datas.length > 0) var data = datas[0].info;
                    arr = [];
                    addData = [{
                        0: "360购物",
                        1: "http://se.360.cn/product/temai.html?anchor=like"
                    }, {
                        0: "发现你喜欢",
                        1: "http://se.360.cn/product/temai.html?anchor=like"
                    }, {
                        0: "今日特卖",
                        1: "http://se.360.cn/product/temai.html?anchor=like"
                    }, {
                        0: "精品抢先购",
                        1: "http://se.360.cn/product/temai.html?anchor=like"
                    }, {
                        0: "这里有好货",
                        1: "http://se.360.cn/product/temai.html?anchor=like"
                    }, {
                        0: "猜您爱购",
                        1: "http://se.360.cn/product/temai.html?anchor=like"
                    }, {
                        0: "什么牌子好",
                        1: "http://se.360.cn/product/temai.html?anchor=like"
                    }, {
                        0: "热门商家",
                        1: "http://se.360.cn/product/temai.html?anchor=like"
                    }, {
                        0: "每日好店",
                        1: "http://se.360.cn/product/temai.html?anchor=like"
                    }];
                    for (d in data) {
                        for (var i = 0; i < data[d].length; i++) {
                            arr.push(data[d][i]);
                        }
                    }
                    if (arr.length < 9) {
                        for (var i = 0; i < addData.length; i++) {
                            arr.push(addData[i]);
                        }
                    }
                    arr = arr.slice(0, 9);
                    return arr;
                } else if (saveData == "page_data_newshopping") {
                    arr = [];
                    addData = [{
                        "pn": "今夏潮流逛街指南，你的购物专家",
                        "curl1": "http://gouwu.360.cn/#floor_jiaju",
                        "timg": "http://p6.qhimg.com/d/inn/d55a6c7e/5.jpg"
                    }, {
                        "pn": "浓情蜜意，盛惠来袭",
                        "curl1": "http://gouwu.360.cn/#floor_jiaju",
                        "timg": "http://p6.qhimg.com/d/inn/fd82bd9a/6.jpg"
                    }, {
                        "pn": "每日好店，你可能喜欢的店铺都在这里",
                        "curl1": "http://gouwu.360.cn/#floor_jiaju",
                        "timg": "http://p4.qhimg.com/d/inn/2b26222e/7.jpg"
                    }];

                    for (d in datas) {
                        if (typeof datas[d] != "function") {
                            arr.push(datas[d]);
                        }
                    }
                    if (arr.length == 0) {
                        arr.push({});
                    }
                    for (var i = 0; i < addData.length; i++) {
                        arr.push(addData[i]);
                    }
                    return arr;
                } else if (saveData == "page_data_newshopping_left4") {
                    arr = [];
                    addData = [{
                        "pn": "热销新潮酷品",
                        "curl1": "http://gouwu.360.cn/#floor_jiaju",
                        "timg": "http://p1.qhimg.com/d/inn/3b808c4f/1.jpg"
                    }, {
                        "pn": "尖货每日上新",
                        "curl1": "http://gouwu.360.cn/#floor_jiaju",
                        "timg": "http://p7.qhimg.com/d/inn/29304ef2/2.jpg"
                    }, {
                        "pn": "优品百货，品质生活",
                        "curl1": "http://gouwu.360.cn/#floor_jiaju",
                        "timg": "http://p3.qhimg.com/d/inn/f5a993b3/3.jpg"
                    }, {
                        "pn": "千款好货大抢购",
                        "curl1": "http://gouwu.360.cn/#floor_jiaju",
                        "timg": "http://p7.qhimg.com/d/inn/25652ee9/4.jpg"
                    }];

                    for (d in datas) {
                        if (typeof datas[d] != "function") {
                            arr.push(datas[d]);
                        }
                    }
                    if (arr.length == 0) {
                        arr.push({});
                    }
                    for (var i = 0; i < addData.length; i++) {
                        arr.push(addData[i]);
                    }
                    return arr;
                } else if (saveData == "page_data_newshopping_ad1") {
                    //page_data_newshopping_ad1
                    arr = [];
                    addData = [{
                        "link": "http://gouwu.360.cn/#floor_jiaju",
                        "logo": "http://p7.qhimg.com/d/inn/8e31d888/banner2-300x100.jpg"
                    }];

                    for (d in datas) {
                        if (typeof datas[d] != "function") {
                            arr.push(datas[d]);
                        }
                    }

                    for (var i = 0; i < addData.length; i++) {
                        arr.push(addData[i]);
                    }
                    return arr;
                } else if (saveData == "page_data_newshopping_ad2") {
                    //page_data_newshopping_ad2
                    arr = [];
                    addData = [{
                        "link": "http://gouwu.360.cn/#floor_jiaju",
                        "logo": "http://p1.qhimg.com/d/inn/c84b665b/banner1-300x250.jpg"
                    }];

                    for (d in datas) {
                        if (typeof datas[d] != "function") {
                            arr.push(datas[d]);
                        }
                    }

                    for (var i = 0; i < addData.length; i++) {
                        arr.push(addData[i]);
                    }
                    return arr;
                } else if (saveData == "page_data_newshopping_ad3") {
                    //page_data_newshopping_ad3
                    arr = [];
                    addData = [{
                        "link": "http://gouwu.360.cn/#floor_jiaju",
                        "logo": "http://p1.qhimg.com/d/inn/b624906b/banner3-336x280.jpg"
                    }];

                    for (d in datas) {
                        if (typeof datas[d] != "function") {
                            arr.push(datas[d]);
                        }
                    }

                    for (var i = 0; i < addData.length; i++) {
                        arr.push(addData[i]);
                    }
                    return arr;
                }
            },
            ajaxRequestCount: 0,
            doPageRecommend: function (index) {
                $("#shopping-middle-list ul").removeClass().addClass("ul-index" + index);
                $("#nav-list li").removeClass("active").eq(index).addClass('active');
            }
        }

        $(document).on("click", "#nav-list li", function () {
            var index = $(this).data("index");
            ShoppingPage.doPageRecommend(index);
        })
    });

    /* eslint indent: [1, 2] */
    /* global $, RENDER_DELAY, st, ScreenShot, DC, HuajiaoPage, doT */
    $(function () {
        /**
         * 花椒直播页面
         * @type Object
         */
        window.HuajiaoPage = {
            $el: null,

            /**
             * 初始化
             * @param  {[type]} firstPage [description]
             * @param  {[type]} request   [description]
             * @return {[type]}           [description]
             */
            initialize: function (firstPage, request) {
                var self = this;
                this.$el = $('#page-huajiao');
                if (firstPage) {
                    self.nowRender(true, request);
                } else {
                    self.delayRender(RENDER_DELAY);
                }
            },

            /**
             * 即时渲染
             * @param  {[type]} screenshot [description]
             * @param  {[type]} request    [description]
             * @return {[type]}            [description]
             */
            nowRender: function (screenshot, request) {
                var self = this;
                console.log('HuajiaoPage render:', +new Date() - st + 'ms(距页面打开)');
                var error = false;
                try {
                    error = self.render();
                } catch (e) {
                    error = true;
                }

                if (request || error) {
                    self.updateData();
                }

                if (screenshot) {
                    ScreenShot.hideAndCapture('HuajiaoPage-Rendered', true);
                }
            },

            /**
             * 延迟渲染
             * @return {[type]} [description]
             */
            delayRender: function () {
                var self = this;
                $(window).on('newpages:firstPageOnLoad', function () {
                    self.nowRender();
                });
            },

            find: function (selector) {
                return this.$el ? this.$el.find(selector) : $('');
            },

            /**
             * [resizeUi description]
             * @return {[type]} [description]
             */
            resizeUi: function () {
                if ($('.page>.huajiao').length == 0) {
                    return;
                }

                var focusW = $('#focuspic').width();
                var specialSize = Math.floor((focusW * 19 - 110) / 42);
                var normalH = Math.floor((specialSize - 20) / 2);
                var normalW = Math.floor(normalH * 230 / 190);
                specialSize = normalH * 2 + 20;
                var marginR = focusW - 2 * normalW - specialSize - 16;
                $('#focuspic').height(specialSize + 20);
                this.find('.feed.special').css({width: specialSize, height: specialSize, marginRight: marginR});
                this.find('.feed.normal').css({width: normalW, height: normalH});

                var imageW = this.find('#feedlist .screenshot').width();
                var imageH = imageW * 125 / 105;
                this.find('#feedlist .screenshot').height(imageH);
                var contH = this.find('.hide-tmpl').height();
                var imgH = Math.floor(contH - specialSize - 40 - 30);
                if (imgH < imageH) {
                    this.find('#feedlist .screenshot').height(imgH);
                }
            },

            /**
             * [render description]
             * @return {[type]} [description]
             */
            render: function () {
                var error = false;
                var self = this;
                var data = DC.storage.getCache('page_data_huajiao', 1000 * 60);
                try {
                    data = JSON.parse(data);
                } catch (e) {
                }
                if (data) {
                    self.find('#focuspic').html(doT.template(self.find('#focuspic').html())(data.topBannerList));
                    self.find('#feedlist').html(doT.template(self.find('#feedlist').html())(data.liveList));
                    self.find('img').each(function (index, el) {
                        $(el).attr('src', $(el).data('src'));
                    });

                    self.find('.hide-tmpl').show();
                    self.resizeUi();
                    self.find('.page-loading').hide();
                } else {
                    self.find('.page-loading').css('display', 'table');
                    self.find('.hide-tmpl').show();
                    error = true;
                }
                return error;
            },

            /**
             * [updateData description]
             * @return {[type]} [description]
             */
            updateData: function () {
                var self = this;
                $.ajax('http://misc.huajiao.com/se/tab?v=2&fmt=jsonp&_callback=?', {
                    dataType: "jsonp",
                    jsonpCallback: '_huajiaoCallback'
                }).then(function (ret) {
                    if (!ret.errno) {
                        try {
                            if (ret.data.liveList.length && ret.data.topBannerList.length) {
                                ret.data.topBannerList.forEach(function (item, index) {
                                    item.cls = index == 0 ? 'special' : 'normal';
                                    item.cls += item.type == 1 ? ' live' : ' review';
                                    item.resize_image = self.resizeImg(item.image, index == 0 ? [530, 530] : [308, 255]);

                                    item.first_color = item.first_color || '';
                                    item.second_color = item.second_color || '';
                                });

                                ret.data.liveList.forEach(function (item, index) {
                                    item.resize_image = self.resizeImg(item.image, [184, 219]);
                                });

                                ret.data.topBannerList = ret.data.topBannerList.slice(0, 5);
                                ret.data.liveList = ret.data.liveList.slice(0, 6);

                                DC.storage.setCache('page_data_huajiao', JSON.stringify(ret.data));
                                return self.render();
                            }
                        } catch (e) {
                        }
                    }

                    DC.storage.setCache('page_data_huajiao', DC.storage.getCache('page_data_huajiao', 1000 * 3600 * 24 * 100));
                    self.render();
                }).fail(function () {
                    DC.storage.setCache('page_data_huajiao', DC.storage.getCache('page_data_huajiao', 1000 * 3600 * 24 * 100));
                    self.render();
                });
            },

            /**
             * [resizeImg description]
             * @return {[type]} [description]
             */
            resizeImg: function (img, size) {
                if (img.indexOf('image.huajiao.com') > 0) {
                    return img.replace(/\.jpg$/, '-' + size[0] + '_' + size[1] + '.jpg');
                }

                return img.replace(/http:\/\/i(\d+)[.]qhimg[.]com\//, 'http://i$1.qhimg.com/dm/' + size[0] + '_' + size[1] + '_/');
            }
        };

        $(window).on('resize', function () {
            setTimeout(function () {
                HuajiaoPage.resizeUi();
            });
        });

    });


    var Storage = {
        _option_key: 'wallpaper_option',
        _data_key: 'wallpaper_data',

        setOption: function (str) {
            localStorage[Storage._option_key] = str;
        },
        getOption: function () {
            return localStorage[Storage._option_key] || 0;
        },
        setData: function (str) {
            localStorage[Storage._data_key] = str;
        },
        getData: function () {
            return localStorage[Storage._data_key] || '';
        }
    };

    var Wallpaper = {
        config: {
            EMPTY_INDEX: 0,
            UPLOAD_INDEX: 8
        },
        container: $('.setup-pop .wallpaper'),
        init: function () {
            PushData.renderWallpaperHistory();
            this.initSetWallpaper();
            this.bind();
        },
        bind: function () {
            var self = this;
            this.container.delegate('li', 'click', function () {
                var el = $(this), index = el.index();
                if (el.attr('wp-id')) {
                    index += 9;
                }
                if (index == self.config.UPLOAD_INDEX) {
                    self.container.find('.bg-theme-file').trigger('click');
                } else {
                    self.setWallpaper(true, index);
                }
            });
            this.container.find('li.sx div').click(function (e) {
                e.stopPropagation();
            });

            this.container.delegate('.bg-theme-file', 'change', function () {
                var file = this.files[0], fileReader = new FileReader();
                fileReader.onload = function () {
                    self.setWallpaper(true, self.config.UPLOAD_INDEX, this.result);
                };
                fileReader.readAsDataURL(file);
                this.outerHTML = this.outerHTML;
            });
        },
        isDefaultWallpaper: function () {
            var lastOption = Storage.getOption() | 0;
            return (lastOption == 0 || lastOption > this.config.UPLOAD_INDEX);
        },
        initSetWallpaper: function () {
            console.log('setWallpaper:', +new Date - st + 'ms(距页面打开)', arguments);
            var lastOption = Storage.getOption() | 0;
            var data = Storage.getData();

            if (window.existVersion61 && !storage.get('__import_data')['wallpaper-done']) {
                storage.set('__import_data', 'wallpaper-done', true);
                if (lastOption == 5 && data != '') {
                    lastOption = this.config.UPLOAD_INDEX;
                    Storage.setOption(this.config.UPLOAD_INDEX);
                }
            }

            if (lastOption >= 0 && lastOption != this.config.UPLOAD_INDEX) {
                this.setWallpaper(false, lastOption);
            } else if (data != '') {
                if (lastOption == this.config.UPLOAD_INDEX) {
                    this.setWallpaper(false, lastOption, data);
                }
            }
        },
        setWallpaper: function (animate, index, src) {
            var self = this;
            var el = this.container.find('li').eq(index);

            if (self.prevLoader) {
                self.prevLoader.onload = null;
                self.prevLoader = null;
            }
            self.prevLoader = img;

            if (self.prevEl) {
                self.prevEl.removeClass('loading');
            }
            self.prevEl = el;

            if (index == this.config.EMPTY_INDEX) {
                // white paper
                if (animate) {
                    PushData.closePushWallpaper();
                }
                self._animateBefore(animate);
                $('.wallpaper-current').css('background', '#f5f5f5');
                self._animateBG(animate);
                $(document.body).removeClass('black-bg');
                Storage.setData('');
                Storage.setOption(index);
                self._setWallMisc(index);
                return;
            }

            var custom = (index == this.config.UPLOAD_INDEX);

            if (!custom) {
                if (el.attr('wp-id')) {
                    src = (PushData.getHistory(el.attr('wp-id')) || {})['bg_url'];
                } else {
                    src = el[0].dataset.imgsrc;
                }
            }

            var img = new Image();
            img.onload = function () {
                if (animate) {
                    try {
                        Storage.setData(custom ? src : '');
                        Storage.setOption(index);
                    } catch (e) {
                        if (custom)  alert('您选择的图片太大，请更换图片！');
                        return;
                    }
                }
                if (animate && !el.attr('wp-id')) {
                    PushData.closePushWallpaper();
                }
                self._animateBefore(animate);
                if (custom) {
                    var width = img.width,
                            height = img.height;

                    if (width > screen.availWidth && height > (screen.avialHeight - 120)) {
                        $('.wallpaper-current').css({
                            'background-image': 'url(' + src + ')',
                            'background-size': 'auto, auto',
                            'background-position': '50% 50%',
                            'background-repeat': 'no-repeat'
                        });
                    } else {
                        if (width < 500 || height < 500) {
                            $('.wallpaper-current').css({
                                'background-image': 'url(' + src + ')',
                                'background-size': 'auto, auto',
                                'background-position': '0 0',
                                'background-repeat': 'repeat',
                                'background-attachment': 'fixed'
                            });
                        } else {
                            $('.wallpaper-current').css({
                                'background-image': 'url(' + src + ')',
                                'background-size': 'cover, 100%',
                                'background-position': '50% 50%',
                                'background-repeat': 'no-repeat',
                                'background-attachment': 'fixed'
                            });
                        }
                    }
                } else {
                    if (el.attr('wp-id')) {
                        PushData.setWallpaper(PushData.getHistory(el.attr('wp-id')));
                    } else {
                        $('.wallpaper-current').css({
                            'background-image': 'url(' + src + ')',
                            'background-size': 'cover, 100%',
                            'background-position': '50% 50%',
                            'background-attachment': 'fixed'
                        });
                        switch (index) {
                            case 6:
                            case 7:
                                $(document.body).addClass('black-bg');
                                break;
                            default:
                                $(document.body).removeClass('black-bg');
                                break;
                        }
                    }
                }
                self._animateBG(animate);
                self._setWallMisc(index);
            };
            img.onerror = function () {
                $(document.body).removeClass('black-bg');
                el.removeClass('loading');
                self._wallHideScreen();
                if (custom) {
                    alert('您选择的图片无法解析，请更换图片！');
                }
            };
            el.addClass('loading');
            img.src = src;
        },
        _animateBefore: function (animate) {
            if (animate) {
                $('.wallpaper-prev')[0].style.cssText = $('.wallpaper-current')[0].style.cssText;
                $('.wallpaper-current').remove();
                $('.wallpaper-prev').after('<div class="wallpaper-current"></div>');
                $('.wallpaper-current').on('webkitAnimationEnd', function () {
                    $('.wallpaper-current').removeClass('circle-mask-ani');
                    $('.wallpaper-prev').attr('style', '');
                });
            }
        },
        _animateBG: function (animate) {
            if (animate) {
                $('.wallpaper-current').addClass('circle-mask-ani');
            }
        },
        _setWallMisc: function (index) {
            this.container.find('li').removeClass('on').eq(index).removeClass('loading').addClass('on');
            this._wallHideScreen();
        },
        _wallHideScreen: function () {
            console.log('setWallpapered:', +new Date - st + 'ms(距页面打开)', arguments);
            ScreenShot.hideAndCapture('setWallpapered', false, true);
        }

    };

    $(function () {
        Wallpaper.init();
    });


    var PushData = {
        'wpId': 0,
        'init': function () {
            var self = this;
            this.bind();
            var iurl = 'http://site.browser.360.cn/push.php?callback=?';
            var surl = 'http://query.rec.360.cn/gasucs/query_rec/?mid=' + api.GetMID() + '&src=newtab&__callback=?&ret_type=jsonp&req=kw';
            var cache = DC.storage.getCache(iurl, Number.MAX_VALUE);
            var search_cache = DC.storage.getCache(surl, Number.MAX_VALUE);
            self.wordlistTplFn = doT.template($('#so-hostword-list').html());
            if (cache && cache.data) {
                PushData.execShowset(cache.data.showset);
                PushData.execWallpaper(cache.data);
                PushData.execDogear(cache.data);
                // PushData.execLinks(cache.data);
                if ($.isArray(cache.data['links'])) {
                    DC.storage.setCache(iurl, null);
                }
            }
            /*获取常搜*/
            setTimeout(function () {
                if (self.SoHotWord.acceptSoHotword() && search_cache) {
                    self.SoHotWord.execSearchWord(search_cache);
                }
            });
            $(window).on('newpages:firstPageOnLoad', function () {
                var mt = [/*'wordlinks', */ 'showset'];
                if (self.acceptWallpaper()) {
                    mt.push('wallpaper');
                }
                if (self.acceptDogear()) {
                    mt.push('dogear');
                }
                mt = JSON.stringify(mt);
                DC.get(iurl, {
                    rn: Date.now(),
                    v: api.GetVersion(),
                    mid: api.GetMID(),
                    mt: mt
                }, function (ret) {
                    if (ret && ret.data) {
                        PushData.execShowset(ret.data.showset);
                        PushData.execWallpaper(ret.data);
                        PushData.execDogear(ret.data);
                        // PushData.execLinks(ret.data);
                    }
                }, 1000 * 60 * 60, false);
                /*获取常搜*/
                self.SoHotWord.getSearchWord(surl);
            });
        },
        SoHotWord: {
            line_height: 20,
            $parent: $(".cloud-links"),
            worddel: function (e) {
                var self = this,
                        o = self.$parent;
                var idx = e.parent().index();
                o.find('.links ul li').eq(idx).remove();
                o.find('.more-layer ul li').eq(idx).remove();
                self.reFlow();

                var t = o.find("ul");
                if (t.find("a").length == 0) {
                    //删完了
                    o.empty();
                }

                var mixedMid = api.GetMID();
                var _t = +new Date();
                var kw = e.attr('data-m');
                var oa = hex_md5(mixedMid + kw + _t + 'a%&k*b');
                var params = {
                    action: 'del',
                    mid: mixedMid,
                    src: 'del',
                    del_kw: kw,
                    oa: oa,
                    _t: _t
                };
                $.ajax({
                    url: 'http://query.rec.360.cn/gasucs/query_rec/',
                    data: params,
                    dataType: "jsonp",
                    jsonp: "__callback",
                    success: function (ret) {
                    }
                });

                DC.storage.setCache(self.surl, null);
            },
            openFeature: function () {
                var self = this;
                storage.set('so_hotword_options', 'enable-push-hotword', true);
                DC.storage.setCache(this.surl, null);

                var mixedMid = api.GetMID();
                var _t = +new Date();
                var oa = hex_md5(mixedMid + _t + 'a%&k*b');
                var params = {
                    action: 'reset',
                    mid: mixedMid,
                    src: 'newtab',
                    oa: oa,
                    _t: _t
                };
                $.ajax({
                    url: 'http://query.rec.360.cn/gasucs/query_rec/',
                    data: params,
                    dataType: "jsonp",
                    jsonp: "__callback",
                    success: function (ret) {
                        self.getSearchWord(self.surl);
                    }
                });
            },
            stopFeature: function () {
                $('#enable-query-rec').attr('checked', false);
                $('.so-hotword menu, .so-hotword .confirm').hide();
                $('.so-hotword').removeClass('so-hotword editing opening');
                storage.set('so_hotword_options', 'enable-push-hotword', false);
                Stat.send('357.202.gif');
                var mixedMid = api.GetMID();
                var _t = +new Date();
                var oa = hex_md5(mixedMid + _t + 'a%&k*b');
                var params = {
                    action: 'off',
                    mid: mixedMid,
                    src: 'newtab',
                    oa: oa,
                    _t: _t
                };
                $.ajax({
                    url: 'http://query.rec.360.cn/gasucs/query_rec/',
                    data: params,
                    dataType: "jsonp",
                    jsonp: "__callback",
                    success: function (ret) {
                    }
                });
            },
            acceptSoHotword: function () {
                return storage.get('so_hotword_options')['enable-push-hotword'] !== false;
            },
            hideSearchWord: function () {
                $('#search-form .cloud-links').empty();
            },
            getSearchWord: function (surl) {
                var self = this;
                self.surl = surl;
                if (!self.acceptSoHotword()) {
                    return false;
                }

                DC.get(surl, {}, function (ret) {
                    if (ret) {
                        self.execSearchWord(ret);
                    }
                }, 1000 * 60 * 60, false);
            },
            execSearchWord: function (search_data) {
                var self = this;
                self.wordlistTplFn = doT.template($('#so-hostword-list').html());

                if (search_data.length > 0) {
                    var data = search_data.slice(0, 30);
                    if (!data || data.length == 0) {
                        return;
                    }
                    var html = self.wordlistTplFn(data);
                    $('#search-form .cloud-links').addClass("so-hotword").find('.links').html(html);
                    $('#search-form .cloud-links .more-layer').html(html);
                    self.reFlow();

                    var showed = true;
                    try {
                        var list = [];
                        pageManager.getPageList().forEach(function (item) {
                            if (item.selected == 'selected') {
                                list.push(item.pageId);
                            }
                        });
                        if (list.length == 0 || (list.length == 1 && list[0] == 'video')) {
                            showed = false;
                        }
                    } catch (e) {
                    }
                    if (showed) {
                        Stat.send('357.689.gif');
                    }
                }
            },
            reFlow: function () {
                var prevTop, lineCount;
                $('.so-hotword .links ul li').each(function (i) {
                    var top = $(this).offset().top;
                    if (prevTop !== undefined && prevTop != top) {
                        lineCount = i;
                        return false;
                    }
                    prevTop = top;
                });
                var $lis = $('.so-hotword .more-layer ul li');
                if ($lis.length > lineCount) {
                    $('.so-hotword .next').show().find('span').text($lis.length - lineCount);
                    $('.so-hotword .more-layer').addClass('show');
                    $lis.removeClass('headline').slice(0, lineCount).addClass('headline');
                } else {
                    $('.so-hotword .next').hide();
                    $('.so-hotword .more-layer').removeClass('show');
                }
            },
            resizeReflow: function () {
                var bodyClass = $('.ntp-body').attr('class');
                if (this.__prevBodyClass != bodyClass) {
                    this.reFlow();
                    this.__prevBodyClass = bodyClass;
                }
            },
        },
        bind: function () {
            var self = this;
            $(document).on('click', function () {
                $('.so-hotword menu, .so-hotword .confirm').hide();
                $('.so-hotword').removeClass('opening');
            }).on('click', '.so-hotword .rec-setting', function (e) {
                e.stopPropagation();
                $(document).trigger('click');
                $('.so-hotword menu').show();
            }).on('click', '.so-hotword .rec-return', function () {
                $('.so-hotword').removeClass('editing');
            }).on('click', '.so-hotword menu li:eq(0)', function (e) {
                $('.so-hotword').removeClass('opening').addClass('editing');
                self.SoHotWord.reFlow();
            }).on('click', '.so-hotword menu li:eq(1)', function (e) {
                e.stopPropagation();
                $('.so-hotword .confirm').show();
            }).on('click', '.so-hotword .confirm .cancel', function (e) {
                $('.so-hotword .confirm').hide();
            }).on('click', '.so-hotword .confirm .btns a:eq(0)', function (e) {
                self.SoHotWord.stopFeature();
            }).on("click", ".so-hotword li a.del", function () {
                var kw = $(this).attr("data-m");
                self.SoHotWord.worddel($(this));
                storage.set("black_words", kw, 1);
            }).on("click", ".so-hotword a.next", function (e) {
                e.stopPropagation();
                // 隐藏搜索引擎列表框
                var opening = $('.so-hotword').hasClass('opening');
                $(document).trigger('click');
                if (opening) {
                    $('.so-hotword').removeClass('opening');
                } else {
                    $('.so-hotword').addClass('opening');
                    self.SoHotWord.reFlow();
                }
            })

            $('.setup-pop .wallpaper .tabs a').click(function () {
                var index = $(this).index();
                var tabs = $('.setup-pop .wallpaper .tabs a');
                var conts = $('.setup-pop .wallpaper .tab-conts>div');
                tabs.removeClass('selected');
                tabs.eq(index).addClass('selected');
                conts.hide();
                conts.eq(index).show();
            });

            if (storage.get('wallpaper_options')['enable-push-wallpaper'] === false) {
                $('#enable-push-wallpaper').attr('checked', false);
            } else {
                storage.set('wallpaper_options', 'enable-push-wallpaper', true);
                $('#enable-push-wallpaper').attr('checked', true);
            }
            $('#enable-push-wallpaper').change(function () {
                storage.set('wallpaper_options', 'enable-push-wallpaper', this.checked);
                if (!this.checked) {
                    if (Storage.getOption() == 0) {
                        $('.setup-pop .wallpaper li').eq(0).trigger('click');
                    }
                    $('.angle-right-bottom-ad').hide();
                }
            });

            if (!self.SoHotWord.acceptSoHotword()) {
                $('#enable-query-rec').attr('checked', false);
            } else {
                $('#enable-query-rec').attr('checked', true);
            }
            $('#enable-query-rec').change(function () {
                this.checked ? self.SoHotWord.openFeature() : self.SoHotWord.stopFeature();
            });

            $('.angle-ad-close').on('click', function (e) {
                e.stopPropagation();
                storage.set('wallpaper_options', 'disable-angle-ad-id-' + $(this).data('id'), true);
                $('.angle-right-bottom-ad').hide();
                ScreenShot.capture('AngleAdClosed');
            });
            $('.angle-right-bottom-ad').hover(function () {
                $(this).css('background-image', 'url("' + $(this).data('hover') + '")');
            }, function () {
                $(this).css('background-image', 'url("' + $(this).data('link') + '")');
            });

            $(window).resize(function () {
                self.resizeUI();
            });
        },
        acceptWallpaper: function () {
            return Wallpaper.isDefaultWallpaper() && storage.get('wallpaper_options')['enable-push-wallpaper'];
        },
        acceptDogear: function () {
            return storage.get('wallpaper_options')['enable-push-wallpaper'];
        },
        renderWallpaperHistory: function () {
            var list = this.getHistoryList();
            list.reverse();
            var sb = [];
            list.forEach(function (item) {
                sb.push('<li wp-id="' + filterHtml(item.id) + '" style="background-image:url(' + filterHtml(item.thumb) + ')">');
            });
            $('.wallpaper .wp-history').html(sb.join(''));
        },
        getHistoryList: function () {
            return storage.get('wallpaper_options')['history'] || [];
        },
        addHistory: function (item) {
            storage.set('wallpaper_options', 'history', [item]);
            return item;
        },
        getHistory: function (id) {
            var list = this.getHistoryList();
            for (var i = 0; i < list.length; i++) {
                if (list[i].id == id) {
                    list[i]._index = i;
                    return list[i];
                }
            }
            return null;
        },
        execWallpaper: function (data) {
            data = (data || {})['wallpaper'];
            if (!data || !data.id) {
                if (this.wallpaperSeted) {
                    ScreenShot.capture('delete');
                }
                return;
            }
            this.wpId = data.id;
            data = this.addHistory(data);
            this.renderWallpaperHistory();
            if (this._checkAutoSet(data)) {
                ScreenShot.setWallpapered = false;
                var img = new Image();
                img.onload = function () {
                    PushData.defaultSetWallpaper(data, true);
                };
                img.onerror = function () {
                    Wallpaper._wallHideScreen();
                };
                img.src = data.bg_url;
            }
        },
        _checkAutoSet: function (data) {
            var seted;
            if (!data) {
                seted = false;
            } else {
                seted = storage.get('wallpaper_options')['enable-push-wp-id-' + data.id];
            }
            return this.acceptWallpaper() && !seted;
        },
        defaultSetWallpaper: function (data) {
            if (!data) {
                return;
            }
            if (!this._checkAutoSet(data)) {
                return;
            }
            if (this.wallpaperSeted) {
                if (this.prevWpId != this.wpId) {
                    ScreenShot.capture('delete');
                }
                return;
            }
            this.prevWpId = this.wpId;
            this.wallpaperSeted = true;
            Wallpaper.setWallpaper(false, Wallpaper.config.UPLOAD_INDEX + 1);
            Stat.send('388.6667.gif');
        },
        closePushWallpaper: function () {
            $('.wallpaper-push-links').css({
                display: 'none'
            });
            storage.set('wallpaper_options', 'enable-push-wp-id-' + this.wpId, true);
            $('.angle-ad-close').trigger('click');
        },
        resizeUI: function () {
            this.SoHotWord.resizeReflow();

            var btn = $('.wallpaper-push-links .btn');
            if (btn.length == 0) {
                return;
            }
            var currentPage = $('.page-list .current>div');
            if (currentPage.length == 0) {
                return;
            }
            var linkImg = $('.wallpaper-push-links .img');
            var pageOffset = currentPage.offset();
            var minsize = $(document).width() / 2;
            if (btn.css('top') != 'auto') {
                var top = parseInt(btn.css('top'));
                if (top + linkImg.height() > pageOffset.top) {
                    minsize = pageOffset.left;
                } else {
                    minsize = $('#search-form').offset().left;
                }
            } else {
                var bottom = parseInt(btn.css('bottom'));
                var pageHeight = currentPage.height();
                if (currentPage.hasClass('mosts')) {
                    pageHeight = currentPage.width() * (579 / 1200);
                }
                if (currentPage.hasClass('customs')) {
                    pageHeight = currentPage.children('ul').height();
                }
                if (currentPage.hasClass('np-news')) {
                    var matches = (currentPage.css('-webkit-transform').match(/matrix\(([\d\.]+),/));
                    var scale = parseFloat(matches && matches[1]) || 1;
                    pageHeight = pageHeight * scale;
                }
                if (bottom + linkImg.height() > $(window).height() - (pageOffset.top + pageHeight)) {
                    minsize = pageOffset.left;
                }
            }
            if (btn.css('left') != 'auto') {
                var left = parseInt(btn.css('left'));
                btn.width(Math.min(linkImg.width() + left, minsize) - left);
            } else {
                var right = parseInt(btn.css('right'));
                btn.width(Math.min(linkImg.width() + right, minsize + 0) - right);
            }
        },
        setWallpaper: function (data) {
            var posArr = ['left top', 'right top', 'right bottom', 'left bottom', 'center center'];
            var bgCss = {
                'background-image': 'url(' + data['bg_url'] + ')',
                'background-size': 'cover, 100%',
                'background-position': posArr[(data['bg_pos_type'] - 1)] || posArr[4],
                'background-repeat': 'no-repeat'
            };
            if (data['bg_type'] == 2) {
                bgCss['background-size'] = 'auto';
            }
            $('.wallpaper-current').css(bgCss);

            var link = data['link'];
            if (!link) {
                return;
            }
            $('.wallpaper-push-links').html('<a class="img" style="background-image:url(' + link['img_url'] + ')"><a class="btn" style="z-index:200" href="' + filterHtml(link['url']) + '" target="_blank">').show();
            var linkCss = link['size'] || {};
            switch (link['pos_type']) {
                case 1:
                    linkCss['left'] = link['position']['x'];
                    linkCss['top'] = link['position']['y'];
                    break;
                case 2:
                    linkCss['right'] = link['position']['x'];
                    linkCss['top'] = link['position']['y'];
                    break;
                case 3:
                    linkCss['right'] = link['position']['x'];
                    linkCss['bottom'] = link['position']['y'] + 35;
                    break;
                case 4:
                    linkCss['left'] = link['position']['x'];
                    linkCss['bottom'] = link['position']['y'] + 35;
                    break;
            }
            $('.wallpaper-push-links a').css(linkCss);
            this.resizeUI();
        },
        execShowset: function (data) {
            data = data || {};
            var cver = parseInt(storage.get('settings')['rsv']) || 0;
            var sv = parseInt(data.sv) || 0;
            if (cver < sv && data.sset === '1') {
                localStorage.removeItem('default_engine');
            }
            storage.set('settings', 'rsv', sv);

            var ref = parseInt(data.rset) || 0;
            ntpApis.sendRset(ref);
        },
        execDogear: function (data) {
            wallPaperData = (data || {})['wallpaper'];
            if (!this.acceptDogear()) {
                return;
            }
            data = (data || {})['dogear'];
            if (!data || !data.id) {
                return;
            }
            if (storage.get('wallpaper_options')['disable-angle-ad-id-' + data.id] == true) {
                return;
            }
            if (!this._checkAutoSet(wallPaperData)) {
                return;
            }
            var img = new Image();
            img.onload = function () {
                $('.angle-right-bottom-ad')
                        .css('background-image', 'url("' + data.img_url + '")')
                        .data({
                            link: data.img_url,
                            hover: data.extimg_url
                        })
                        .show()
                        .find('.angle-ad-link').attr('href', data.link_url);
                $('.angle-ad-close').data('id', data.id);

                Stat.send('388.8310.gif');
            };
            img.src = data.img_url;
            new Image().src = data.extimg_url;
        },
        execLinks: function (data) {
            var self = this;
            var $cloudLinks = $('#search-form .cloud-links .links');
            if ($cloudLinks.children().length > 0) {
                return;
            }
            data = (data || {})['links'];
            if (!data) {
                return;
            }
            var mergeData = [];
            try {
                mergeData = mergeData.concat(data['self'] || []);
                var searchword = data['searchword'] || [];
                var adword = data['adword'] || [];
                for (var i = 0; i < searchword.length; i++) {
                    if (i % 2 == 1) {
                        var adwordItem = adword.shift();
                        if (!adwordItem) {
                            break;
                        }
                        searchword.splice(i, 0, adwordItem);
                    }
                }
                mergeData = mergeData.concat(searchword).concat(adword);
            } catch (e) {
            }

            if (!mergeData || mergeData.length == 0) {
                return;
            }
            var sb = [];
            var asins = [];
            mergeData.forEach(function (item) {
                if (item.title) {
                    sb.push('<a href="' + filterHtml(item.url) + '" target="_blank" _type="self">' + filterHtml(item.title));
                } else if (item.text) {
                    var url = item.link || 'https://www.so.com/s?q=' + item.text + '&ie=utf-8&src=se7_newtab_new_link';
                    sb.push('<a href="' + filterHtml(url) + '" target="_blank" _type="searchword">' + filterHtml(item.text));
                } else if (item.length > 3) {
                    asins.push(item[3]);
                    sb.push('<a href="' + filterHtml(item[1]) + '" target="_blank" asin="' + filterHtml(item[3]) + '" _type="adword">' + filterHtml(item[0]));
                }
            });
            $cloudLinks.html(sb.join(''));

            setTimeout(function () {
                var lines = [],
                        arr = [],
                        prevTop;
                $cloudLinks.find('a').each(function () {
                    var pos = $(this).position();
                    if (prevTop != pos.top) {
                        prevTop = pos.top;
                        if (arr.length > 0) {
                            lines.push(arr);
                            arr = [];
                        }
                    }
                    arr.push(this);
                });
                if (arr.length > 0) {
                    lines.push(arr);
                }
                lines.forEach(function (line) {
                    var $span = $('<span/>');
                    line.forEach(function (item) {
                        $span.append(item);
                    });
                    $cloudLinks.append($span);
                });
                $cloudLinks.addClass('ready');

                if (lines.length >= 2) {
                    $('#search-form .cloud-links .next').show().on('click', function () {
                        self.refreshCloudLinks();
                    });
                    $('#search-form .cloud-links').hover(function () {
                        self.stopRefreshLinks();
                    }, function () {
                        self.startRefreshLinks();
                    });
                    self.startRefreshLinks();
                }
            });


            if (asins.length > 0) {
                var data = {
                    asin: asins.join(';'),
                    mid: api.GetMID()
                };
                var params = [];
                for (var k in data) {
                    params.push(k + '=' + data[k]);
                }
                new Image().src = 'http://stats.guess.tf.360.cn/guess/vt?' + params.join('&');
            }
        },
        startRefreshLinks: function () {
            var self = this;
            self.stopRefreshLinks();
            self.refreshTimer = setTimeout(function () {
                self.refreshCloudLinks(true);
            }, 5000);
        },
        stopRefreshLinks: function () {
            this.refreshTimer && clearTimeout(this.refreshTimer);
        },
        refreshCloudLinks: function (auto) {
            var self = this;
            var $cloudLinks = $('#search-form .cloud-links .links');
            $cloudLinks.stop(true, true).animate({
                scrollTop: $cloudLinks.children().eq(1).height()
            }, 500, function () {
                $cloudLinks.children().eq(0).appendTo($cloudLinks);
                $cloudLinks.scrollTop(0);
                if (auto === true) {
                    self.startRefreshLinks();
                }
            });
        }
    };

    $(function () {
        PushData.init();
    });

    var AD = {
        init: function () {
            this.textTplFn = doT.template('{{~ it :p }}<a href="{{!p[1]}}" target="_blank" asin="{{!p[3]}}">{{!p[0]}}</a>&nbsp; {{~}}');
            AD.st = Date.now();
            $(document).delegate('a[asin]', 'mousedown', function () {
                AD.dd = Date.now();
            });
            $(document).delegate('a[asin]', 'mouseup', function (e) {
                if (e.button == 2) {
                    return;
                }
                AD.ud = Date.now();
                var data = {
                    asin: $(this).attr('asin'),
                    mid: api.GetMID(),
                    _t: Date.now(),
                    st: AD.st,
                    dd: AD.dd,
                    ud: AD.ud
                };
                var params = [];
                for (var k in data) {
                    params.push(k + '=' + data[k]);
                }
                new Image().src = 'http://stats.guess.tf.360.cn/guess/clk.js?' + params.join('&');
            });
        },

        showNews: function (stat) {
            $.ajax({
                url: 'https://show-s.mediav.com/s',
                data: {
                    pubid: 115478,
                    type: 1,
                    of: 4,
                    tags: '15_3,76_3,53_3,70_10',
                    // ip: '58.247.80.130'
                },
                dataType: 'jsonp',
                jsonp: 'jsonp',
                success: function (data) {
                    data = data && data[0];
                    if (data && data.errno == 0 && data.info) {

                    } else {
                        return;
                    }

                    var tyid = 15;
                    var data_info = [
                        ["什么牌子好", 'http://gouwu.360.cn/#floor_jiaju'],
                        ["猜您爱购", 'http://gouwu.360.cn/#floor_jiaju'],
                        ["每日好店", 'http://gouwu.360.cn/#floor_jiaju']
                    ];

                    data.info[tyid] = (data.info[tyid] || []).concat(data_info);
                    if (data.info[tyid] && data.info[tyid].length > 0) {
                        $('.np-news .np-news-center ul:nth(0) li:last').html(AD.textTplFn(data.info[tyid].slice(0, 3)) + '<em class="ad"></em>');
                    }

                    tyid = 76;
                    data_info = [
                        ["携程1折机票", 'http://u.ctrip.com/union/CtripRedirect.aspx?TypeID=2&allianceid=5376&sid=446551&ouid=360_wenzilian&jumpUrl=http://flights.ctrip.com/'],
                        ["携程仲基来啦", 'http://u.ctrip.com/union/CtripRedirect.aspx?TypeID=2&Allianceid=5376&sid=802343&jumpUrl=http://pages.ctrip.com/commerce/promote/201604/other/song2/pc/index.html'],
                        ["旅游特惠", 'http://u.ctrip.com/union/CtripRedirect.aspx?typeid=2&sid=442869&allianceid=5376&jumpurl=http://vacations.ctrip.com/']
                    ];
                    data.info[tyid] = (data.info[tyid] || []).concat(data_info);
                    if (data.info[tyid] && data.info[tyid].length > 0) {
                        $('.np-news .np-news-center ul:nth(1) li:last').html(AD.textTplFn(data.info[tyid].slice(0, 3)) + '<em class="ad"></em>');
                    }

                    tyid = 53;
                    data_info = [
                        ["发现你喜欢", 'http://gouwu.360.cn/#floor_jiaju'],
                        ["这里有好货", 'http://gouwu.360.cn/#floor_jiaju'],
                        ["热门商家", 'http://gouwu.360.cn/#floor_jiaju']
                    ];
                    data.info[tyid] = (data.info[tyid] || []).concat(data_info);
                    if (data.info[tyid] && data.info[tyid].length > 0) {
                        $('.np-news .np-news-center ul:nth(2) li:last').html(AD.textTplFn(data.info[tyid].slice(0, 3)) + '<em class="ad"></em>');
                    }

                    var defaultGames = [
                        ['永久免费游戏', 'http://se.360.cn/product/temai.html?anchor=play'],
                        ['3D逼真效果', 'http://se.360.cn/product/temai.html?anchor=play'],
                        ['顶级3D网游', 'http://se.360.cn/product/temai.html?anchor=play'],
                        ['假期游戏首选', 'http://se.360.cn/product/temai.html?anchor=play'],
                        ['人最多的页游', 'http://se.360.cn/product/temai.html?anchor=play'],
                        ['精品赚钱网游', 'http://se.360.cn/product/temai.html?anchor=play'],
                        ['新网游排行榜', 'http://se.360.cn/product/temai.html?anchor=play'],
                        ['最新免费网游', 'http://se.360.cn/product/temai.html?anchor=play'],
                        ['最近热玩游戏', 'http://se.360.cn/product/temai.html?anchor=play'],
                        ['暴强PK领装备', 'http://se.360.cn/product/temai.html?anchor=play'],
                    ];
                    var gameData = data.info['70'] || [];
                    //gameData = gameData.concat(defaultGames.slice(0, 10 - gameData.length));

                    var len = gameData.length >= 10 ? 10 : gameData.length,
                            todoSwitch = false;

                    if (len < 10) {
                        for (var i = 0; i < defaultGames.length; i++) {
                            for (var j = 0; j < len; j++) {
                                if (defaultGames[i][0] == gameData[j][0]) todoSwitch = true;
                            }

                            if (!todoSwitch) {
                                gameData.push(defaultGames[i]);
                            } else {
                                todoSwitch = false;
                            }
                            if (gameData.length >= 10) break;
                        }
                    }

                    var $rightLinks = $('.np-news .np-news-right .keywords .ad li a');
                    gameData.forEach(function (item, i) {
                        if (i >= 10) {
                            return false;
                        }
                        var $item = $rightLinks.eq(i);
                        $item.text(item[0]).attr('href', item[1]).attr('asin', item[3]);
                        if ($item.parent().prev().length == 0) {
                            $item.parent().before('<em>' + (i + 1) + '</em>');
                        }
                    });

                    if (stat) {
                        AD.newsStat();
                    }
                }
            });
        },

        newsStat: function () {
            if (AD._news_stat_send) {
                return;
            }
            AD._news_stat_send = true;
            var group = [];
            $('a[asin]').each(function (i, item) {
                group.push($(item).attr('asin'));
                if (i % 10 == 9 || i == ($('a[asin]').length - 1)) {
                    var _stat_name = '_stat_img_' + new Date().getTime();
                    window[_stat_name] = new Image();
                    window[_stat_name].src = 'https://xd-q.mediav.com/s?type=1&r=20&asin=' + group.join(';');
                    group = [];
                }
            });
        }
    };

    $(function () {
        AD.init();
    });

﻿/**
     * newpage main js
     *
     * @version: 1.0
     * @mail: lichao3@360.cn
     */
    $(function () {

        var CAPTURE_TIMEOUT = 10 * 1000,
                GRID_COUNT = 12,
                imgHeight,
                ANIMATE_EFFECT = true;

        var tileTmplFn = doT.template($('#tile-tmpl').html()),
                tileAddTmplFn = doT.template($('#tile-add-tmpl').html());

        function saveSetting(item, exec) {
            var settings = localStorage['settings'] = localStorage['settings'] || '{}';
            try {
                settings = JSON.parse(settings);
            } catch (e) {
                settings = {};
            }

            settings[item] = exec;

            localStorage['settings'] = JSON.stringify(settings);
        }

        function loadSettings() {
            var settings = localStorage['settings'] = localStorage['settings'] || '{}';
            try {
                settings = JSON.parse(settings);
            } catch (e) {
                settings = {};
            }
            for (var k in settings) {
                try {
                    eval(settings[k]);
                } catch (e) {
                }
            }
            setSearchType('webpage');
        }

        function setSearch(searchItem) {
            $('#search-form .btn :submit').val(searchItem.type == 'so' ? '搜一下' : '搜索一下');
            $('#search-switch>a')[0].className = searchItem.type;
            $('#search-form').attr('action', searchItem.url);
            $('#search-kw').attr('name', searchItem.key);
            // $('#search-kw').attr('placeholder', searchItem.desc);

            $('#search-form input[type=hidden]').remove();

            $('#search-form').attr('default-url', searchItem.default_url || '');

            var params = searchItem.params;
            if (params) {
                for (var k in params) {
                    var hInput = document.createElement('input');
                    hInput.type = 'hidden';
                    hInput.name = k;
                    hInput.value = params[k];
                    $('#search-form').append(hInput);
                }
            }

        }

        $('#search-switch').live('click', function (e) {
            var self = $(this),
                    offset = self.offset();
            var menu = $('.search-menu').css({
                left: offset.left,
                top: offset.top + self.height()
            });
            if (menu.is(':visible')) {
                menu.slideUp();
            } else {
                menu.slideDown();
            }
        });

        $(window).on('resize', function () {
            setTimeout(function () {
                var self = $('#search-switch'),
                        offset = self.offset();
                $('.search-menu').css({
                    left: offset.left,
                    top: offset.top + self.height()
                });
            }, 10);
        });

        var searchMaps = {
            so: {
                type: 'so',
                desc: '360搜索',
                url: 'https://www.so.com/s?ie=utf-8&src=se7_newtab_new',
                default_url: 'https://www.so.com/?src=se7_newtab_new',
                key: 'q',
                params: {
                    ie: 'utf-8',
                    src: 'se7_newtab_new'
                }
            },
            baidu: {
                type: 'baidu',
                desc: '百度',
                url: 'https://www.baidu.com/s?&ie=utf-8',
                key: 'wd',
                params: {
                    ie: 'utf-8'
                }
            },
            google: {
                type: 'google',
                desc: '谷歌',
                url: 'http://www.google.com.hk/search?client=aff-cs-360se&ie=UTF-8',
                key: 'q',
                params: {
                    client: 'aff-cs-360se',
                    ie: 'UTF-8'
                }
            },

            news_so: {
                type: 'news_so',
                desc: '360搜索',
                url: 'http://news.so.com/ns?ie=utf-8&tn=news&src=se7_newtab_new',
                default_url: 'http://sh.qihoo.com/?src=se7_newtab_new',
                key: 'q',
                params: {
                    ie: 'utf-8',
                    tn: 'news',
                    src: 'se7_newtab_new'
                }
            },
            news_baidu: {
                type: 'news_baidu',
                desc: '百度',
                url: 'http://news.baidu.com/ns?&ie=utf-8',
                key: 'word',
                params: {
                    ie: 'utf-8'
                }
            },
            news_google: {
                type: 'news_google',
                desc: '谷歌',
                url: 'http://news.google.com.hk/news/search?client=aff-cs-360se&ie=UTF-8',
                key: 'q',
                params: {
                    client: 'aff-cs-360se',
                    ie: 'UTF-8'
                }
            },

            video_so: {
                type: 'video_so',
                desc: '360搜索',
                url: 'http://video.so.com/v?ie=utf-8&src=se7_newtab_new',
                default_url: 'http://video.so.com/?src=se7_newtab_new',
                key: 'q',
                params: {
                    ie: 'utf-8',
                    src: 'se7_newtab_new'
                }
            },
            video_baidu: {
                type: 'video_baidu',
                desc: '百度',
                url: 'http://video.baidu.com/v?&ie=utf-8',
                key: 'word',
                params: {
                    ie: 'utf-8'
                }
            },
            video_google: {
                type: 'video_google',
                desc: '谷歌',
                url: 'http://www.google.com.hk/search?client=aff-cs-360se&ie=UTF-8',
                key: 'q',
                params: {
                    tbm: 'vid',
                    client: 'aff-cs-360se',
                    ie: 'UTF-8'
                }
            },

            image_so: {
                type: 'image_so',
                desc: '360搜索',
                url: 'http://image.so.com/i?ie=utf-8&src=se7_newtab_new',
                default_url: 'http://image.so.com/?src=se7_newtab_new',
                key: 'q',
                params: {
                    ie: 'utf-8',
                    src: 'se7_newtab_new'
                }
            },
            image_baidu: {
                type: 'image_baidu',
                desc: '百度',
                url: 'http://image.baidu.com/i?&ie=utf-8',
                key: 'word',
                params: {
                    ie: 'utf-8'
                }
            },
            image_google: {
                type: 'image_google',
                desc: '谷歌',
                url: 'http://images.google.com.hk/images?client=aff-cs-360se&ie=UTF-8',
                key: 'q',
                params: {
                    client: 'aff-cs-360se',
                    ie: 'UTF-8'
                }
            },

            music_so: {
                type: 'music_so',
                desc: '360搜索',
                url: 'http://s.music.so.com/s?ie=utf-8&src=se7_newtab_new',
                default_url: 'http://music.so.com/?src=se7_newtab_new',
                key: 'q',
                params: {
                    ie: 'utf-8',
                    src: 'se7_newtab_new'
                }
            },
            music_baidu: {
                type: 'music_baidu',
                desc: '百度',
                url: 'http://music.baidu.com/search?&ie=utf-8',
                key: 'key',
                params: {
                    ie: 'utf-8'
                }
            },
            music_sogou: {
                type: 'music_sogou',
                desc: '搜狗',
                url: 'http://mp3.sogou.com/music?ie=UTF-8',
                key: 'query',
                params: {
                    ie: 'UTF-8'
                }
            },

            map_so: {
                type: 'map_so',
                desc: '360搜索',
                url: 'http://map.so.com/?ie=utf-8&t=map&src=se7_newtab_new',
                default_url: 'http://map.so.com/?src=se7_newtab_new',
                key: 'k',
                params: {
                    ie: 'utf-8',
                    t: 'map',
                    src: 'se7_newtab_new'
                }
            },
            map_baidu: {
                type: 'map_baidu',
                desc: '百度',
                url: 'http://map.baidu.com/m?&ie=utf-8',
                key: 'word',
                params: {
                    ie: 'utf-8'
                }
            },
            map_google: {
                type: 'map_google',
                desc: '谷歌',
                url: 'http://ditu.google.cn/maps?client=aff-cs-360se&ie=UTF-8',
                key: 'q',
                params: {
                    client: 'aff-cs-360se',
                    ie: 'UTF-8'
                }
            },

            wenda_so: {
                type: 'wenda_so',
                desc: '360问答',
                url: 'http://wenda.so.com/search/?ie=utf-8&src=se7_newtab_new',
                default_url: 'http://wenda.so.com/?src=se7_newtab_new',
                key: 'q',
                params: {
                    ie: 'utf-8',
                    src: 'se7_newtab_new'
                }
            },
            wenda_baidu: {
                type: 'wenda_baidu',
                desc: '百度',
                url: 'http://zhidao.baidu.com/search?&ie=utf-8',
                key: 'word',
                params: {
                    ie: 'utf-8'
                }
            },

        };

        var searchTypeMaps = {
            webpage: ['so', 'google', 'baidu'],
            news: ['news_so', 'news_google', 'news_baidu'],
            video: ['video_so', 'video_google', 'video_baidu'],
            image: ['image_so', 'image_google', 'image_baidu'],
            music: ['music_so', 'music_sogou', 'music_baidu'],
            map: ['map_so', 'map_google', 'map_baidu'],
            wenda: ['wenda_so', 'wenda_baidu']
        };

        function setSearchType(type) {
            $('.search-cat > a').removeClass('on').filter('[cat-name=' + type + ']').addClass('on');
            var engines = searchTypeMaps[type];
            if (engines) {
                $('.search-menu').empty();
                engines.forEach(function (sn) {
                    var item = searchMaps[sn] || {};
                    $('.search-menu').append('<li><a __href="#" class="' + item.type + '"></a>' + item.desc + '</li>');
                });
                var jitem = $('.search-menu .' + storage.get('default_engine')[type]);
                if (jitem.length == 0) {
                    jitem = $('.search-menu a:first');
                }
                jitem.trigger('click');

                saveSetting('search_type', 'setSearchType("' + type + '")');

                return true;
            }
            return false
        }

        $('.search-cat > a').live('click', function () {
            setSearchType($(this).attr('cat-name'));
        });

        $('.search-menu li').live('click', function (e) {
            var searchItem;
            if (searchItem = searchMaps[e.target.className] || searchMaps[e.target.firstElementChild.className]) {
                setSearch(searchItem);

                if ($('.search-menu').is(':visible')) {
                    $('.search-menu').slideUp(function () {
                        $(this).removeClass('open');
                        if ($('#search-kw').val() == '') {
                            ScreenShot.capture('SearchEngineChanged');
                        } else {
                            ScreenShot.capture('delete');
                        }
                    });

                    saveSetting('search', 'setSearch(' + JSON.stringify(searchItem) + ');');
                    storage.set('default_engine', $('.search-cat .on').attr('cat-name'), searchItem.type);
                }
            }
        });

        //PlaceHolder.create($('#search-kw, .placeholder'));

        $('#search-form').live('submit', function () {
            var input = $('#search-kw');
            if (input.hasClass('input-txt-place')) {
                input.val('');
            }
            Stat.searchPV();
            var default_url = $('#search-form').attr('default-url');
            if (input.val() == '' && default_url) {
                //location = default_url;
                openUrl(default_url);
                return false;
            }
            openFormUrl(this);
            return false;
        });
        $('#search-form')[0].submit = function () {
            openFormUrl(this);
        };

        $(document).on('click', function (e) {
            if (e.target.id != 'search-switch' && !$(e.target).parents('#search-switch').length && !$(e.target).parents('.search-menu').length) {
                setTimeout(function () {
                    var searchMenu = $('.search-menu');
                    if (!searchMenu.hasClass('is-sliding')) {
                        searchMenu.slideUp({
                            duration: 100
                        }, function () {
                            $(this).removeClass('open');
                        });
                    }
                }, 10);
            }
        });

        $('#search-kw').autocomplete('https://sug.so.360.cn/suggest?encodein=utf-8&encodeout=utf-8', {
            zhida: true,
            selectFirst: false,
            type: 'jsonp',
            dataType: 'jsonp',
            scrollHeight: 300,
            offset: {
                left: -1,
                top: 0
            },
            onbeforeshow: function (callback) {
                var searchMenu = $('.search-menu');
                searchMenu.hide();
                callback && callback();
                return true;
            },
            parse: function (data) {
                var parsed = [];
                data.s.forEach(function (v) {
                    parsed.push({
                        data: [v],
                        value: v,
                        result: v
                    });
                });
                return parsed;
            }
        }).on('result', function (e, data) {
            Stat.searchPV();
            if (data.link) {
                //location = data.link;
                openUrl(data.link);
                return;
            }
            var $searchForm = $(this).parents('form');
            $searchForm.find(':hidden[name="src"]').val(
                    $('.ac_results:first').hasClass('hot-keyword') ? 'se7_newtab_new_hot' : 'se7_newtab_new'
            );
            $searchForm[0].submit();
        });
        $(window).on('newpages:firstPageOnLoad', function () {
            HotKeyword.init($('#search-kw'));
        });

        window.wrapResize = wrapResize;

        function wrapResize(animate, callback) {
            console.log('wrapResize:', +new Date - st + 'ms(距页面打开)');

            function getScale(scale) {
                if (scale == 1) {
                    return 'none';
                }
                return 'scale(' + Math.max(scale, 0) + ')';
            }

            var nav_height = 35;
            var max_width = 1200,
                    min_width = 700;
            var w = document.body.clientWidth;
            var gridW = Math.floor(w * .75);
            gridW = Math.min(gridW, max_width);
            var gridH = Math.floor(gridW * 672 / 1480);
            var areaHeight = window.innerHeight - nav_height - 30 - 85 - 60;
            if (gridH > areaHeight) {
                gridH = areaHeight;
                gridW = Math.max(Math.floor(gridH * 1480 / 672), Math.min(min_width, gridW));
                gridH = Math.floor(gridW * 672 / 1480);
            }
            $('.grid').width(gridW);
            $('.gridh').height(gridH);

            var fullscreenW = gridW;
            var fullscreenH = Math.floor(Math.min(fullscreenW, 1200) * 853 / 1200);
            var fullscreenAreaHeight = window.innerHeight - nav_height - 15 * 2;
            if (fullscreenH > fullscreenAreaHeight) {
                fullscreenH = fullscreenAreaHeight;
                fullscreenW = Math.max(Math.floor(fullscreenH * 1200 / 853), Math.min(min_width, gridW));
            }
            var fullscreenTop = Math.max((window.innerHeight - nav_height) / 2 - fullscreenH / 2, 8);
            $('.fullscreen').css({
                width: fullscreenW,
                height: fullscreenH
            });
            $('#page-video, #page-huajiao').css({
                'padding-top': fullscreenTop
            });

            var pageList = $('.page-list');
            setTimeout(function () {
                pageList.height(Math.max(Math.max(document.body.offsetHeight, $('.fullscreen').outerHeight()) - pageList[0].offsetTop, gridH + 70));
                $('.wrap').css({
                    height: 'auto'
                });
            });

            var ntpBody = $('.ntp-body')[0];
            $('.sliders_right').css({
                right: ntpBody.scrollHeight > ntpBody.clientHeight ? 8 : 0
            });

            var scale = gridW / max_width;
            if (scale > .9) {
                $('.np-news').css({
                    fontSize: 16
                });
                $('.np-news-center ul li').css({
                    lineHeight: 2.15
                });
                $('.np-news-center h2').css({
                    fontSize: 24
                });
                $('.np-news .dotline').css({
                    borderWidth: '1px'
                });
                $('.np-news-right h3').css({
                    fontWeight: 'normal'
                });
                $('.np-news-right .keywords li').css({
                    lineHeight: 1.68
                });
            } else {
                $('.np-news').css({
                    fontSize: 20
                });
                $('.np-news-center ul li').css({
                    lineHeight: 1.7
                });
                $('.np-news-center h2').css({
                    fontSize: 25
                });
                $('.np-news .dotline').css({
                    borderWidth: '2px'
                });
                $('.np-news-right h3').css({
                    fontWeight: 'bold'
                });
                $('.np-news-right .keywords li').css({
                    lineHeight: 1.4
                });
            }
            var fontsize = Math.round(12 / Math.max(scale, 0.6366666666666667));
            $('.np-news-left .img, .np-news-right .img').css({
                fontSize: fontsize
            });

            $('.scale-box').css({
                '-webkit-transform': getScale(scale),
                left: Math.min((w - 1250) / 2, 0),
                top: -(1 - scale) * 545 / 2
            });
            $('.scale-box .rev-scale').css({
                '-webkit-transform': getScale(1 / scale)
            });


            if (gridW > 1000) {
                $('.page>.grid, .ntp-body').removeClass('w1024 w1440 __scale').addClass('w1440');
                $('.page>.grid').css({
                    '-webkit-transform': 'none',
                    left: 0,
                    top: 0
                });
            } else if (gridW > 730) {
                $('.page>.grid, .ntp-body').removeClass('w1024 w1440 __scale').addClass('w1024');
                $('.page>.grid').css({
                    '-webkit-transform': 'none',
                    left: 0,
                    top: 0
                });
            } else {
                var w1024 = Math.floor(1010 * .75),
                        h1024 = w1024 * 672 / 1480,
                        vh1024 = w1024 * 853 / 1200,
                        scale2 = gridW / w1024;
                $('.page>.grid, .ntp-body').removeClass('w1024 w1440').addClass('w1024 __scale');
                $('.page>.grid.scale').css({
                    width: w1024,
                    height: h1024,
                    '-webkit-transform': getScale(scale2),
                    left: Math.min((w - w1024) / 2, 0),
                    top: -(1 - scale2) * h1024 / 2
                });
                var scale_fullscreen = fullscreenW / 784;
                $('.page>.fullscreen.scale').css({
                    width: 784,
                    height: vh1024,
                    left: Math.min((w - 784) / 2, 0),
                    top: -(1 - scale_fullscreen) * vh1024 / 2,
                    '-webkit-transform': getScale(scale_fullscreen)
                });
            }


            /*fix right white line start*/
            $('.tile .box').width('auto');
            setTimeout(function () {
                $('.tile .box').width($('.tile .box').width());
            }, 0);
            /*end*/

            $('.tile .box, .box img').css('height', imgHeight = Math.floor($('.tile .box').width() * 0.6054));

            var top = Math.max(window.innerHeight / 2 - ($('#search-form').height() + gridH + 120) / 2, 30);
            $('#search-form').css({
                'margin-top': top
            });

            if (!isDraging) { // 拖拽时重新定位会打破拖拽定位逻辑
                positionTiles();
            }

            //console.log('wrapResize End:', + new Date - st + 'ms(距页面打开)');
            return arguments.callee;
        }

        $(window).on('resize', wrapResize);

        function positionTiles(start, end, offset) {
            var tile = $('.mosts .tile:not(draging):first');
            if (tile.length == 0) {
                return;
            }
            var size = {
                w: tile.outerWidth(),
                h: tile.outerHeight()
            };
            var tiles = $('.mosts .tile');
            tiles.each(function (i) {
                if (i >= start && i <= end) {
                    i += offset;
                }
                var $this = $(this);
                if (!$this.hasClass('draging')) {
                    $this.css({
                        left: (i % 4) * size.w,
                        top: Math.floor(i / 4) * size.h
                    });
                }
            })
        }

        /****************************
         * PageSlider
         **************************/
        window.PageSlider = {
            current: -1,
            $el: $('.page-list'),
            pageList: $('.page-list'),
            sliders: $('.sliders-nav>.sliders'),
            configs: {
                ANIMATE_EASING: '',
                ANIMATE_TIMES: 400,
                PAGES_TITLE: {
                    mosts: '最常访问',
                    customs: '我的网址',
                    video: '热播影视',
                    news: '今日头条',
                    musics: '音乐精选',
                    games: '游戏中心',
                    shopping: '精品购物',
                    huajiao: '花椒直播'
                }
            },
            init: function () {
                this.bindManager();
                this.buildPageList();
                //$('.ntp-body').css('visibility', 'visible'); // SE5导入确定后再显示
                this.bindNav();
                this.bindWheel();
            },
            addPage: function (pageId, beforeId) {
                if ($('#page-' + pageId).length > 0) {
                    return;
                }
                this._addPage(pageId, beforeId, $('#page-list-' + pageId).html(), '<a class="' + pageId + '"><i></i>' + (this.configs.PAGES_TITLE[pageId] || ''));
                $('.ntp-body').removeClass('nopage nopage-animate');
                wrapResize();
                $(window).trigger('resize'); // 引发各自分屏resize
            },
            removePage: function (pageId) {
                var _this = this;
                var page = $('#page-' + pageId);
                page.remove();
                if (pageId == 'customs') {
                    TipsManager.hideCustomsStartupNow();
                }
                //$('.sliders > a.' + pageId).remove();
                var cur = $('.sliders > a.' + pageId);
                cur.stop(true, true).animate({
                    top: 37,
                    opacity: 0
                }, 180, '', function () {
                    var index = cur.index();
                    var offset = $(this).width() / 2;
                    var nav = $('.sliders > a, .sliders-nav .page-manager'),
                            left = nav.slice(0, index),
                            right = nav.slice(index + 1);

                    $(this).remove();

                    left.css({
                        left: -offset
                    }).animate({
                        left: 0
                    }, 100, '');
                    right.css({
                        left: offset
                    }).animate({
                        left: 0
                    }, 100, '');

                    if (page.hasClass('current')) {
                        if (_this.current <= 0) {
                            _this.slideTo(_this.current, true, true, true);
                        } else {
                            _this.slideTo(_this.current - 1, true, true, true);
                        }
                    } else {
                        // 重置slider状态，包括slider_left right 隐藏、显示
                        _this.slideTo($('.sliders > a.selected').index(), false);
                    }
                });

                if ($('.page-list>.page').length == 0) {
                    PageSlider.animating = false;
                    // 变换PageManager Button
                    $('.ntp-body').addClass('nopage-animate');
                    ScreenShot.capture('PageChanged');
                }
            },
            sortPage: function (pageId, beforeId) {
                var page = $('#page-' + pageId);
                if ((page.prev().attr('id') || '').replace(/page-/, '') != beforeId &&
                        pageId != beforeId) {
                    this._addPage(pageId, beforeId, page, $('.sliders > a.' + pageId));
                }
            },
            swapPage: function (pageId, swapId) {
                var _this = this;
                $('#page-' + pageId).swap($('#page-' + swapId));
                var cur = $('.sliders > a.' + pageId),
                        swap = $('.sliders > a.' + swapId);
                if (cur.length == 0 || swap.length == 0) {
                    return;
                }
                var curLeft = cur.offset().left,
                        swapLeft = swap.offset().left;
                cur.animate({
                    left: swapLeft - curLeft
                }, 200, '');
                swap.animate({
                    left: curLeft - swapLeft
                }, 200, '', function () {
                    cur.swap(swap);
                    cur.add(swap).css({
                        left: 0
                    });
                    _this.slideTo($('.sliders > a.selected').index(), false);
                });
            },
            _addPage: function (pageId, beforeId, page, nav) {
                var before = $('#page-' + beforeId);
                if (before.length) {
                    before.after(page);
                    $('.sliders > a.' + beforeId).after(nav);
                } else {
                    this.pageList.prepend(page);
                    this.sliders.prepend(nav);
                }

                var cur = $('.sliders > a.' + pageId),
                        index = cur.index(),
                        offset = cur.width() / 2;
                var nav = $('.sliders > a, .sliders-nav .page-manager'),
                        left = nav.slice(0, index),
                        right = nav.slice(index + 1);
                cur.css({
                    opacity: 0,
                    top: 37
                });
                left.css({
                    left: offset
                }).animate({
                    left: 0
                }, 180, '');
                right.css({
                    left: -offset
                }).animate({
                    left: 0
                }, 180, '', function () {
                    cur.animate({
                        opacity: 1,
                        top: 0
                    }, 100, '', function () {
                        $(window).trigger('resize');
                    });
                });

                var current = $('.sliders > a.selected').index();
                this.slideTo(current < 0 ? 0 : current, current < 0, true, true);

                switch (pageId) {
                    case 'video':
                        VideosPage.initialize(true, true);
                        break;
                    case 'news':
                        NewsPage.initialize(true, true);
                        break;
                    case 'games':
                        GamesPage.initialize(true, true);
                        break;
                    case 'musics':
                        MusicPage.initialize(true, true);
                        break;
                    case 'shopping':
                        ShoppingPage.initialize(true, true);
                        break;
                    case 'huajiao':
                        HuajiaoPage.initialize(true, true);
                        break;
                    case 'mosts':
                        renderMostVisitedData(true);
                        break;
                    case 'customs':
                        renderCustomsData(true);
                        break;
                }
                TipsManager.showNavigateNew();
            },
            defaultPageFromUrl: function () {
                return location.pathname.substr(1);
            },
            buildPageList: function () {
                var _this = this;
                this.pageList.empty();
                this.sliders.empty();
                var list = [];
                pageManager.getPageList().forEach(function (item) {
                    if (item.selected == 'selected' || _this.defaultPageFromUrl() == item.pageId) {
                        list.push(item.pageId);
                        if (item.selected != 'selected' && _this.defaultPageFromUrl() == item.pageId) {
                            pageManager.editPage(item.pageId, 'selected', 'selected');
                        }
                    }
                });
                if (list.length == 0) {
                    $('.ntp-body').addClass('nopage');
                    ScreenShot.hideAndCapture('EmptyPage-Rendered', true);
                    return;
                }
                TipsManager.hideNavPageManagerMask(true);
                $('.ntp-body').removeClass('nopage');
                var _this = this;
                list.forEach(function (pageId) {
                    var title = _this.configs.PAGES_TITLE[pageId];
                    if (title) {
                        _this.pageList.append($('#page-list-' + pageId).html());
                        _this.sliders.append('<a class="' + pageId + '"><i></i>' + title);
                    } else {
                        storage.set('sliders', 'default', 0);
                        pageManager.removePage(pageId);
                        storage.set('__tips_manager', pageId + '-new', false);
                    }
                });
                $(window).trigger('resize');
                this.initSlide();
                var pageArr = [];
                list.forEach(function (pageId, i) {
                    var title = _this.configs.PAGES_TITLE[pageId];
                    if (title) {
                        switch (pageId) {
                            case 'video':
                                VideosPage.initialize(i == _this.getSlideIndex());
                                pageArr.push('360kan');
                                break;
                            case 'huajiao':
                                HuajiaoPage.initialize(i == _this.getSlideIndex());
                                break;
                            case 'news':
                                NewsPage.initialize(i == _this.getSlideIndex());
                                pageArr.push('news8');
                                break;
                            case 'games':
                                GamesPage.initialize(i == _this.getSlideIndex());
                                // pageArr.push('newgame');
                                break;
                            case 'musics':
                                MusicPage.initialize(i == _this.getSlideIndex());
                                pageArr.push('newmusic');
                                break;
                            case 'shopping':
                                ShoppingPage.initialize(i == _this.getSlideIndex());
                                pageArr.push('newmall3');
                                break;
                            case 'mosts':
                                delayRenderGrid(pageId, i == _this.getSlideIndex());
                                _this.hasMostsPage = true;
                                break;
                            case 'customs':
                                delayRenderGrid(pageId, i == _this.getSlideIndex());
                                break;
                        }
                    }
                });
                TipsManager.showNavigateNew();
                PageDataSource.load(pageArr);
            },
            getSlideIndex: function () {
                var defaultPageId = this.defaultPageFromUrl();
                if (defaultPageId) {
                    var idx = this.sliders.find('a.' + defaultPageId).index();
                    if (idx > -1) {
                        storage.set('sliders', 'default', idx);
                        return idx;
                    }
                }
                var deft = storage.get('sliders')['default'];
                var index = parseInt(deft);
                if (isNaN(index)) {
                    index = {
                        mosts: 0,
                        customs: 1
                    }[deft];
                    if (index == undefined) {
                        index = loadTimeData.data['VideoMode'] ? 1 : 0;
                    }
                }
                return index;
            },
            initSlide: function () {
                this.slideTo(this.getSlideIndex(), false);
                $(window).on('resize', function () {
                    PageSlider.slideTo(PageSlider.current, false, false);
                });
            },
            bindManager: function () {
                CETH.on(pageManager, 'addPage', function (e) {
                    PageSlider.addPage(e.cur.pageId, e.prev ? e.prev.pageId : '');
                });
                CETH.on(pageManager, 'removePage', function (e) {
                    PageSlider.removePage(e.pageId);
                });
                CETH.on(pageManager, 'swapPage', function (e) {
                    var sortType, pageId;
                    if ($('#page-' + e.from.pageId).length > 0 ||
                            $('#page-' + e.to.pageId).length > 0) {
                        if ($('#page-' + e.from.pageId).length == 0) {
                            pageId = e.to.pageId;
                            sortType = 'insert';
                        } else if ($('#page-' + e.to.pageId).length == 0) {
                            pageId = e.from.pageId;
                            sortType = 'insert';
                        }
                    }
                    if (sortType == 'insert') {
                        PageSlider.sortPage(pageId, e.prev ? e.prev.pageId : '');
                    } else {
                        PageSlider.swapPage(e.from.pageId, e.to.pageId);
                    }
                });
            },
            bindNav: function () {
                TipsManager.showPageManagerTips();
                setTimeout(function () {
                    TipsManager.showNavPageManagerMask();
                }, 500);
                $('.page-manager').click('click', function (e) {
                    $('.setup-pop').removeClass('setup-pop-end');
                    pageManager.init();
                    TipsManager.hidePageManagerTips();
                    ScreenShot.capture('delete');
                });
                $('.sliders > a').live('mousedown', function (e) {
                    if (e.button == 0) {
                        PageSlider.slideTo($(this).index());
                        return false;
                    }
                });
                $('.sliders_left, .sliders_right').live('mousedown', function (e) {
                    if (e.button == 0) {
                        if ($(this).hasClass('sliders_left')) {
                            PageSlider.slidePrev();
                        } else {
                            PageSlider.slideNext();
                        }
                        return false;
                    }
                });
            },
            bindWheel: function () {
                function inDom(el) {
                    var selectors = [].slice.call(arguments, 1),
                            $el = $(el);
                    return selectors.some(function (selector) {
                        return $el.parents(selector).length || $el.is(selector);
                    });
                }

                var reWheel = 0
                WHEEL_PAGING_COUNT = 0;
                $(document).live('mousewheel', function (e) {
                    if (inDom(e.target, '.add-url', '.addurl-mask', '.setup-pop', '.customs-startup', '.customs-startup-mask', '.drag-helper', '.drag-proxy', '#page-manager', '#page-manager-mask', '.screen-mask-guide') ||
                            $('.page-list').children().length <= 1) {
                        return;
                    }
                    if (e.originalEvent.wheelDeltaY > 0) {
                        reWheel++;
                        if (reWheel > WHEEL_PAGING_COUNT) {
                            PageSlider.slidePrev();
                            reWheel = 0;
                        }
                    } else if (e.originalEvent.wheelDeltaY < 0) {
                        reWheel++;
                        if (reWheel > WHEEL_PAGING_COUNT) {
                            PageSlider.slideNext();
                            reWheel = 0;
                        }
                    } else {
                        reWheel = 0;
                    }
                    e.preventDefault();
                });
            },
            slideTo: function (index, animate, updateLocation, isManage) {
                // 注释掉，为了保持快速隐藏，同步
                if (!isManage && this.animating) {
                    // 上一个动画未结束，不执行新动画
                    return false;
                }
                if (animate !== false && !window.newpagesFirstPageOnLoad) {
                    return false;
                }
                var self = this;
                var slideStart = Date.now();
                var pages = $('.page');
                var realSlide = index >= 0 && index < pages.length;
                index = Math.max(index, 0);
                index = Math.min(index, pages.length - 1);
                if (index == self.current && animate !== true) {
                    // 缩放时，静默调整left
                    animate = false;
                } else {
                    // 隐藏suggestion框
                    $('#search-kw').blur();
                    // 隐藏搜索引擎列表框
                    $(document).trigger('click').trigger('mousedown');
                    // 隐藏天气详情
                    Weather.hideDetail();
                }
                if (updateLocation !== false) {
                    storage.set('sliders', 'default', index);
                }

                if (index == 0 || pages.length == 0) {
                    $('.sliders_left').removeClass('actived');
                } else {
                    $('.sliders_left').addClass('actived');
                    $('.mosts-drag-tips').remove();
                }
                if (index == pages.length - 1 || pages.length == 0) {
                    $('.sliders_right').removeClass('actived');
                } else {
                    $('.sliders_right').addClass('actived');
                }
                var current_nav = $('.sliders>a:eq(' + index + ')');
                TipsManager.hideNavigateNew(current_nav);
                $('.sliders > a').removeClass('selected').eq(index).addClass('selected');

                var w = document.body.offsetWidth,
                        left = pages.slice(0, index),
                        current = pages.slice(index, index + 1),
                        right = pages.slice(index + 1);
                pages.removeClass('current');
                current.addClass('current');
                if (current_nav.hasClass('video') || current_nav.hasClass('huajiao')) {
                    $(document.body).addClass('fullscreen-page');
                    if (document.body.clientWidth < 1900) {
                        Weather.hide();
                    } else {
                        Weather.show();
                    }
                } else {
                    $(document.body).removeClass('fullscreen-page');
                    Weather.show();
                }
                if (animate === false) {
                    this.current = index;
                    left.css({
                        left: -w
                    });
                    current.removeClass('hidden').css({
                        left: 0
                    });
                    right.css({
                        left: w
                    });
                    left.add(right).addClass('hidden');
                } else {
                    this.animating = true;
                    var prev = pages.slice(self.current, self.current + 1);
                    if (prev[0] != current[0]) {
                        prev.animate({
                            left: self.current > index ? w : -w
                        }, this.configs.ANIMATE_TIMES, this.configs.ANIMATE_EASING);
                    }
                    left.not(prev).css({
                        left: -w
                    });
                    current.removeClass('hidden').animate({
                        left: 0
                    }, this.configs.ANIMATE_TIMES, this.configs.ANIMATE_EASING, function () {
                        left.add(right).addClass('hidden');
                        current.removeClass('hidden');
                        ScreenShot.capture('PageChanged');
                        self.current = index;
                        // 管理面板操作，也出customs-startup
                        if (current_nav[0] /* && !isManage*/) {
                            var current_name = current_nav[0].className.replace(/\s.*?$/, '');
                            if (current_name != 'customs') {
                                TipsManager.hideCustomsStartupNow();
                            }
                            switch (current_name) {
                                case 'customs':
                                    TipsManager.showCustomsStartup(showAddUrl, addRecommondTiles);
                                    break;
                                case 'games':
                                    GamesPage.onSlideShow && GamesPage.onSlideShow();
                                    break;
                                case 'news':
                                    NewsPage.onSlideShow && NewsPage.onSlideShow();
                                    break;
                                case 'shopping':
                                    ShoppingPage.onSlideShow && ShoppingPage.onSlideShow();
                                    break;
                                case 'mosts':
                                    sendMostsShowedStat();
                                    break;
                            }
                            Stat.screenPV(current_name);
                        }
                        if ($.isFunction(animate)) {
                            animate();
                        }
                        self.animating = false;
                        console.log('### page slide duration: ' + (Date.now() - slideStart) / 1000 + 's');
                    });
                    right.not(prev).css({
                        left: w
                    });
                }
                return realSlide;
            },
            slidePrev: function () {
                return this.slideTo(this.current - 1);
            },
            slideNext: function () {
                return this.slideTo(this.current + 1);
            }
        };

        PageSlider.init();


        function saveGrid(type) {
            var tiles = parseGrid('.' + type + ' .tile');
            var mapKey = type + 'UrlMap';
            window[mapKey] = {};
            tiles.forEach(function (tile) {
                window[mapKey][tile.url] = tile;
            });

            var method = type == 'customs' ? 'setCustomData' : 'saveMostVisitedURLs';
            ntpApis[method](JSON.stringify(tiles), function () {
                setTimeout(function () {
                    $('.just-dragged').removeClass('just-dragged');
                });
            });

            ScreenShot.capture('DataChanged');
        }

        function parseGrid(sel) {
            var tiles = [];
            $(sel).each(function (i, tile) {
                var pinned_type = parseInt($('.link', tile).attr('pinned_type') || 1);
                tiles.push({
                    title: $('.tile-tit', tile).text() || '',
                    url: $('.link', tile).attr('href') || '',
                    pinned_type: isNaN(pinned_type) ? 1 : pinned_type
                });

            });
            return tiles;
        }

        $('.tile-add').live('mouseover', function () {
            $("img:eq(0)", this).hide();
            $("img:eq(1)", this).show();
        }).live('mouseleave', function () {
            $("img:eq(0)", this).show();
            $("img:eq(1)", this).hide();
        });
        //展现添加弹层
        function showAddUrl() {
            $('.add-url,.addurl-mask').show();
            AddUrlDlg.show();
        }

        //隐藏添加弹层
        function hideAddUrl(log) {
            $('.add-url,.addurl-mask').hide();
        }

        $('#js-addurl-cancel, .add-url-close').live('click', hideAddUrl);
        $(document).on('keydown', function (e) {
            switch (e.keyCode) {
                case 27:
                    hideAddUrl();
                    break;
            }
        });
        $(".tile .tile-add").live('click', function (e) {
            showAddUrl();
            $('#add-url-form input[type=text]').val('');
            var grid = $(this).parents('.grid');
            var type = 'customs';
            if (grid.hasClass('mosts')) {
                type = 'mosts';
            }
            $('#js-addurl-fortype').val(type);

            var curLi = $(this).parents('li')[0];
            [].slice.call(curLi.parentNode.children, 0).every(function (el, idx) {
                if (el == curLi) {
                    $('#js-addurl-foridx').val(idx);
                    return false;
                }
                return true;
            });

        });

        //设置
        $('.wallpaper .tab-conts>div:eq(0)').show();
        $(".change-wallpaper").click(function (e) {
            $('.setup-pop').toggleClass('setup-pop-end');
            return false;
        });
        $('.setup-pop').click(function (e) {
            e.stopPropagation();
        });
        $(".setup-cls").add(document).click(function () {
            $('.setup-pop').removeClass('setup-pop-end');
        });
        $('#search-kw,#search-hotword').mousedown(function (e) {
            if (!$(e.target).parents('.setup-pop').length && e.target.className != 'change-wallpaper') {
                if ($('.setup-pop').is(':visible')) {
                    $('.setup-pop').removeClass('setup-pop-end');
                }
            }
        });

        $('#js-addurl-url').live('blur', function (e) {
            if (this.value && !/^(https?):\/\//i.test(this.value)) {
                this.value = 'http://' + this.value;
            }
            this.value = this.value.replace(/\|/g, '%7c');
        });


        var url_tabs = $(".url-tab li");
        url_tabs.click(function () {
            $(this).addClass("cur").siblings().removeClass("cur");
            var index = url_tabs.index(this);
            $(".url-often > ul").eq(index).show().siblings().hide();
        });

        function changePinnedState(link, pinned) {
            link.attr('pinned_type', pinned);
            if (pinned == 1) {
                link.addClass('pinned');
            } else {
                link.removeClass('pinned');
            }
            link.find('.pin').attr('title', pinned == 1 ? '解锁' : '锁定');
        }

        $('.tile-tit > .pin').live('click', function () {
            var link = $(this).parents('.link');
            link.toggleClass('pinned');
            changePinnedState(link, link.hasClass('pinned') ? 1 : 0);
            saveGrid('mosts');
            return false;
        });
        $('.tile .remove').live('click', function (e) {
            var tile = $(this).parents('li.tile');
            removeTile(tile, ANIMATE_EFFECT);
            return false;
        });

        function removeTile(tile, animate) {
            tile = $(tile);
            tile.find('.box').addClass('empty');
            tile.find('.remove').hide();
            var logo = tile.find('.link .tile-logo');
            var grid = $(logo).parents('.grid');
            if (grid.hasClass('mosts')) {
                dontRefreshMosts = true;
            }
            if (animate) {
                logo.addClass('hide-tit').css({
                    position: 'absolute',
                    top: 0
                }).animate({
                    top: -logo.height()
                }, 400, '', complete);
            } else {
                complete.call(logo);
            }

            function complete() {
                var grid = $(this).parents('.grid');
                var tile = $(this).parents('.tile');
                var link = $(this).parent('.link');
                var url = link.attr('href');
                link.remove();
                if (grid.hasClass('mosts')) {
                    saveGrid('mosts');
                    ntpApis.blacklistURLFromMostVisited(url);
                } else {
                    saveGrid('customs');
                }
                dontRefreshMosts = false;
            }
        }

        window.removeTileByUrl = function (url) {
            var tile = $('.customs .link[href="' + url + '"]').parents('.tile');
            if (tile.length > 0) {
                removeTile(tile, ANIMATE_EFFECT);
            }
        }

        $('.js-auto-save').live('change', function () {

            if ($(this).attr('type') == 'checkbox') {
                saveSetting(this.id, '$("#' + this.id + '").attr("checked",' + this.checked + ')');
            } else {
                saveSetting([this.id], '$("#' + this.id + '").val("' + $(this).val() + '")');
            }
        });

        $('#add-url-form input[type=text]').live('keypress', function (e) {
            if (e.charCode == 13) {
                $('#js-addurl-url').trigger('blur');
                $('#add-url-form').trigger('submit');
            }
        });

        $('.url-often li').live('click', function (e) {
            $('#js-addurl-title').val($(this).text().trim());
            $('#js-addurl-url').val($('a', this).attr('href'));
            e.preventDefault();
        });
        $('.url-often li').live('dblclick', function (e) {
            $('#js-addurl-title').val($(this).text().trim());
            $('#js-addurl-url').val($('a', this).attr('href'));
            $('#js-addurl-confirm').trigger('click');
            e.preventDefault();
        });
        window.isOftenUrl = false;

        $('#add-url-form').live('submit', function (e) {
            e.preventDefault();
            var type = $('#js-addurl-fortype').val();
            if (type != 'mosts') {
                type = 'customs';
            }
            if ($('#js-addurl-foridx').val() == '') {
                var firstEmpty = $('.' + type + ' li.tile div.empty:first').parent().index();
                $('#js-addurl-foridx').val(Math.max(firstEmpty, 0));
            }

            var title = $('#js-addurl-title').val().trim(),
                    url = $('#js-addurl-url').val(),
                    idx = $('#js-addurl-foridx').val() - 0;
            if (!/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z|]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url)) {
                $('#js-addurl-url').focus();
                if (url) {
                    if ($('#js-addurl-url').next('label').length == 0) {
                        $('#js-addurl-url').after('<label for="js-addurl-url" generated="true" class="error" style="">网址输入有误，请确认后重试</label>');
                    } else {
                        $('#js-addurl-url').next('label').show();
                    }
                }
                return;
            }

            if (type == 'mosts') {
                dontRefreshMosts = true;
            }
            var isOU = window.isOftenUrl;
            window.isOftenUrl = false;
            var item;
            if (type == 'mosts') {
                try {
                    $('.mosts .tile a.link').each(function () {
                        var _url = this.href;
                        _url = _url.replace(/https?:\/\//i, '');
                        _url = _url.replace(/\/$/i, '');
                        var _addurl = url;
                        _addurl = _addurl.replace(/https?:\/\//i, '');
                        _addurl = _addurl.replace(/\/$/i, '');
                        if (_addurl == _url) {
                            item = $(this).parents('.tile');
                            return false;
                        }
                    });
                } catch (e) {
                }
            }
            if (!item) {
                item = $('.' + type + ' .tile:eq(' + idx + ')');
            }
            var addUrlImg = null;
            var imgUrl = '';
            //推荐的tile，展现动画
            if (isOU) {
                var img = $('.logo-list li[url="' + url + '"] img');
                imgUrl = img.attr('src');
                var offset = img.offset();
                var targetOffset = item.children().offset();
                addUrlImg = $('<img src="' + imgUrl + '"/>').css({
                    width: 135,
                    height: 95,
                    position: 'absolute',
                    top: offset.top,
                    left: offset.left,
                    zIndex: 100000
                }).addClass('add-url-img').attr('url', url).appendTo(document.body).animate({
                    width: item.width() - 1,
                    height: item.height(),
                    top: targetOffset.top,
                    left: targetOffset.left
                }, 500, '', function () {
                    setTimeout(function () {
                        addUrlImg.remove();
                    }, 0);
                });
                window.animateAddUrl = url;
            }
            ;
            setTimeout(function () {
                var el = item.html($(tileTmplFn({
                    title: title || url,
                    short_url: url.shorting(50),
                    url: url
                })).html()) /*.fadeIn()*/.find('.box').css('height', imgHeight);
                if (isOU && imgUrl) {
                    el.find('.tile-logo img').attr('src', imgUrl)
                } else {
                    el.find('.tile-logo img').attr('src', 'images/loading.gif')
                }

                if (!isOU) {
                    onSnapshotAnimUrl = url;
                }
                ;

                wrapResize();
                saveGrid(type);
                dontRefreshMosts = false;

                ntpApis.captureWebpage(url, function (args) {
                    if (window.animateAddUrl == args[0]) {
                        window.animateAddUrl = args[1];
                    }
                    clearTimeout(window['capture_timeout_' + args[0]]);
                    //if (!isOU)
                    {
                        window['capture_timeout_' + args[1]] = setTimeout(function () {
                            window.onSnapshotComplete([{
                                url: args[1]
                            }]);
                        }, CAPTURE_TIMEOUT);
                    }
                    $('.tile a[href="' + args[0] + '"]').attr('href', args[1]);
                    //saveGrid(type);
                });
                //if (!isOU)
                {
                    window['capture_timeout_' + url] = setTimeout(function () {
                        window.onSnapshotComplete([{
                            url: url
                        }]);
                    }, CAPTURE_TIMEOUT);
                }
            }, 500)
            hideAddUrl('from save');
        });

        window.importDataCaptureCount = 0;
        var onSnapshotAnimUrl = '';
        window.onSnapshotComplete = function (args) {
            console.log('onSnapshotComplete被调用', arguments);
            importDataCaptureCount--;
            args = args || [];
            var item = args[0] || {},
                    url = item.url;
            clearTimeout(window['capture_timeout_' + url]);
            if (url) {
                var query = '.tile a[href^="' + url + '"] img[src="images/loading.gif"]',
                        img = $(query);
                if (img.length <= 0) {
                    query = '.tile a[href^="' + url + '"] img';
                    img = $(query);
                }
                if (img.length > 0) {
                    var src = img.attr('src');
                    if (src == 'images/loading.gif' || src == '' || importDataCaptureCount >= 0 || window.animateAddUrl != url) {
                        img.attr('src', 'chrome://thumb/' + url);
                        onSnapshotAnimUrl = onSnapshotAnimUrl.replace(/\/$/, '');
                        url = url.replace(/\/$/, '');
                        onSnapshotAnimUrl = '';
                        var box = img.parents('.box');
                        switch (item.thumbnail_type) {
                            case 300:
                            case 400:
                                box.removeClass('snapshot');
                                break;
                            default:
                                box.addClass('snapshot');
                                break;
                        }
                        img.parents('.tile-logo').css('top', -parseInt(imgHeight)).animate({
                            top: 0
                        }, 500, function () {
                            ScreenShot.capture('DataChanged');
                        });
                        window.animateAddUrl = null;
                    }
                }
            }
        };

        (function (undef) {

            var DELAY_DRAG_OFFSET = 2;
            var DURATION = 300;

            function getDragRects(selector) {
                var dragRects = [];
                $(selector).each(function (index, item) {
                    var jItem = $(item),
                            offset = jItem.offset();
                    dragRects.push(item.rect = {
                        index: index,
                        drag: item,
                        left: offset.left,
                        top: offset.top,
                        right: offset.left + jItem.outerWidth(),
                        bottom: offset.top + jItem.outerHeight()
                    });
                });
                return dragRects;
            }

            var dragObj, rects, startX, startY, boxX, boxY, dragHelper, passDrag, sx, sy, cx, cy, downObj, dragStart, isMostVisited, dragIndex, newDragIndex;
            $('.tile .box').live('mousedown', function (e) {
                if (e.altKey) {
                    return false;
                }
                isMostVisited = $('#page-mosts').is('.current');
                sx = e.clientX,
                        sy = e.clientY;
                dragStart = true;
                downObj = $(this).parent('.tile')[0]; //this.parentNode.parentNode;
                $(downObj).parent().addClass('animating');
                isDraging = true;
                if (isMostVisited) {
                    dontRefreshMosts = true;
                }
                $(document).on('mousemove', mousemove);
                return false;
            });

            $(document).delegate('', 'mouseup', function (e) {
                $(document).off('mousemove', mousemove);
                dragStart = false;
                setTimeout(function () {
                    isDraging = dontRefreshMosts = false;
                    $(downObj).parent().removeClass('animating');
                }, DURATION);
                if (dragObj) {
                    if (Math.max(Math.abs(cx - sx), Math.abs(cy - sy)) > DELAY_DRAG_OFFSET) {
                        e.preventDefault();
                    }
                    if (passDrag && !isMostVisited) {
                        $(passDrag).removeClass('pass-drag pass-drag-left pass-drag-top pass-drag-right pass-drag-bottom');
                        $(passDrag).addClass('just-dragged');
                        $(dragHelper).animate({
                            left: passDrag.rect.left + 'px',
                            top: passDrag.rect.top + 'px'
                        }, DURATION, function (dragObj) {
                            return function () {
                                if (!passDrag) {
                                    return false;
                                }
                                ;
                                if (!dragHelper) {
                                    dragHelper = $('.drag-helper');
                                }
                                ;
                                dragObj.innerHTML = dragSwitcher.innerHTML;
                                $(dragObj).css('opacity', 1).removeClass('draging');
                                passDrag.innerHTML = dragHelper.innerHTML;
                                $(passDrag).css('opacity', 1);
                                document.body.removeChild(dragHelper);
                                document.body.removeChild(dragSwitcher);
                                dragHelper = null;

                                saveGrid('customs');
                            };
                        }(dragObj));


                        var dragSwitcher = document.createElement('div');
                        dragSwitcher.innerHTML = passDrag.innerHTML;
                        $(passDrag).css('opacity', 0);


                        document.body.appendChild(dragSwitcher);
                        $(dragSwitcher).addClass('drag-switcher').css({
                            width: $(passDrag).width() + 'px',
                            height: $(passDrag).height() + 'px',
                            left: $(passDrag).offset().left + 'px',
                            top: $(passDrag).offset().top + 'px'
                        }).animate({
                            left: $(dragObj).offset().left + 'px',
                            top: $(dragObj).offset().top + 'px'
                        }, DURATION);

                    } else {
                        var $dragObj = $(dragObj),
                                pos = $dragObj.offset(),
                                mostMoved = isMostVisited && passDrag,
                                tilePos;
                        if (mostMoved) {
                            var size = {
                                w: $dragObj.outerWidth(),
                                h: $dragObj.outerHeight()
                            };
                            tilePos = {
                                left: (newDragIndex % 4) * size.w,
                                top: Math.floor(newDragIndex / 4) * size.h
                            };
                            var poffset = $dragObj.parent().offset();
                            pos = {
                                left: poffset.left + tilePos.left,
                                top: poffset.top + tilePos.top
                            };

                            var start = Math.min(dragIndex, newDragIndex),
                                    end = Math.max(dragIndex, newDragIndex);
                            positionTiles(start, end, newDragIndex > dragIndex ? -1 : 1);
                        }
                        $(dragHelper).removeClass('drag-helper-disabled');
                        $(dragHelper).animate(pos, DURATION, function (dragObj) {
                            return function () {
                                if (mostMoved) {
                                    changePinnedState($dragObj.css(tilePos).find('.link'), 1)
                                    var before = newDragIndex > dragIndex ? newDragIndex : newDragIndex - 1;
                                    if (before < 0) {
                                        $dragObj.parent().prepend($dragObj);
                                    } else {
                                        $('.mosts .tile:eq(' + before + ')').after($dragObj);
                                    }
                                    saveGrid('mosts');
                                }
                                $dragObj.css('opacity', 1).removeClass('draging');
                                document.body.removeChild(dragHelper);
                                dragHelper = null;
                            };
                        }(dragObj));
                    }
                    dragObj = null;
                }
            });

            function mousemove(e) {
                cx = e.clientX;
                cy = e.clientY;

                if (!dragObj) {
                    if (!dragStart) {
                        return false;
                    }
                    if (e.button) { //only left-mousebutton
                        return false;
                    }

                    if (Math.max(Math.abs(cx - sx), Math.abs(cy - sy)) < DELAY_DRAG_OFFSET) {
                        return false;
                    }

                    if (dragHelper) {
                        //$(dragHelper).stop(true, true);
                        dragStart = false;
                        return false;
                    }
                    var self = downObj,
                            jSelf = $(self);

                    rects = getDragRects('.' + (isMostVisited ? 'mosts' : 'customs') + ' .tile'); //get all dragbox rectangle
                    dragObj = self;

                    startX = e.pageX;
                    startY = e.pageY;

                    boxX = jSelf.offset().left - startX;
                    boxY = jSelf.offset().top - startY;

                    //$(dragObj).find('.tile-logo').stop(true, true);
                    dragHelper = document.createElement('div');
                    dragHelper.innerHTML = dragObj.innerHTML;
                    $(dragObj).css('opacity', 0).addClass('draging');
                    dragIndex = $(dragObj).index();
                    $(dragHelper).addClass('drag-helper').css({
                        width: jSelf.width() + 'px',
                        height: jSelf.height() + 'px',
                        left: jSelf.offset().left + 'px',
                        top: jSelf.offset().top + 'px'
                    });
                    if (jSelf.hasClass('ui-state-disabled')) {
                        $(dragHelper).addClass('drag-helper-disabled');
                        TipsManager.showMostsDragTips();
                    }
                    document.body.appendChild(dragHelper);
                } else {
                    var deltaX = e.pageX - startX,
                            deltaY = e.pageY - startY,
                            newPosX = startX + deltaX + boxX,
                            newPosY = startY + deltaY + boxY;

                    $(dragHelper).css({
                        left: newPosX + 'px',
                        top: newPosY + 'px'
                    });

                    var hitDrag;
                    rects.every(function (rect) { //拿到当前mousemove命中到的元素
                        if (e.pageX > rect.left && e.pageX < rect.right) {
                            if (e.pageY > rect.top && e.pageY < rect.bottom) {
                                if (rect.drag !== dragObj) {
                                    hitDrag = rect.drag;
                                }
                                return false;
                            }
                        }
                        return true;
                    });

                    if (hitDrag !== passDrag) {

                        if (passDrag) {
                            $(passDrag).removeClass('pass-drag').removeClass('pass-drag-left').removeClass('pass-drag-top').removeClass('pass-drag-right').removeClass('pass-drag-bottom');
                        }

                        passDrag = hitDrag;

                        if (isMostVisited) {
                            newDragIndex = passDrag ? $(passDrag).index() : dragIndex;
                            var start = Math.min(dragIndex, newDragIndex),
                                    end = Math.max(dragIndex, newDragIndex);
                            positionTiles(start, end, newDragIndex > dragIndex ? -1 : 1);
                            return false;
                        } // else


                        if (!passDrag) {
                            return false;
                        }

                        var dragRect = {
                                    left: $(dragObj).offset().left,
                                    top: $(dragObj).offset().top,
                                    right: $(dragObj).offset().left + $(dragObj).width(),
                                    bottom: $(dragObj).offset().top + $(dragObj).height()
                                },
                                passRect = {
                                    left: $(passDrag).offset().left,
                                    top: $(passDrag).offset().top,
                                    right: $(passDrag).offset().left + $(passDrag).width(),
                                    bottom: $(passDrag).offset().top + $(passDrag).height()
                                };

                        $(passDrag).addClass('pass-drag');

                        if (passRect.left > dragRect.left) {
                            $(passDrag).addClass('pass-drag-left');
                        } else if (passRect.left < dragRect.left) {
                            $(passDrag).addClass('pass-drag-right');
                        }

                        if (passRect.top > dragRect.top) {
                            $(passDrag).addClass('pass-drag-top');
                        } else if (passRect.top < dragRect.top) {
                            $(passDrag).addClass('pass-drag-bottom');
                        }

                    }
                }
            }

        })();

        $('.ipt input').on('focus', function () {
            $(this).parents('.search').addClass('focus');
        }).on('blur', function () {
            $(this).parents('.search').removeClass('focus');
        });

        ImportData.setting();
        ImportData.resetSearch();
        loadSettings();

        function delayRenderGrid(typ, firstPage) {
            if (firstPage) {
                if (typ == 'mosts') {
                    renderMostVisitedData(true);
                } else {
                    renderCustomsData(true);
                }
            } else {
                var self = this;
                $(window).on('newpages:firstPageOnLoad', function () {
                    if (typ == 'mosts') {
                        renderMostVisitedData();
                    } else {
                        renderCustomsData();
                    }
                });
                /*setTimeout(function(){
                 if (typ == 'mosts') {
                 renderMostVisitedData();
                 } else {
                 renderCustomsData();
                 }
                 }, RENDER_DELAY);*/
            }
        }

        function renderMostVisitedData(screenshot) {
            ntpApis.getMostVisitedData(function (datas) {
                console.log('getMostVisitedData 回调函数被调用:', +new Date - st + 'ms(距页面打开)', arguments, 'dontRefreshMosts:', dontRefreshMosts);
                buildDataGrid('mosts', datas, screenshot);
                return arguments.callee;
            } /*(loadTimeData.data.MostvisitedData || [])*/);
        }

        function renderCustomsData(screenshot) {
            ntpApis.getCustomData(function (datas) {
                console.log('getCustomData 回调函数被调用:', +new Date - st + 'ms(距页面打开)', arguments);
                buildDataGrid('customs', datas, screenshot);
                return arguments.callee;
            } /*(loadTimeData.data.CustomData || [])*/);
        };

        window.customsUrlMap = window.mostsUrlMap = {};
        var dontRefreshMosts = false,
                isDraging = false;

        function buildDataGrid(type, datas, screenshot) {
            if (type == 'mosts') {
                setTimeout(function () {
                    buildAddMostsVisited(datas);
                }, RENDER_DELAY);

                if (dontRefreshMosts) {
                    return;
                }

                window.mostsUrlMap = {};
            } else {
                window.customsUrlMap = {};
            }

            var emptyLiFn = tileAddTmplFn, //tileEmptyTmplFn,
                    container = $('.' + type + ' ul'),
                    elis = container.children(),
                    tileSize,
                    drag = '';

            var needSave = GRID_COUNT - datas.length;
            if (needSave > 0) {
                for (var i = 0; i < needSave; i++) {
                    datas.push({
                        drag: drag
                    });
                }
            }

            datas.every(function (item, i) {
                var li;
                if (item.url && item.url.substr(0, 7) == 'widget:') {
                    item.url = '';
                }
                if (item.url) {
                    if (item.pinned_type != undefined) item.pinned_type = item.pinned_type.toString();
                    if (type == 'mosts') {
                        mostsUrlMap[item.url] = item;
                    } else {
                        customsUrlMap[item.url] = item;
                    }
                    item.drag = drag;
                    item.url = checkUrlProtocol(item.url);
                    item.short_url = item.url.shorting(50);
                    item.pic = item.local_pic || 'chrome://thumb/' + item.url;
                    switch (item.thumbnail_type) {
                        case 300:
                        case 400:
                            item.snapshot = '';
                            break;
                        default:
                            item.snapshot = 'snapshot';
                            break;
                    }
                    li = tileTmplFn(item);
                } else {
                    li = emptyLiFn({
                        drag: drag
                    });
                }
                var current = elis.eq(i);
                if (current.length > 0) {
                    if (current.find('.link').attr('href') != item.url) {
                        current.html($(li).children());
                    }
                } else {
                    if (!tileSize) {
                        container.append(li);
                        var tile = container.find('.tile:first');
                        tile.find('.box').height(tile.find('.box').width() * 0.6051);
                        tileSize = {
                            w: tile.outerWidth(),
                            h: tile.outerHeight()
                        };
                    } else {
                        if (type == 'mosts') {
                            li = $(li).css({
                                left: (i % 4) * tileSize.w,
                                top: Math.floor(i / 4) * tileSize.h
                            });
                        }
                        container.append(li);
                    }
                }
                if (i + 1 < GRID_COUNT) {
                    return true;
                } else {
                    return false;
                }
            });

            sendMostsShowedStat();

            wrapResize();

            if (screenshot) {
                ScreenShot.hideAndCapture(type + '-Rendered', true);
            }
        }

        function buildAddMostsVisited(datas) {
            var oftenLis = '';
            datas.forEach(function (item, i) {
                if (item.title) {
                    var mv_li = $('<li><img src="chrome://favicon/size/16/' + htmlEncode(checkUrlProtocol(item.url)) + '"><a href="' + htmlEncode(checkUrlProtocol(item.url)) + '">' + htmlEncode(item.title) + '</a></li>');
                    oftenLis += mv_li[0].outerHTML;
                }
            });
            $('.url-often ul:first').html(oftenLis);
        }

        setTimeout(function () {
            if (!PageSlider.hasMostsPage) {
                ntpApis.getMostVisitedData(buildAddMostsVisited);
            }
            ntpApis.getCurrentURLS(function (datas) {
                var oftenLis = '';
                datas.forEach(function (item) {
                    if (item.title) {
                        var mv_li = $('<li><img src="chrome://favicon/size/16/' + htmlEncode(checkUrlProtocol(item.url)) + '"><a href="' + htmlEncode(checkUrlProtocol(item.url)) + '">' + htmlEncode(item.title) + '</a></li>');
                        oftenLis += mv_li[0].outerHTML;
                    }
                });
                $('.url-often ul:last').html(oftenLis);
            });
        }, RENDER_DELAY);

        $(window).on('load', function () {
            console.log('window.onload:', +new Date - st + 'ms(距页面打开)', arguments);
        });


        $('.box img, .pm-div img, .drag-proxy img, .tile .link').live('dragstart', function (e) {
            return false;
        });


        $('.tile a.link').live('click', function (e) {
            if (e.target.className != 'remove') {
                ntpApis.onClickThumbnail(this.href);
                if ($('.page.current').attr('id') == 'page-mosts') {
                    sendMostsStat(this.href, 'click');
                }
            }
        });

        function getTileTpl(item) {
            var tpl = '';
            if (!item.url) {
                tpl = tileAddTmplFn({});
                return tpl;
            }
            ;
            item.short_url = item.url.shorting(50);
            item.pic = item.local_pic || 'chrome://thumb/' + item.url;
            tpl = tileTmplFn(item);

            return tpl;
        }

        //推荐tiles后添加以及动态效果
        var isRunning = false;

        function addRecommondTiles(tiles) {
            if (tiles.length == 0) return true;
            isRunning = true;
            $('li.tile').removeClass('recommond-tile');
            var emptyTiles = $('.customs li.tile div.empty').parent('li');
            if (emptyTiles.length > 0) {
                emptyTiles = emptyTiles.toArray().reverse(); // jQuery 选取的倒序，正过来。
            } else {
                emptyTiles = $('.customs li.tile');
            }
            var count = 0;
            //大于3个
            if (tiles.length > 0) {
                tiles.forEach(function (item, i) {
                    if (!item.url) {
                        return;
                    }
                    ;
                    count++;
                    var tpl = getTileTpl(item);
                    var el = $(tpl).addClass('recommond-tile');
                    el.find('.box').css({
                        height: imgHeight
                    })
                    $(emptyTiles[i]).replaceWith(el);
                    var img = el.find('.tile-logo img');
                    img.attr('src', 'images/loading.gif');
                    ntpApis.captureWebpage(item.url, function () {
                    });
                    window['capture_timeout_' + item.url] = setTimeout(function () {
                        window.onSnapshotComplete([{
                            url: item.url
                        }]);
                    }, CAPTURE_TIMEOUT);
                });
                saveGrid('customs');
                return true;
            }
        }

        var _mostsShowedStat = false;

        function sendMostsShowedStat() {
            if ($('.page.current').attr('id') != 'page-mosts') {
                return;
            }
            if (_mostsShowedStat) {
                return;
            }
            $('#page-mosts .tile a.link').each(function () {
                sendMostsStat(this.href, 'showed');
            });
            _mostsShowedStat = true;
        }

        function sendMostsStat(url, type) {
            if (url == 'http://u.ctrip.com/union/CtripRedirect.aspx?TypeID=2&Allianceid=323047&sid=803568&OUID=&jumpUrl=http://www.ctrip.com') {
                Stat.send(type == 'showed' ? '423.4622.gif' : '423.7088.gif');
            }
        }

    });

    var Weather = {
        storageKey: 'weather',
        areaUrl: "http://cdn.weather.hao.360.cn/sed_api_area_query.php",
        weatherData: {},
        areaCache: {},
        elments: {},
        $wrap: $('#so_weather'),
        init: function () {
            var eles = this.elments,
                    $wrap = this.$wrap;

            eles.$bar = $wrap.find(".bar");
            eles.$detail = $wrap.find(".detail");
            eles.$change = $wrap.find(".change");
            eles.$today = $wrap.find('.today');
            eles.$list = $wrap.find(".list");
            eles.$select = $wrap.find(".select");
            eles.$province = $wrap.find(".province");
            eles.$city = $wrap.find(".city");
            eles.$town = $wrap.find(".town");
            eles.$date = $wrap.find(".date");
            eles.$at = $wrap.find(".at");
            eles.$ok = $wrap.find(".ok");
            eles.$pm25 = $wrap.find(".pm25");

            this.bind();
            this.getWeatherData();
        },

        getWeatherData: function () {
            var cache = storage.get(this.storageKey);
            if (cache.expires) {
                this.weatherData = cache;
                if (+(new Date) - cache.expires > 999) {
                    this.requestWeatherData(this.weatherData.area[2][1])
                } else {
                    this.fillWeatherData();
                }
            } else {
                this.requestWeatherData();
            }
        },
        requestWeatherData: function (cityCode) {
            var self = this,
                    cityCode = cityCode || "";
            setTimeout(function () {
                $.ajax({
                    url: cityCode == "" ? "http://weather.hao.360.cn/sed_api_weather_info.php" : "http://cdn.weather.hao.360.cn/sed_api_weather_info.php",
                    data: {
                        app: '360chrome',
                        code: cityCode
                    },
                    dataType: "jsonp",
                    jsonp: "_jsonp",
                    success: function (ret) {
                        if (!!ret.time) {
                            self.formatWeatherData(ret);
                        }
                    }
                })
            })
        },
        formatWeatherData: function (data) {
            var serverNow = new Date(data.time * 1000),
                    hours = serverNow.getHours(),
                    expires = new Date(+serverNow),
                    today = data.weather[0].info,
                    tomorrow = data.weather[1].info,
                    after = data.weather[2].info,
                    weatherData = {
                        time: +serverNow,
                        area: data.area,
                        pm25: "",
                        today: {
                            T: "",
                            currentT: '',
                            img: "",
                            desc: "",
                            wind: ''
                        },
                        tomorrow: {
                            T: tomorrow.night[2] + "~" + tomorrow.day[2],
                            img: "1-" + tomorrow.day[0],
                            desc: tomorrow.day[1]
                        },
                        after: {
                            T: after.night[2] + "~" + after.day[2],
                            img: "1-" + after.day[0],
                            desc: after.day[1]
                        },
                        expires: ""
                    };

            if (data.pm25 && data.pm25.pm25) {
                weatherData.pm25 = data.pm25.pm25[0];
            }

            if (hours >= 5 && hours <= 20) {
                a = 1;
                weatherData.today.T = today.night[2] + "~" + today.day[2];
                weatherData.today.currentT = today.day[2];
                weatherData.today.img = a + "-" + today.day[0];
                weatherData.today.desc = today.day[1];
                if (today.day[3]) {
                    weatherData.today.wind = today.day[3] == '无持续风向' ? today.day[4] : (today.day[3] + today.day[4]);
                }
            } else {
                a = 0;
                weatherData.today.T = today.night[2];
                weatherData.today.currentT = today.night[2];
                weatherData.today.img = a + "-" + today.night[0];
                weatherData.today.desc = today.night[1];
                if (today.night[3]) {
                    weatherData.today.wind = today.night[3] == '无持续风向' ? today.night[4] : (today.night[3] + today.night[4]);
                }
            }

            expires.setMinutes(expires.getMinutes() + 10);
            weatherData.expires = +expires;
            this.weatherData = weatherData;
            storage.setData(this.storageKey, weatherData);

            this.fillWeatherData();
        },
        fillWeatherData: function () {
            var weatherData = this.weatherData,
                    eles = this.elments,
                    r = "images/weather/icon/",
                    pm25 = weatherData.pm25,
                    pm25Bar = "",
                    pm25Level = "",
                    pm25Short = "",
                    pm25Search = "https://www.so.com/s?ie=utf-8&src=search_weather&q=" + encodeURIComponent(weatherData.area[2][0]) + " pm2.5",
                    weatherSearch, m, g;

            if (pm25 != "") {
                if (pm25 > 300) {
                    pm25Level = 6;
                    pm25Short = "严重污染";
                } else if (pm25 > 200) {
                    pm25Level = 5;
                    pm25Short = "重度污染";
                } else if (pm25 > 150) {
                    pm25Level = 4;
                    pm25Short = "中度污染";
                } else if (pm25 > 100) {
                    pm25Level = 3;
                    pm25Short = "轻度污染";
                } else if (pm25 > 50) {
                    pm25Level = 2;
                    pm25Short = "良";
                } else if (pm25 >= 0) {
                    pm25Level = 1;
                    pm25Short = "优";
                }
                pm25Bar = '<a href="' + pm25Search + '" target="_blank"><span><b class="pm25-l pm25-l' + pm25Level + '">' + pm25 + ' ' + pm25Short + "</b></span></a>";
            }

            if (weatherData.area[0][0] == weatherData.area[2][0]) {
                m = encodeURIComponent(weatherData.area[0][0] + "天气预报")
            } else {
                m = encodeURIComponent(weatherData.area[0][0] + weatherData.area[2][0] + "天气预报")
            }

            var i = ['<a href="https://www.so.com/s?ie=utf-8&src=search_weather&q=' + m + '" target="_blank">', " <span>" + weatherData.area[2][0] + "</span>", '<img src="' + r + weatherData.today.img + '.png">', " <span>" + weatherData.today.desc + weatherData.today.T + "°C</span>", "</a>", pm25Bar, '<span class="arrow"></span>'];
            eles.$bar.html(i.join(""));

            var serverNow = new Date(weatherData.time);
            var week = ['日', '一', '二', '三', '四', '五', '六'][serverNow.getDay()];
            var date = (serverNow.getMonth() + 1) + '月' + serverNow.getDate() + '日（周' + week + '）';
            eles.$date.text(date);

            eles.$at.text(weatherData.area[2][0]);

            weatherSearch = '<a href="https://www.so.com/s?ie=utf-8&q=' + m + '" target="_blank">';

            eles.$today.html('<span class="temp">' + weatherSearch + weatherData.today.currentT + '℃</a></span><span class="wind">' + weatherSearch + weatherData.today.desc + '　' + weatherData.today.wind + '</a></span><a href="' + pm25Search + '" target="_blank"><b class="pm25-l pm25-l' + pm25Level + '">' + pm25 + ' ' + pm25Short + '</b></a>');

            g = this.isFirstLoad ? "data-src" : "src";
            var s = [weatherSearch, " <div>今天</div>", " <img " + g + '="' + r + weatherData.today.img + '.png">', " <div>" + weatherData.today.desc + "</div>", " <div>" + weatherData.today.T + "°C</div>", "</a>", weatherSearch, " <div>明天</div>", " <img " + g + '="' + r + weatherData.tomorrow.img + '.png">', " <div>" + weatherData.tomorrow.desc + "</div>", " <div>" + weatherData.tomorrow.T + "°C</div>", "</a>", weatherSearch, " <div>后天</div>", " <img " + g + '="' + r + weatherData.after.img + '.png">', " <div>" + weatherData.after.desc + "</div>", " <div>" + weatherData.after.T + "°C</div>", "</a>"];
            eles.$list.html(s.join(""));
            this.fillDone = true;
        },

        show: function () {
            this.$wrap.show();
        },
        hide: function () {
            this.$wrap.hide();
        },
        hideDetail: function () {
            var eles = this.elments;
            if (eles.$detail) {
                eles.$detail.hide();
                eles.$select.hide();
            }
        },

        bind: function () {
            var self = this,
                    eles = self.elments,
                    n, r;

            eles.$bar.hover(function () {
                clearTimeout(n);
                r = setTimeout(function () {
                    if (self.fillDone === true) {
                        eles.$detail.show();
                    }
                }, 300);
            }, function () {
                clearTimeout(r);
                n = setTimeout(function () {
                    eles.$detail.hide()
                }, 300);
            });

            eles.$detail.mouseenter(function () {
                clearTimeout(n)
            }).mouseleave(function (e) {
                clearTimeout(r);
                var i = window.event || e;
                if (document.all) {
                    if (!i.toElement)
                        return
                } else if (!i.relatedTarget)
                    return;
                n = setTimeout(function () {
                    eles.$detail.hide();
                    eles.$select.hide();
                }, 200)
            });

            eles.$change.on("click", function () {
                self.showArea()
            });
            eles.$province.on("change", function () {
                self.getCity($(this).val(), "", function (t) {
                    self.getTown(t)
                })
            });
            eles.$city.on("change", function () {
                self.getTown($(this).val())
            });
            eles.$ok.on("click", function () {
                eles.$select.hide();
                self.requestWeatherData(eles.$town.val());
            });
            self.$wrap.delegate('a[href]', 'click', function () {
                self.hideDetail();
            });
        },
        showArea: function () {
            var e = this,
                    t = e.weatherData,
                    n = t.area[0][1],
                    r = t.area[1][1],
                    i = t.area[2][1];
            setTimeout(function () {
                e.getProvince(n);
                e.getCity(n, r);
                e.getTown(r, i);
                e.elments.$select.show()
            }, 20)
        },
        getProvince: function (e) {
            var t = this,
                    n = t.areaCache;
            n.province ? t.fillProvince(n.province, e) : (n.province = [], $.ajax({
                url: t.areaUrl,
                data: {
                    grade: "province"
                },
                dataType: "jsonp",
                jsonp: "_jsonp",
                success: function (r) {
                    !r || (n.province = r, t.fillProvince(r, e))
                }
            }))
        },
        fillProvince: function (e, t) {
            var n = this,
                    r = n.elments.$province,
                    i = [];
            for (var s = 0, o = e.length; s < o; s++)
                i.push('<option value="' + e[s][1] + '">' + e[s][0] + "</option>");
            r.html(i.join("")), !t || n.selectOption(r[0], t)
        },
        getCity: function (e, t, n) {
            var r = this,
                    i = "c" + e,
                    s = r.areaCache;
            s.city || (s.city = {}), s.city[i] ? r.fillCity(s.city[i], t, n) : $.ajax({
                url: r.areaUrl,
                data: {
                    grade: "city",
                    code: e
                },
                dataType: "jsonp",
                jsonp: "_jsonp",
                success: function (e) {
                    !e || (s.city[i] = e, r.fillCity(e, t, n))
                }
            })
        },
        fillCity: function (e, t, n) {
            var r = this,
                    i = r.elments.$city,
                    s = [];
            for (var o = 0, u = e.length; o < u; o++)
                s.push('<option value="' + e[o][1] + '">' + e[o][0] + "</option>");
            i.html(s.join("")), !t || r.selectOption(i[0], t), n && n(e[0][1])
        },
        getTown: function (e, t) {
            var n = this,
                    r = n.areaCache,
                    i = "t" + e;
            r.town || (r.town = {}), r.town[i] ? n.fillTown(r.town[i], t) : $.ajax({
                url: n.areaUrl,
                data: {
                    grade: "town",
                    code: e
                },
                dataType: "jsonp",
                jsonp: "_jsonp",
                success: function (e) {
                    !e || (r.town[i] = e, n.fillTown(e, t))
                }
            })
        },
        fillTown: function (e, t) {
            var n = this,
                    r = n.elments.$town,
                    i = [];
            for (var s = 0, o = e.length; s < o; s++)
                i.push('<option value="' + e[s][1] + '">' + e[s][0] + "</option>");
            r.html(i.join("")), !t || n.selectOption(r[0], t)
        },
        selectOption: function (e, t) {
            setTimeout(function () {
                for (var n = 0; n < e.options.length; n++)
                    e.options[n].value == t && (e.options[n].selected = !0)
            }, 20)
        }

    };

    $(function () {
        Weather.init();
    });

    (function () {
        if (typeof window.monitor != "undefined")
            return;
        var e = "V1.2.5(2012.12.21)",
                t = "360.cn",
                n = function (r, s) {
                    var o = document,
                            u = navigator,
                            a = r.screen,
                            f = document.domain.toLowerCase(),
                            l = u.userAgent.toLowerCase(),
                            c = {
                                trim: function (e) {
                                    return e.replace(/^[\s\xa0\u3000]+|[\u3000\xa0\s]+$/g, "")
                                }
                            },
                            h = {
                                on: function (e, t, n) {
                                    e.addEventListener ? e && e.addEventListener(t, n, !1) : e && e.attachEvent("on" + t, n)
                                },
                                parentNode: function (e, t, n) {
                                    n = n || 5, t = t.toUpperCase();
                                    while (e && n-- > 0) {
                                        if (e.tagName === t)
                                            return e;
                                        e = e.parentNode
                                    }
                                    return null
                                }
                            },
                            p = {
                                fix: function (e) {
                                    if (!("target" in e)) {
                                        var t = e.srcElement || e.target;
                                        t && t.nodeType == 3 && (t = t.parentNode), e.target = t
                                    }
                                    return e
                                }
                            },
                            d = function () {
                                function e(e) {
                                    return e != null && e.constructor != null ? Object.prototype.toString.call(e).slice(8, -1) : ""
                                }

                                return {
                                    isArray: function (t) {
                                        return e(t) == "Array"
                                    },
                                    isObject: function (e) {
                                        return e !== null && typeof e == "object"
                                    },
                                    mix: function (e, t, n) {
                                        for (i in t)
                                            if (n || !(e[i] || i in e))
                                                e[i] = t[i];
                                        return e
                                    },
                                    encodeURIJson: function (e) {
                                        var t = [];
                                        for (var n in e) {
                                            if (e[n] == null)
                                                continue;
                                            t.push(encodeURIComponent(n) + "=" + encodeURIComponent(e[n]))
                                        }
                                        return t.join("&")
                                    }
                                }
                            }(),
                            storage = {
                                _getAll: function () {
                                    var cookies = {};
                                    try {
                                        cookies = JSON.parse(localStorage['__cookies'] || '{}');
                                    } catch (e) {
                                    }
                                    return cookies;
                                },
                                get: function (key) {
                                    var cookies = this._getAll();
                                    if (cookies[key] && cookies[key].expires > +new Date()) {
                                        return cookies[key].value;
                                    } else {
                                        return '';
                                    }
                                },
                                set: function (key, value, options) {
                                    var cookies = this._getAll();
                                    cookies[key] = {
                                        value: value,
                                        expires: +new Date() + options.expires,
                                    };
                                    localStorage['__cookies'] = JSON.stringify(cookies);
                                    // options = options || {};
                                    // var r = options.expires;
                                    // typeof r == "number" && (r = new Date, r.setTime(r.getTime() + options.expires)), o.cookie = key + "=" + escape(value) + (r ? ";expires=" + r.toGMTString() : "") + (options.path ? ";path=" + options.path : "") + (options.domain ? "; domain=" + options.domain : "")
                                }
                            },
                            m = {
                                getProject: function () {
                                    return ""
                                },
                                getReferrer: function () {
                                    return o.referrer
                                },
                                getBrowser: function () {
                                    var e = {
                                        "360se-ua": "360se",
                                        TT: "tencenttraveler",
                                        Maxthon: "maxthon",
                                        GreenBrowser: "greenbrowser",
                                        Sogou: "se 1.x / se 2.x",
                                        TheWorld: "theworld"
                                    };
                                    for (i in e)
                                        if (l.indexOf(e[i]) > -1)
                                            return i;
                                    var t = !1;
                                    try {
                                        +external.twGetVersion(external.twGetSecurityID(r)).replace(/\./g, "") > 1013 && (t = !0)
                                    } catch (n) {
                                    }
                                    if (t)
                                        return "360se-noua";
                                    var s = l.match(/(msie|chrome|safari|firefox|opera)/);
                                    return s = s ? s[0] : "", s == "msie" && (s = l.match(/msie[^;]+/)), s
                                },
                                getLocation: function () {
                                    var e = "";
                                    try {
                                        e = location.href
                                    } catch (t) {
                                        e = o.createElement("a"), e.href = "", e = e.href
                                    }
                                    return e = e.replace(/[?#].*$/, ""), e = /\.(s?htm|php)/.test(e) ? e : e.replace(/\/$/, "") + "/", e
                                },
                                getGuid: function () {
                                    function e(e) {
                                        var t = 0,
                                                n = 0,
                                                r = e.length - 1;
                                        for (r; r >= 0; r--) {
                                            var i = parseInt(e.charCodeAt(r), 10);
                                            t = (t << 6 & 268435455) + i + (i << 14), (n = t & 266338304) != 0 && (t ^= n >> 21)
                                        }
                                        return t
                                    }

                                    function n() {
                                        var t = [u.appName, u.version, u.language || u.browserLanguage, u.platform, u.userAgent, a.width, "x", a.height, a.colorDepth, o.referrer].join(""),
                                                n = t.length,
                                                i = r.history.length;
                                        while (i)
                                            t += i-- ^ n++;
                                        return (Math.round(Math.random() * 2147483647) ^ e(t)) * 2147483647
                                    }

                                    var i = "__guid",
                                            s = storage.get(i);
                                    if (!s) {
                                        s = [e(o.domain), n(), +(new Date) + Math.random() + Math.random()].join(".");
                                        var l = {
                                            expires: 25920000000,
                                            path: "/"
                                        };
                                        if (t) {
                                            var c = "." + t;
                                            if (f.indexOf(c) > 0 && f.lastIndexOf(c) == f.length - c.length || f == c)
                                                l.domain = c
                                        }
                                        storage.set(i, s, l)
                                    }
                                    return function () {
                                        return s
                                    }
                                }(),
                                getCount: function () {
                                    var e = "count",
                                            t = storage.get(e);
                                    return t = (parseInt(t) || 0) + 1, storage.set(e, t, {
                                        expires: 86400000,
                                        path: "/"
                                    }),
                                            function () {
                                                return t
                                            }
                                }(),
                                getFlashVer: function () {
                                    var e = -1;
                                    if (u.plugins && u.mimeTypes.length) {
                                        var t = u.plugins["Shockwave Flash"];
                                        t && t.description && (e = t.description.replace(/([a-zA-Z]|\s)+/, "").replace(/(\s)+r/, ".") + ".0")
                                    } else if (r.ActiveXObject && !r.opera)
                                        for (var n = 16; n >= 2; n--)
                                            try {
                                                var i = new ActiveXObject("ShockwaveFlash.ShockwaveFlash." + n);
                                                if (i) {
                                                    var s = i.GetVariable("$version");
                                                    e = s.replace(/WIN/g, "").replace(/,/g, ".")
                                                }
                                            } catch (o) {
                                            }
                                    return e = parseInt(e, 10),
                                            function () {
                                                return e
                                            }
                                }(),
                                getContainerId: function (e) {
                                    var t = y.areaIds;
                                    if (t) {
                                        var n, r = new RegExp("^(" + t.join("|") + ")$", "ig");
                                        while (e) {
                                            if (e.id && r.test(e.id))
                                                return (e.getAttribute("data-desc") || e.id).substr(0, 100);
                                            e = e.parentNode
                                        }
                                    }
                                    return ""
                                },
                                getText: function (e) {
                                    return c.trim(e.getAttribute("text") || e.getAttribute("data-text") || e.innerText || e.textContent || e.title || "").substr(0, 100)
                                },
                                getHref: function (e) {
                                    try {
                                        return e.getAttribute("data-href") || e.href
                                    } catch (t) {
                                        return ""
                                    }
                                }
                            },
                            g = {
                                getBase: function () {
                                    return {
                                        p: m.getProject(),
                                        u: m.getLocation(),
                                        id: m.getGuid(),
                                        guid: m.getGuid()
                                    }
                                },
                                getTrack: function () {
                                    return {
                                        b: m.getBrowser(),
                                        c: m.getCount(),
                                        r: m.getReferrer(),
                                        fl: m.getFlashVer()
                                    }
                                },
                                getClick: function (e) {
                                    e = p.fix(e || event);
                                    var t = e.target,
                                            n = t.tagName,
                                            r = m.getContainerId(t);
                                    if (t.type != "submit") {
                                        if (n == "AREA")
                                            return {
                                                f: t.href,
                                                c: "area:" + t.parentNode.name,
                                                cId: r
                                            };
                                        var f, l;
                                        return n == "IMG" && (f = t), t = h.parentNode(t, "A"), t ? (l = m.getText(t), {
                                            f: m.getHref(t),
                                            c: l ? l : f ? f.src.match(/[^\/]+$/) : "",
                                            cId: r
                                        }) : !1
                                    }
                                    var i = h.parentNode(t, "FORM");
                                    if (i) {
                                        var s = i.id || "",
                                                o = t.id,
                                                u = {
                                                    f: i.action,
                                                    c: "form:" + (i.name || s),
                                                    cId: r
                                                };
                                        if ((s == "search-form" || s == "searchForm") && (o == "searchBtn" || o == "search-btn")) {
                                            var a = b("kw") || b("search-kw") || b("kw1");
                                            u.w = a ? a.value : ""
                                        }
                                        return u
                                    }
                                },
                                getKeydown: function (e) {
                                    e = p.fix(e || event);
                                    if (e.keyCode != 13)
                                        return !1;
                                    var t = e.target,
                                            n = t.tagName,
                                            r = m.getContainerId(t);
                                    if (n == "INPUT") {
                                        var i = h.parentNode(t, "FORM");
                                        if (i) {
                                            var s = i.id || "",
                                                    o = t.id,
                                                    u = {
                                                        f: i.action,
                                                        c: "form:" + (i.name || s),
                                                        cId: r
                                                    };
                                            if (o == "kw" || o == "search-kw" || o == "kw1")
                                                u.w = t.value;
                                            return u
                                        }
                                    }
                                    return !1
                                }
                            },
                            y = {
                                trackUrl: null,
                                clickUrl: null,
                                areaIds: null
                            },
                            b = function (e) {
                                return document.getElementById(e)
                            };
                    return {
                        version: e,
                        util: m,
                        data: g,
                        config: y,
                        sendLog: function () {
                            return r.__monitor_imgs = {},
                                    function (e) {
                                        var t = "log_" + +(new Date),
                                                n = r.__monitor_imgs[t] = new Image;
                                        n.onload = n.onerror = function () {
                                            r.__monitor_imgs[t] = null, delete r.__monitor_imgs[t]
                                        }, n.src = e
                                    }
                        }(),
                        buildLog: function () {
                            var e = "";
                            return function (t, n) {
                                if (t === !1)
                                    return;
                                t = t || {};
                                var r = g.getBase();
                                t = d.mix(r, t, !0);
                                var i = n + d.encodeURIJson(t);
                                if (i == e)
                                    return;
                                e = i, setTimeout(function () {
                                    e = ""
                                }, 500);
                                var s = d.encodeURIJson(t);
                                s += "&t=" + +(new Date), n = n.indexOf("?") > -1 ? n + "&" + s : n + "?" + s, this.sendLog(n)
                            }
                        }(),
                        log: function (e, t) {
                            t = t || "click";
                            var n = y[t + "Url"];
                            n || alert("Error : the " + t + "url does not exist!"), this.buildLog(e, n)
                        },
                        setConf: function (e, t) {
                            var n = {};
                            return d.isObject(e) ? n = e : n[e] = t, this.config = d.mix(this.config, n, !0), this
                        },
                        setUrl: function (e) {
                            return e && (this.util.getLocation = function () {
                                return e
                            }), this
                        },
                        setProject: function (e) {
                            return e && (this.util.getProject = function () {
                                return e
                            }), this
                        },
                        setId: function () {
                            var e = [],
                                    t = 0,
                                    n;
                            while (n = arguments[t++])
                                d.isArray(n) ? e = e.concat(n) : e.push(n);
                            return this.setConf("areaIds", e), this
                        },
                        getTrack: function () {
                            var e = this.data.getTrack();
                            return this.log(e, "track"), this
                        },
                        getClickAndKeydown: function () {
                            var e = this;
                            return h.on(o, "mousedown", function (t) {
                                var n = e.data.getClick(t);
                                e.log(n, "click")
                            }), h.on(o, "keydown", function (t) {
                                var n = e.data.getKeydown(t);
                                e.log(n, "click")
                            }), n.getClickAndKeydown = function () {
                                return e
                            }, this
                        }
                    }
                }(window);
        n.setConf({
            trackUrl: "http://s.360.cn/w360/s.htm",
            clickUrl: "http://s.360.cn/w360/c.htm",
            wpoUrl: "http://s.360.cn/w360/p.htm"
        }), window.monitor = n
    })();


})
</script>
</body>
</html>